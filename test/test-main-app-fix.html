<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–µ—Å—Ç –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è - –°—Ç—É–¥–∏—è –º–∞—Å–æ–∫ 2030</title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            margin: 0;
            padding: 20px;
            color: white;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 8px 32px rgba(31, 38, 135, 0.37);
        }
        h1 {
            text-align: center;
            color: #FFD700;
            font-size: 2em;
            margin-bottom: 30px;
        }
        .test-section {
            background: rgba(255, 255, 255, 0.15);
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
            border: 2px solid rgba(255, 255, 255, 0.2);
        }
        .test-title {
            font-size: 1.2em;
            color: #FFD700;
            margin-bottom: 15px;
        }
        .test-btn {
            background: linear-gradient(45deg, #FF6B6B, #4ECDC4);
            border: none;
            border-radius: 25px;
            padding: 10px 20px;
            color: white;
            font-weight: bold;
            cursor: pointer;
            margin: 5px;
            transition: all 0.3s ease;
        }
        .test-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }
        .status-display {
            background: rgba(0, 0, 0, 0.7);
            border-radius: 10px;
            padding: 15px;
            margin-top: 15px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            color: #00FF00;
            max-height: 200px;
            overflow-y: auto;
        }
        .success { color: #4ECDC4; }
        .error { color: #FF6B6B; }
        .warning { color: #FFA500; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üé≠ –¢–µ—Å—Ç –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è</h1>
        
        <div class="test-section">
            <div class="test-title">üìã –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤</div>
            <button class="test-btn" onclick="checkComponents()">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∑–∞–≥—Ä—É–∑–∫—É</button>
            <button class="test-btn" onclick="testMaskSystem()">–¢–µ—Å—Ç MaskSystem</button>
            <button class="test-btn" onclick="testBackgroundEngine()">–¢–µ—Å—Ç Background Engine</button>
            <button class="test-btn" onclick="waitForMediaPipe()">üîÑ –ñ–¥–∞—Ç—å MediaPipe</button>
            <div class="status-display" id="componentStatus">
                –ì–æ—Ç–æ–≤ –∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é...
            </div>
        </div>

        <div class="test-section">
            <div class="test-title">üéØ –ë—ã—Å—Ç—Ä—ã–π —Ç–µ—Å—Ç —ç—Ñ—Ñ–µ–∫—Ç–æ–≤</div>
            <button class="test-btn" onclick="quickTestFaceMesh()">Face Mesh</button>
            <button class="test-btn" onclick="quickTestPose()">Pose</button>
            <button class="test-btn" onclick="quickTestBackground()">Background AI</button>
            <button class="test-btn" onclick="openMainApp()">üöÄ –û—Ç–∫—Ä—ã—Ç—å –æ—Å–Ω–æ–≤–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ</button>
            <div class="status-display" id="testStatus">
                –í—ã–±–µ—Ä–∏—Ç–µ —Ç–µ—Å—Ç –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è...
            </div>
        </div>
    </div>

    <!-- –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –±–∏–±–ª–∏–æ—Ç–µ–∫ MediaPipe -->
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/control_utils/control_utils.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/drawing_utils/drawing_utils.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/face_mesh/face_mesh.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/pose/pose.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands/hands.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/holistic/holistic.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/selfie_segmentation/selfie_segmentation.js"></script>
    
    <!-- –û—Å–Ω–æ–≤–Ω—ã–µ –º–æ–¥—É–ª–∏ -->
    <script src="js/background-effects-engine.js"></script>
    <script src="js/mask-system.js"></script>

    <script>
        // –§—É–Ω–∫—Ü–∏–∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
        function log(message, type = 'info', targetId = 'componentStatus') {
            const statusDiv = document.getElementById(targetId);
            const timestamp = new Date().toLocaleTimeString();
            const colors = {
                info: '#00FF00',
                success: '#4ECDC4',
                warning: '#FFA500',
                error: '#FF6B6B'
            };
            
            const logEntry = document.createElement('div');
            logEntry.style.color = colors[type] || '#00FF00';
            logEntry.innerHTML = `[${timestamp}] ${message}`;
            statusDiv.appendChild(logEntry);
            statusDiv.scrollTop = statusDiv.scrollHeight;
            
            console.log(`[TEST] ${message}`);
        }

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
        function checkComponents() {
            log('üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤...', 'info');
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º MediaPipe
            const mediapipeComponents = {
                'FaceMesh': window.FaceMesh,
                'Pose': window.Pose,
                'Hands': window.Hands,
                'Holistic': window.Holistic,
                'SelfieSegmentation': window.SelfieSegmentation
            };
            
            for (const [name, component] of Object.entries(mediapipeComponents)) {
                if (component) {
                    log(`‚úÖ ${name} –∑–∞–≥—Ä—É–∂–µ–Ω`, 'success');
                } else {
                    log(`‚ùå ${name} –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω`, 'error');
                }
            }
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞—à–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
            if (window.BackgroundEffectsEngine) {
                log('‚úÖ BackgroundEffectsEngine –∑–∞–≥—Ä—É–∂–µ–Ω', 'success');
            } else {
                log('‚ùå BackgroundEffectsEngine –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω', 'error');
            }
            
            if (window.MaskSystem) {
                log('‚úÖ MaskSystem –∑–∞–≥—Ä—É–∂–µ–Ω', 'success');
            } else {
                log('‚ùå MaskSystem –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω', 'error');
            }
        }

        // –û–∂–∏–¥–∞–Ω–∏–µ –∑–∞–≥—Ä—É–∑–∫–∏ MediaPipe –±–∏–±–ª–∏–æ—Ç–µ–∫
        async function waitForMediaPipe() {
            log('üîÑ –û–∂–∏–¥–∞–Ω–∏–µ –∑–∞–≥—Ä—É–∑–∫–∏ MediaPipe –±–∏–±–ª–∏–æ—Ç–µ–∫...', 'info');
            
            let attempts = 0;
            const maxAttempts = 200; // 20 —Å–µ–∫—É–Ω–¥
            
            const checkInterval = setInterval(() => {
                attempts++;
                
                const mediapipeComponents = {
                    'FaceMesh': window.FaceMesh,
                    'Pose': window.Pose,
                    'Hands': window.Hands,
                    'Holistic': window.Holistic,
                    'SelfieSegmentation': window.SelfieSegmentation
                };
                
                const loaded = Object.entries(mediapipeComponents).filter(([name, component]) => !!component);
                const total = Object.keys(mediapipeComponents).length;
                
                log(`üìä MediaPipe: ${loaded.length}/${total} –±–∏–±–ª–∏–æ—Ç–µ–∫ –∑–∞–≥—Ä—É–∂–µ–Ω–æ (${attempts * 100}–º—Å)`, 'info');
                
                if (loaded.length === total) {
                    clearInterval(checkInterval);
                    log('‚úÖ –í—Å–µ MediaPipe –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ –∑–∞–≥—Ä—É–∂–µ–Ω—ã!', 'success');
                    log('üéØ –¢–µ–ø–µ—Ä—å –º–æ–∂–Ω–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —ç—Ñ—Ñ–µ–∫—Ç—ã', 'success');
                } else if (attempts >= maxAttempts) {
                    clearInterval(checkInterval);
                    log('‚ö†Ô∏è –ù–µ –≤—Å–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ –∑–∞–≥—Ä—É–∂–µ–Ω—ã –∑–∞ –æ—Ç–≤–µ–¥–µ–Ω–Ω–æ–µ –≤—Ä–µ–º—è', 'warning');
                    log(`üìã –ó–∞–≥—Ä—É–∂–µ–Ω—ã: ${loaded.map(([name]) => name).join(', ')}`, 'info');
                }
            }, 100);
        }

        // –£–ª—É—á—à–µ–Ω–Ω—ã–π —Ç–µ—Å—Ç MaskSystem —Å –æ–∂–∏–¥–∞–Ω–∏–µ–º MediaPipe
        async function testMaskSystem() {
            log('üé≠ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ MaskSystem...', 'info');
            
            try {
                const maskSystem = new MaskSystem();
                log('‚úÖ MaskSystem —Å–æ–∑–¥–∞–Ω', 'success');
                
                await maskSystem.init();
                log('‚úÖ MaskSystem –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω', 'success');
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ñ–ª–∞–≥ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ MediaPipe
                log(`üìä MediaPipe –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç—å: ${maskSystem.mediaReady}`, maskSystem.mediaReady ? 'success' : 'warning');
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –º–∞—Å–∫–∏
                const faceMasks = maskSystem.getFaceMasks();
                const backgroundMasks = maskSystem.getBackgroundMasks();
                const advancedMasks = maskSystem.getAdvancedMasks();
                
                log(`üìä –ú–∞—Å–∫–∏ –∑–∞–≥—Ä—É–∂–µ–Ω—ã: –õ–∏—Ü–∞(${faceMasks.length}), –§–æ–Ω(${backgroundMasks.length}), AI(${advancedMasks.length})`, 'info');
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç—å MediaPipe –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
                const components = ['faceMesh', 'pose', 'hands', 'holistic', 'selfieSegmentation'];
                components.forEach(comp => {
                    const ready = !!maskSystem[comp];
                    log(`${ready ? '‚úÖ' : '‚ùå'} ${comp}: ${ready ? '–≥–æ—Ç–æ–≤' : '–Ω–µ –≥–æ—Ç–æ–≤'}`, ready ? 'success' : 'error');
                });
                
            } catch (error) {
                log(`‚ùå –û—à–∏–±–∫–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è MaskSystem: ${error.message}`, 'error');
            }
        }

        // –¢–µ—Å—Ç Background Engine
        async function testBackgroundEngine() {
            log('‚ö° –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ Background Effects Engine...', 'info');
            
            try {
                const engine = new BackgroundEffectsEngine();
                log('‚úÖ BackgroundEffectsEngine —Å–æ–∑–¥–∞–Ω', 'success');
                
                const success = await engine.initialize();
                if (success) {
                    log('‚úÖ BackgroundEffectsEngine –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω', 'success');
                } else {
                    log('‚ö†Ô∏è BackgroundEffectsEngine –Ω–µ —Å–º–æ–≥ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å—Å—è', 'warning');
                }
                
            } catch (error) {
                log(`‚ùå –û—à–∏–±–∫–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è Background Engine: ${error.message}`, 'error');
            }
        }

        // –ë—ã—Å—Ç—Ä—ã–µ —Ç–µ—Å—Ç—ã —ç—Ñ—Ñ–µ–∫—Ç–æ–≤
        async function quickTestFaceMesh() {
            log('üéØ –ë—ã—Å—Ç—Ä—ã–π —Ç–µ—Å—Ç Face Mesh...', 'info', 'testStatus');
            
            try {
                const maskSystem = new MaskSystem();
                await maskSystem.init();
                
                // –°–æ–∑–¥–∞–µ–º —Ç–µ—Å—Ç–æ–≤—É—é –º–∞—Å–∫—É Face Mesh
                const faceMeshMask = { id: 'face-mesh', name: 'Face Mesh', type: 'mediapipe' };
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –º–∞—Å–∫–∞ –ø—Ä–∞–≤–∏–ª—å–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è
                log('üìù –¢–µ—Å—Ç–∏—Ä—É–µ–º –º–∞—Å–∫—É —Å ID: face-mesh', 'info', 'testStatus');
                
                if (maskSystem.faceMesh) {
                    log('‚úÖ Face Mesh –≥–æ—Ç–æ–≤ –∫ —Ä–∞–±–æ—Ç–µ', 'success', 'testStatus');
                } else {
                    log('‚ö†Ô∏è Face Mesh –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω (MediaPipe –±–∏–±–ª–∏–æ—Ç–µ–∫–∏)', 'warning', 'testStatus');
                }
                
            } catch (error) {
                log(`‚ùå –û—à–∏–±–∫–∞ —Ç–µ—Å—Ç–∞ Face Mesh: ${error.message}`, 'error', 'testStatus');
            }
        }

        async function quickTestPose() {
            log('üèÉ –ë—ã—Å—Ç—Ä—ã–π —Ç–µ—Å—Ç Pose...', 'info', 'testStatus');
            
            try {
                const maskSystem = new MaskSystem();
                await maskSystem.init();
                
                if (maskSystem.pose) {
                    log('‚úÖ Pose –≥–æ—Ç–æ–≤ –∫ —Ä–∞–±–æ—Ç–µ', 'success', 'testStatus');
                } else {
                    log('‚ö†Ô∏è Pose –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω (MediaPipe –±–∏–±–ª–∏–æ—Ç–µ–∫–∏)', 'warning', 'testStatus');
                }
                
            } catch (error) {
                log(`‚ùå –û—à–∏–±–∫–∞ —Ç–µ—Å—Ç–∞ Pose: ${error.message}`, 'error', 'testStatus');
            }
        }

        async function quickTestBackground() {
            log('üé® –ë—ã—Å—Ç—Ä—ã–π —Ç–µ—Å—Ç Background AI...', 'info', 'testStatus');
            
            try {
                const maskSystem = new MaskSystem();
                await maskSystem.init();
                
                if (maskSystem.backgroundEngineReady) {
                    log('‚úÖ Background Effects Engine –≥–æ—Ç–æ–≤', 'success', 'testStatus');
                } else {
                    log('‚ö†Ô∏è Background Effects Engine –Ω–µ –≥–æ—Ç–æ–≤', 'warning', 'testStatus');
                }
                
                if (maskSystem.selfieSegmentation) {
                    log('‚úÖ Selfie Segmentation –≥–æ—Ç–æ–≤', 'success', 'testStatus');
                } else {
                    log('‚ö†Ô∏è Selfie Segmentation –Ω–µ –≥–æ—Ç–æ–≤', 'warning', 'testStatus');
                }
                
            } catch (error) {
                log(`‚ùå –û—à–∏–±–∫–∞ —Ç–µ—Å—Ç–∞ Background: ${error.message}`, 'error', 'testStatus');
            }
        }

        // –û—Ç–∫—Ä—ã—Ç—å –æ—Å–Ω–æ–≤–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
        function openMainApp() {
            log('üöÄ –û—Ç–∫—Ä—ã–≤–∞–µ–º –æ—Å–Ω–æ–≤–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ...', 'info', 'testStatus');
            window.open('http://localhost:8090', '_blank');
        }

        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        window.addEventListener('load', () => {
            log('üöÄ –¢–µ—Å—Ç–æ–≤–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞', 'info');
            log('üìã –í—ã–ø–æ–ª–Ω–∏—Ç–µ –ø—Ä–æ–≤–µ—Ä–∫—É –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ –¥–ª—è –Ω–∞—á–∞–ª–∞', 'info');
        });
    </script>
</body>
</html> 