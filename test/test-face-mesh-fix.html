<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üéØ –¢–µ—Å—Ç –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è Face Mesh</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
            text-align: center;
        }
        
        h1 {
            margin-bottom: 30px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
        }
        
        .video-container {
            position: relative;
            display: inline-block;
            margin-bottom: 20px;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }
        
        #video {
            width: 640px;
            height: 480px;
            transform: scaleX(-1); /* –ó–µ—Ä–∫–∞–ª–∏—Ä—É–µ–º —Ç–æ–ª—å–∫–æ –≤–∏–¥–µ–æ */
            border-radius: 15px;
        }
        
        .test-btn {
            background: linear-gradient(45deg, #FF6B6B, #4ECDC4);
            border: none;
            color: white;
            padding: 15px 30px;
            margin: 10px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }
        
        .test-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.3);
        }
        
        .test-btn:active {
            transform: scale(0.98);
        }
        
        .status {
            background: rgba(0,0,0,0.3);
            padding: 15px;
            border-radius: 10px;
            margin: 20px 0;
            backdrop-filter: blur(10px);
        }
        
        .log {
            background: rgba(0,0,0,0.5);
            padding: 15px;
            border-radius: 10px;
            text-align: left;
            max-height: 300px;
            overflow-y: auto;
            font-family: monospace;
            font-size: 14px;
        }
        
        .instructions {
            background: rgba(0,0,0,0.2);
            padding: 15px;
            border-radius: 10px;
            margin: 20px 0;
            text-align: left;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üéØ –¢–µ—Å—Ç –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è Face Mesh</h1>
        
        <div class="instructions">
            <h3>üìã –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏:</h3>
            <ol>
                <li>–ù–∞–∂–º–∏—Ç–µ "–ó–∞–ø—É—Å—Ç–∏—Ç—å –∫–∞–º–µ—Ä—É"</li>
                <li>–î–æ–∂–¥–∏—Ç–µ—Å—å –∑–∞–≥—Ä—É–∑–∫–∏ MediaPipe</li>
                <li>–ù–∞–∂–º–∏—Ç–µ "–¢–µ—Å—Ç Face Mesh"</li>
                <li>–î–≤–∏–≥–∞–π—Ç–µ –≥–æ–ª–æ–≤–æ–π - —Ç–æ—á–∫–∏ –¥–æ–ª–∂–Ω—ã –ø–æ–≤—Ç–æ—Ä—è—Ç—å –¥–≤–∏–∂–µ–Ω–∏—è –ª–∏—Ü–∞</li>
                <li>–ï—Å–ª–∏ —Ç–æ—á–∫–∏ –¥–≤–∏–≥–∞—é—Ç—Å—è –≤ –ø—Ä–æ—Ç–∏–≤–æ–ø–æ–ª–æ–∂–Ω—É—é —Å—Ç–æ—Ä–æ–Ω—É - –µ—Å—Ç—å –ø—Ä–æ–±–ª–µ–º–∞ –∑–µ—Ä–∫–∞–ª–∏—Ä–æ–≤–∞–Ω–∏—è</li>
            </ol>
        </div>
        
        <div class="video-container">
            <video id="video" autoplay muted playsinline></video>
        </div>
        
        <div class="controls">
            <button class="test-btn" onclick="startCamera()">üì∑ –ó–∞–ø—É—Å—Ç–∏—Ç—å –∫–∞–º–µ—Ä—É</button>
            <button class="test-btn" onclick="waitForMediaPipe()">‚è≥ –î–æ–∂–¥–∞—Ç—å—Å—è MediaPipe</button>
            <button class="test-btn" onclick="testFaceMesh()">üéØ –¢–µ—Å—Ç Face Mesh</button>
            <button class="test-btn" onclick="stopTest()">‚èπÔ∏è –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å</button>
            <button class="test-btn" onclick="clearLog()">üßπ –û—á–∏—Å—Ç–∏—Ç—å –ª–æ–≥</button>
        </div>
        
        <div class="status" id="status">
            –ì–æ—Ç–æ–≤ –∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –∫–∞–º–µ—Ä—É.
        </div>
        
        <div class="log" id="log"></div>
    </div>

    <!-- –°–∫—Ä–∏–ø—Ç—ã –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è -->
    <script src="js/background-effects-engine.js"></script>
    <script src="js/mask-system.js"></script>
    
    <!-- MediaPipe –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ -->
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/control_utils/control_utils.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/drawing_utils/drawing_utils.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/face_mesh/face_mesh.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/pose/pose.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands/hands.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/holistic/holistic.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/selfie_segmentation/selfie_segmentation.js"></script>

    <script>
        let maskSystem = null;
        let isTestActive = false;

        function log(message, type = 'info') {
            const logElement = document.getElementById('log');
            const timestamp = new Date().toLocaleTimeString();
            const icon = type === 'success' ? '‚úÖ' : type === 'error' ? '‚ùå' : type === 'warning' ? '‚ö†Ô∏è' : '‚ÑπÔ∏è';
            logElement.innerHTML += `[${timestamp}] ${icon} ${message}<br>`;
            logElement.scrollTop = logElement.scrollHeight;
            console.log(message);
        }

        function updateStatus(message) {
            document.getElementById('status').textContent = message;
            log(`Status: ${message}`);
        }

        async function startCamera() {
            try {
                log('üì∑ –ó–∞–ø—É—Å–∫ –∫–∞–º–µ—Ä—ã...');
                updateStatus('–ó–∞–ø—É—Å–∫ –∫–∞–º–µ—Ä—ã...');
                
                // –°–æ–∑–¥–∞–µ–º MaskSystem –µ—Å–ª–∏ –µ—â–µ –Ω–µ —Å–æ–∑–¥–∞–Ω
                if (!maskSystem) {
                    maskSystem = new MaskSystem();
                    await maskSystem.init();
                    log('‚úÖ MaskSystem –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω', 'success');
                }
                
                // –ó–∞–ø—É—Å–∫–∞–µ–º –≤–∏–¥–µ–æ –∑–∞—Ö–≤–∞—Ç
                await maskSystem.setupVideoCapture();
                log('‚úÖ –ö–∞–º–µ—Ä–∞ –∑–∞–ø—É—â–µ–Ω–∞', 'success');
                updateStatus('–ö–∞–º–µ—Ä–∞ –∞–∫—Ç–∏–≤–Ω–∞. –î–æ–∂–¥–∏—Ç–µ—Å—å –∑–∞–≥—Ä—É–∑–∫–∏ MediaPipe.');
                
            } catch (error) {
                log(`‚ùå –û—à–∏–±–∫–∞ –∑–∞–ø—É—Å–∫–∞ –∫–∞–º–µ—Ä—ã: ${error.message}`, 'error');
                updateStatus('–û—à–∏–±–∫–∞ –∑–∞–ø—É—Å–∫–∞ –∫–∞–º–µ—Ä—ã');
            }
        }

        async function waitForMediaPipe() {
            if (!maskSystem) {
                log('‚ùå –°–Ω–∞—á–∞–ª–∞ –∑–∞–ø—É—Å—Ç–∏—Ç–µ –∫–∞–º–µ—Ä—É', 'error');
                return;
            }
            
            log('‚è≥ –û–∂–∏–¥–∞–Ω–∏–µ –∑–∞–≥—Ä—É–∑–∫–∏ MediaPipe –±–∏–±–ª–∏–æ—Ç–µ–∫...');
            updateStatus('–ó–∞–≥—Ä—É–∑–∫–∞ MediaPipe –±–∏–±–ª–∏–æ—Ç–µ–∫...');
            
            let attempts = 0;
            const maxAttempts = 100; // 10 —Å–µ–∫—É–Ω–¥
            
            const checkInterval = setInterval(() => {
                attempts++;
                
                const ready = maskSystem.mediaReady && 
                             maskSystem.faceMesh && 
                             window.FaceMesh;
                
                if (ready) {
                    clearInterval(checkInterval);
                    log('‚úÖ MediaPipe Face Mesh –≥–æ—Ç–æ–≤!', 'success');
                    updateStatus('MediaPipe –≥–æ—Ç–æ–≤. –ú–æ–∂–µ—Ç–µ –∑–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç Face Mesh.');
                } else if (attempts >= maxAttempts) {
                    clearInterval(checkInterval);
                    log('‚ö†Ô∏è MediaPipe –Ω–µ –≥–æ—Ç–æ–≤ –∑–∞ –æ—Ç–≤–µ–¥–µ–Ω–Ω–æ–µ –≤—Ä–µ–º—è', 'warning');
                    log(`üìä –°—Ç–∞—Ç—É—Å: mediaReady=${maskSystem.mediaReady}, faceMesh=${!!maskSystem.faceMesh}, window.FaceMesh=${!!window.FaceMesh}`);
                    updateStatus('MediaPipe –Ω–µ –≥–æ—Ç–æ–≤');
                } else {
                    if (attempts % 10 === 0) {
                        log(`‚è≥ –û–∂–∏–¥–∞–Ω–∏–µ... (${attempts * 100}–º—Å)`);
                    }
                }
            }, 100);
        }

        async function testFaceMesh() {
            if (!maskSystem || !maskSystem.mediaReady) {
                log('‚ùå MaskSystem –∏–ª–∏ MediaPipe –Ω–µ –≥–æ—Ç–æ–≤', 'error');
                return;
            }
            
            try {
                log('üéØ –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–∞ Face Mesh...');
                updateStatus('–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ Face Mesh...');
                
                // –°–æ–∑–¥–∞–µ–º —Ç–µ—Å—Ç–æ–≤—É—é –º–∞—Å–∫—É Face Mesh
                const faceMeshMask = {
                    id: 'face-mesh',
                    name: 'Face Mesh Test',
                    type: 'mediapipe'
                };
                
                // –ü—Ä–∏–º–µ–Ω—è–µ–º –º–∞—Å–∫—É —á–µ—Ä–µ–∑ MaskSystem
                await maskSystem.applyMask(faceMeshMask);
                
                isTestActive = true;
                log('‚úÖ Face Mesh —Ç–µ—Å—Ç –∑–∞–ø—É—â–µ–Ω!', 'success');
                log('üëÅÔ∏è –°–º–æ—Ç—Ä–∏—Ç–µ –Ω–∞ –≤–∏–¥–µ–æ - –∑–µ–ª–µ–Ω—ã–µ —Ç–æ—á–∫–∏ –¥–æ–ª–∂–Ω—ã –ø–æ–≤—Ç–æ—Ä—è—Ç—å –¥–≤–∏–∂–µ–Ω–∏—è –ª–∏—Ü–∞', 'success');
                updateStatus('Face Mesh –∞–∫—Ç–∏–≤–µ–Ω. –î–≤–∏–≥–∞–π—Ç–µ –≥–æ–ª–æ–≤–æ–π –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏.');
                
            } catch (error) {
                log(`‚ùå –û—à–∏–±–∫–∞ —Ç–µ—Å—Ç–∞ Face Mesh: ${error.message}`, 'error');
                updateStatus('–û—à–∏–±–∫–∞ —Ç–µ—Å—Ç–∞ Face Mesh');
            }
        }

        function stopTest() {
            if (maskSystem) {
                maskSystem.clearAllEffects();
                isTestActive = false;
                log('‚èπÔ∏è –¢–µ—Å—Ç –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω', 'success');
                updateStatus('–¢–µ—Å—Ç –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω');
            }
        }

        function clearLog() {
            document.getElementById('log').innerHTML = '';
            log('üßπ –õ–æ–≥ –æ—á–∏—â–µ–Ω');
        }

        // –ê–≤—Ç–æ–∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        window.addEventListener('load', () => {
            log('üöÄ –¢–µ—Å—Ç–æ–≤–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ Face Mesh –∑–∞–≥—Ä—É–∂–µ–Ω–∞');
            log('üìã –°–ª–µ–¥—É–π—Ç–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è');
        });
    </script>
</body>
</html> 