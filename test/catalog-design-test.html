<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>beLive - –¢–µ—Å—Ç–æ–≤–∞—è –°—Ç—Ä–∞–Ω–∏—Ü–∞ –ö–∞—Ç–∞–ª–æ–≥–∞</title>
    <link rel="stylesheet" href="../css/styles.css"> <!-- –ü–æ–¥–∫–ª—é—á–∞–µ–º –æ—Å–Ω–æ–≤–Ω—ã–µ —Å—Ç–∏–ª–∏ -->
    <!-- <link rel="stylesheet" href="../css/track-catalog.css"> üîß –ó–ê–ö–û–ú–ú–ï–ù–¢–ò–†–û–í–ê–ù–û: –§–∞–π–ª –Ω–µ –Ω–∞–π–¥–µ–Ω -->
    
    <!-- üéµ CDN –¥–ª—è wavesurfer.js - –ø—Ä–µ–¥–ø—Ä–æ—Å–ª—É—à–∫–∞ -->
    <script src="https://unpkg.com/wavesurfer.js@7/dist/wavesurfer.umd.min.js"></script>
    
    <style>
        body {
            background-color: #1a1a1a;
            color: #f0f0f0;
            font-family: 'Arial', sans-serif;
            margin: 0;
            display: flex;
            flex-direction: column; /* Stack header and main content */
            min-height: 100vh; /* Full viewport height */
            box-sizing: border-box;
        }

        /* Top navigation for modes */
        .mode-nav {
            background-color: #2a2a2a;
            padding: 10px 20px;
            display: flex;
            justify-content: center;
            gap: 15px;
            border-bottom: 1px solid #3a3a3a;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
        }
        .mode-btn {
            background-color: #4a4a4a;
            color: #f0f0f0;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1em;
            transition: background-color 0.3s, color 0.3s;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
            text-transform: uppercase;
            font-weight: bold;
        }
        .mode-btn:hover {
            background-color: #00e676;
            color: #1a1a1a;
            transform: translateY(-2px);
        }
        .mode-btn.active {
            background-color: #00e676;
            color: #1a1a1a;
            box-shadow: 0 0 10px #00e676;
        }

        .catalog-main-content {
            flex-grow: 1;
            display: flex;
            gap: 20px;
            padding: 20px;
            box-sizing: border-box;
            overflow: hidden;
        }

        .catalog-column {
            flex: 1;
            background-color: #2a2a2a;
            border-radius: 8px;
            padding: 15px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.4);
            display: flex;
            flex-direction: column;
            overflow-y: auto;
            max-height: 100%;
            position: relative;
        }

        .column-header {
            font-size: 1.5em;
            margin-bottom: 15px;
            color: #00e676;
            text-align: center;
            padding-bottom: 5px;
            border-bottom: 2px solid #00e676;
        }

        /* Specific styles for My Music */
        .my-music-column .artist-group {
            background-color: #3a3a3a;
            border-radius: 5px;
            margin-bottom: 10px;
            padding: 10px;
            cursor: pointer;
            transition: background-color 0.2s;
            overflow: hidden;
        }
        .my-music-column .artist-group:hover {
            background-color: #4a4a4a;
        }
        .my-music-column .artist-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-weight: bold;
            color: #eee;
            padding-right: 5px;
        }
        .my-music-column .artist-header span:last-child {
            color: #bbb;
            font-size: 0.9em;
        }
        .my-music-column .toggle-icon {
            display: inline-block;
            width: 1em;
            text-align: center;
            transition: transform 0.3s ease;
        }
        .my-music-column .artist-group.expanded .toggle-icon {
            transform: rotate(90deg);
        }
        .my-music-column .track-list {
            list-style: none;
            padding: 0;
            margin-top: 10px;
            border-top: 1px solid #4a4a4a;
            padding-top: 10px;
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease-out, padding-top 0.3s ease-out, margin-top 0.3s ease-out;
        }
        .my-music-column .track-list.expanded {
            max-height: 500px;
            padding-top: 10px;
            margin-top: 10px;
        }
        .my-music-column .track-item {
            padding: 8px 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.9em;
            color: #bbb;
            border-bottom: 1px dashed #4a4a4a;
        }
        .my-music-column .track-item:last-child {
            border-bottom: none;
        }
        .my-music-column .track-item-controls button {
            background: none;
            border: none; /* Removed border */
            color: #00e676;
            padding: 5px;
            border-radius: 3px;
            cursor: pointer;
            margin-left: 5px; /* Adjusted margin */
            transition: background-color 0.2s, color 0.2s;
            font-size: 1.1em; /* Larger icons */
        }
        .my-music-column .track-item-controls button:hover {
            background-color: rgba(0, 230, 118, 0.2); /* Subtle hover */
            color: #00ff8c;
        }
        .my-music-column .track-item-controls button.favorite {
            color: #ffc107; /* Star color */
        }
        .my-music-column .track-item-controls button.favorite.active {
            background-color: #ffc107;
            color: #1a1a1a;
        }
        .my-music-column .track-meta-info {
            font-size: 0.8em;
            color: #888;
            margin-left: 10px;
        }

        /* Specific styles for Trends & Suggestions */
        .trends-suggestions-column .section-title {
            font-size: 1.2em;
            color: #00e676;
            margin-top: 20px;
            margin-bottom: 10px;
            border-bottom: 1px solid #4a4a4a;
            padding-bottom: 5px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .trends-suggestions-column .track-card {
            background-color: #3a3a3a;
            border-radius: 8px;
            margin-bottom: 10px;
            padding: 10px;
            display: flex;
            align-items: center;
            gap: 15px;
            cursor: pointer;
            transition: background-color 0.2s, transform 0.2s;
            position: relative;
            overflow: hidden;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
        }
        .trends-suggestions-column .track-card:hover {
            background-color: #4a4a4a;
            transform: translateY(-3px);
        }
        .trends-suggestions-column .album-art-placeholder {
            width: 60px;
            height: 60px;
            background-color: #555;
            border-radius: 5px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.7em;
            color: #ccc;
            flex-shrink: 0;
            border: 1px solid #666;
            background-image: url('https://via.placeholder.com/60'); /* Placeholder image */
            background-size: cover;
            background-position: center;
            text-indent: -9999px; /* Hide text, show background image */
        }
        .trends-suggestions-column .track-details {
            flex-grow: 1;
        }
        .trends-suggestions-column .track-details .title {
            font-weight: bold;
            color: #eee;
            margin-bottom: 3px;
            font-size: 1.05em;
        }
        .trends-suggestions-column .track-details .artist {
            font-size: 0.85em;
            color: #aaa;
        }
        .trends-suggestions-column .trend-indicator {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 5px;
            background: linear-gradient(90deg, #00e676, #00b0ff); /* Gradient for trend */
            border-radius: 0 0 8px 8px;
            transform-origin: left;
            animation: trend-pulse 2s infinite alternate;
        }
        @keyframes trend-pulse {
            from { width: 0%; opacity: 0.5; }
            to { width: 100%; opacity: 1; }
        }

        /* Specific styles for Smart Search */
        .smart-search-column input[type="text"] {
            width: calc(100% - 20px);
            padding: 12px;
            margin-bottom: 15px;
            border: 1px solid #555;
            border-radius: 8px;
            background-color: #3a3a3a;
            color: #f0f0f0;
            font-size: 1.1em;
            box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.3);
            outline: none;
            transition: border-color 0.3s, box-shadow 0.3s;
        }
        .smart-search-column input[type="text"]:focus {
            border-color: #00e676;
            box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.3), 0 0 8px rgba(0, 230, 118, 0.5);
        }
        .search-results {
            flex-grow: 1;
            overflow-y: auto;
            padding-right: 5px;
        }
        .search-result-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 8px 12px;
            border-bottom: 1px solid #4a4a4a;
            cursor: pointer;
            transition: background-color 0.2s, transform 0.1s;
            font-size: 0.9em;
        }
        .search-result-item:last-child {
            border-bottom: none;
        }
        .search-result-item:hover {
            background-color: #4a4a4a;
            transform: translateY(-1px);
        }
        .search-result-item .track-icon {
            font-size: 1.1em;
            color: #bbb;
            flex-shrink: 0;
            width: 20px;
            text-align: center;
        }
        .search-result-item .track-details {
            flex-grow: 1;
            min-width: 0; /* –î–ª—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ —Å–∂–∞—Ç–∏—è —Ç–µ–∫—Å—Ç–∞ */
        }
        .search-result-item .track-title {
            font-weight: bold;
            color: #eee;
            font-size: 1em;
            margin-bottom: 2px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        .search-result-item .track-artist {
            font-size: 0.8em;
            color: #888;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        .search-result-item .track-actions {
            display: flex;
            gap: 8px;
            flex-shrink: 0;
        }
        .search-result-item .preview-btn,
        .search-result-item .add-to-setlist-btn {
            background: none;
            border: none;
            color: #bbb;
            font-size: 1.1em;
            cursor: pointer;
            padding: 4px;
            border-radius: 3px;
            transition: background-color 0.2s, color 0.2s;
        }
        .search-result-item .preview-btn:hover {
            background-color: rgba(0, 230, 118, 0.2);
            color: #00e676;
        }
        .search-result-item .add-to-setlist-btn:hover {
            background-color: rgba(51, 170, 255, 0.2);
            color: #33aaff;
        }
        .highlight-exact {
            color: #00e676;
            font-weight: bold;
        }
        .highlight-partial {
            color: #a2f900;
        }
        .search-icon {
            font-size: 1.2em;
            color: #bbb;
            flex-shrink: 0;
        }

        /* üîß –ù–û–í–´–ï –°–¢–ò–õ–ò: –ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä –ü–ª–µ–π–ª–∏—Å—Ç–∞ */
        .playlist-builder-column {
            flex: 1.2; /* –î–µ–ª–∞–µ–º –µ–≥–æ –Ω–µ–º–Ω–æ–≥–æ —à–∏—Ä–µ */
            background-color: #252525; /* –ù–µ–º–Ω–æ–≥–æ –¥—Ä—É–≥–æ–π —Ñ–æ–Ω –¥–ª—è –≤—ã–¥–µ–ª–µ–Ω–∏—è */
            border-left: 2px solid #00e676;
            transition: all 0.5s ease-in-out;
        }
        .playlist-controls {
            display: flex;
            justify-content: space-around;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid #4a4a4a;
        }
        .playlist-btn {
            background-color: #4a4a4a;
            color: #f0f0f0;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.9em;
            transition: background-color 0.3s;
            font-weight: bold;
        }
        .playlist-btn:hover {
            background-color: #00e676;
            color: #1a1a1a;
        }
        .playlist-tracks-container {
            flex-grow: 1;
            overflow-y: auto;
            min-height: 200px; /* –ß—Ç–æ–±—ã –±—ã–ª–æ –≤–∏–¥–Ω–æ –æ–±–ª–∞—Å—Ç—å –¥–ª—è –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏—è */
        }
        .playlist-track-item {
            background-color: #3a3a3a;
            border-radius: 5px;
            padding: 10px;
            margin-bottom: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.9em;
            cursor: grab;
            border-left: 4px solid #33aaff; /* –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –ø–ª–µ–π–ª–∏—Å—Ç–∞ */
        }
        .playlist-track-item:active {
            cursor: grabbing;
        }
        .playlist-track-item.dragging {
            opacity: 0.5;
            background: #555;
        }
        /* üîß –ù–û–í–´–ô –°–¢–ò–õ–¨: –ü–ª–∞–≤–Ω—ã–π –ø–µ—Ä–µ—Ö–æ–¥ –∏ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –¥—Ä–æ–ø-–∑–æ–Ω—ã */
        .playlist-track-item {
            transition: transform 0.2s ease-in-out, background-color 0.2s;
        }
        .drop-indicator {
            height: 4px;
            background-color: #00e676;
            border-radius: 2px;
            margin: 4px 0;
            transition: all 0.2s;
        }
        .playlist-summary {
            margin-top: 15px;
            padding-top: 10px;
            border-top: 1px solid #4a4a4a;
            text-align: right;
            font-weight: bold;
            font-size: 1.1em;
            color: #00e676;
        }
        .my-music-column .track-item-controls button.add-to-playlist-btn {
            color: #33aaff;
        }
        .my-music-column .track-item-controls button.add-to-playlist-btn:hover {
            background-color: rgba(51, 170, 255, 0.2);
            color: #66ccff;
        }

        /* üîß –ù–û–í–´–ï –°–¢–ò–õ–ò: –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∞—è –∫–æ–ª–æ–Ω–∫–∞ —Å —Ç–∞–±–∞–º–∏ */
        .center-dynamic-column {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        .tab-navigation {
            display: flex;
            gap: 10px;
            background-color: #3a3a3a;
            border-radius: 8px;
            padding: 8px 10px;
            border: 1px solid #4a4a4a;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        }
        .tab-btn {
            background-color: #4a4a4a;
            color: #f0f0f0;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.9em;
            transition: background-color 0.3s, color 0.3s;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            text-transform: uppercase;
            font-weight: bold;
        }
        .tab-btn:hover {
            background-color: #00e676;
            color: #1a1a1a;
        }
        .tab-btn.active {
            background-color: #00e676;
            color: #1a1a1a;
            box-shadow: 0 0 10px #00e676;
        }
        .tab-content {
            flex-grow: 1;
            background-color: #2a2a2a;
            border-radius: 8px;
            padding: 15px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.4);
            overflow-y: auto;
            max-height: 100%;
        }
        .tab-panel {
            display: none;
        }
        .tab-panel.active {
            display: block;
        }
        .empty-state {
            text-align: center;
            padding: 50px 20px;
            color: #888;
        }
        .empty-icon {
            font-size: 4em;
            margin-bottom: 15px;
        }
        .empty-state h3 {
            font-size: 1.5em;
            margin-bottom: 10px;
            color: #eee;
        }
        .empty-state p {
            font-size: 1em;
            margin-bottom: 20px;
            color: #bbb;
        }
        .drop-zone {
            width: 100%;
            height: 150px;
            border: 2px dashed #555;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #888;
            font-size: 1.2em;
            text-align: center;
            transition: border-color 0.3s ease-in-out;
        }
        .drop-zone.drag-over {
            border-color: #00e676;
            background-color: rgba(0, 230, 118, 0.1);
        }

        /* üîß –ù–û–í–´–ï –°–¢–ò–õ–ò: –ê–∫—Ç–∏–≤–Ω—ã–π —Å–µ—Ç-–ª–∏—Å—Ç (–¥–æ–∫) */
        .setlist-dock {
            position: fixed;
            top: 0;
            right: -400px; /* –°–∫—Ä—ã—Ç –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é */
            width: 350px;
            height: 100%;
            background-color: #2a2a2a;
            box-shadow: -2px 0 10px rgba(0, 0, 0, 0.5);
            transition: right 0.3s ease-in-out;
            display: flex;
            flex-direction: column;
            z-index: 1000;
            box-sizing: border-box;
        }
        .setlist-dock.active {
            right: 0;
        }
        .dock-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 20px;
            border-bottom: 1px solid #4a4a4a;
            background-color: #3a3a3a;
            border-radius: 8px 8px 0 0;
        }
        .dock-header h3 {
            margin: 0;
            color: #00e676;
            font-size: 1.2em;
        }
        .dock-close-btn {
            background: none;
            border: none;
            color: #f0f0f0;
            font-size: 1.5em;
            cursor: pointer;
            transition: color 0.3s;
        }
        .dock-close-btn:hover {
            color: #ff5555;
        }
        .dock-controls {
            display: flex;
            justify-content: space-around;
            padding: 10px 20px;
            border-bottom: 1px solid #4a4a4a;
        }
        .dock-btn {
            background-color: #4a4a4a;
            color: #f0f0f0;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.9em;
            transition: background-color 0.3s;
            font-weight: bold;
        }
        .dock-btn:hover {
            background-color: #00e676;
            color: #1a1a1a;
        }
        .dock-tracks-container {
            flex-grow: 1;
            overflow-y: auto;
            min-height: 200px; /* –ß—Ç–æ–±—ã –±—ã–ª–æ –≤–∏–¥–Ω–æ –æ–±–ª–∞—Å—Ç—å –¥–ª—è –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏—è */
        }
        .dock-track-item {
            background-color: #3a3a3a;
            border-radius: 5px;
            padding: 10px;
            margin-bottom: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.9em;
            cursor: grab;
            border-left: 4px solid #33aaff; /* –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –ø–ª–µ–π–ª–∏—Å—Ç–∞ */
        }
        .dock-track-item:active {
            cursor: grabbing;
        }
        .dock-track-item.dragging {
            opacity: 0.5;
            background: #555;
        }
        /* üîß –ù–û–í–´–ô –°–¢–ò–õ–¨: –ü–ª–∞–≤–Ω—ã–π –ø–µ—Ä–µ—Ö–æ–¥ –∏ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –¥—Ä–æ–ø-–∑–æ–Ω—ã */
        .dock-track-item {
            transition: transform 0.2s ease-in-out, background-color 0.2s;
        }
        .drop-indicator {
            height: 4px;
            background-color: #00e676;
            border-radius: 2px;
            margin: 4px 0;
            transition: all 0.2s;
        }
        .dock-summary {
            padding: 10px 20px;
            border-top: 1px solid #4a4a4a;
            text-align: right;
            font-weight: bold;
            font-size: 1.1em;
            color: #00e676;
        }
        .dock-summary span {
            color: #888;
        }
        .dock-track-count {
            color: #00e676;
        }
        .dock-duration {
            color: #00e676;
        }

        /* üîß –ù–û–í–´–ï –°–¢–ò–õ–ò: –≠–ª–µ–º–µ–Ω—Ç—ã –∏—Å—Ç–æ—Ä–∏–∏ */
        .history-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        .history-item {
            background-color: #3a3a3a;
            border-radius: 5px;
            padding: 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
            transition: background-color 0.2s, transform 0.2s;
        }
        .history-item:hover {
            background-color: #4a4a4a;
            transform: translateY(-2px);
        }
        .history-track {
            font-weight: bold;
            color: #eee;
            flex-grow: 1;
        }
        .history-time {
            font-size: 0.8em;
            color: #888;
            margin-right: 10px;
        }
        .add-to-current-btn {
            background: none;
            border: none;
            color: #33aaff;
            font-size: 1.2em;
            cursor: pointer;
            padding: 5px;
            border-radius: 3px;
            transition: background-color 0.2s, color 0.2s;
        }
        .add-to-current-btn:hover {
            background-color: rgba(51, 170, 255, 0.2);
            color: #66ccff;
        }

        /* üîß –°–¢–ò–õ–ò –î–õ–Ø –ö–ù–û–ü–û–ö –í –¢–†–ï–ù–î–ê–• */
        .trend-add-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            font-size: 1em;
            z-index: 2;
        }
        .trends-suggestions-column .track-card {
            position: relative; /* –î–ª—è –ø–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –∫–Ω–æ–ø–∫–∏ */
        }

        /* üîß –ê–î–ê–ü–¢–ò–í–ù–û–°–¢–¨: –°–∂–∞—Ç–∏–µ –ø–æ–∏—Å–∫–∞ –ø—Ä–∏ –∞–∫—Ç–∏–≤–Ω–æ–º –¥–æ–∫–µ */
        .search-column-compressed {
            flex: 0.7; /* –°–∂–∏–º–∞–µ–º –∫–æ–ª–æ–Ω–∫—É –ø–æ–∏—Å–∫–∞ */
            transition: flex 0.3s ease-in-out;
        }

        /* üîß –í–ò–ó–£–ê–õ–¨–ù–´–ï –≠–§–§–ï–ö–¢–´: –†–µ–∂–∏–º –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–∞ */
        .catalog-column.building-mode {
            border: 2px solid #00e676;
            box-shadow: 0 0 15px rgba(0, 230, 118, 0.3);
            transition: border 0.3s, box-shadow 0.3s;
        }

        /* üîß –ê–ù–ò–ú–ê–¶–ò–Ø: –ü—É–ª—å—Å–∞—Ü–∏—è –∫–Ω–æ–ø–æ–∫ ‚ûï –≤ —Ä–µ–∂–∏–º–µ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–∞ */
        .add-btn-pulse {
            animation: pulse-green 1.5s infinite;
        }

        @keyframes pulse-green {
            0% { 
                background-color: rgba(51, 170, 255, 0.1);
                transform: scale(1);
            }
            50% { 
                background-color: rgba(0, 230, 118, 0.3);
                transform: scale(1.1);
            }
            100% { 
                background-color: rgba(51, 170, 255, 0.1);
                transform: scale(1);
            }
        }

        /* üîß –°–¢–ò–õ–ò: –¢—Ä–µ–∫–∏ –≤ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–µ */
        .constructor-track-item {
            background-color: #3a3a3a;
            border-radius: 5px;
            padding: 10px;
            margin-bottom: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.9em;
            cursor: grab;
            border-left: 4px solid #00e676;
            transition: transform 0.2s ease-in-out, background-color 0.2s;
        }
        .constructor-track-item:active {
            cursor: grabbing;
        }
        .constructor-track-item.dragging {
            opacity: 0.5;
            background: #555;
        }
        .constructor-track-item:hover {
            background-color: #4a4a4a;
            transform: translateY(-2px);
        }

        .constructor-summary {
            padding: 10px 0;
            border-top: 1px solid #4a4a4a;
            text-align: right;
            font-weight: bold;
            font-size: 1em;
            color: #00e676;
        }

        /* üîß –û–í–ï–†–õ–ï–ô –î–õ–Ø –ó–ê–¢–ï–ú–ù–ï–ù–ò–Ø –ü–†–ò –û–¢–ö–†–´–¢–û–ú –î–û–ö–ï */
        .dock-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 999;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s, visibility 0.3s;
        }
        .dock-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        /* üîß –ù–û–í–´–ï –°–¢–ò–õ–ò: –ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä –ü–ª–µ–π–ª–∏—Å—Ç–∞ */
        .playlist-constructor {
            display: flex;
            flex-direction: column;
            gap: 15px;
            padding: 15px;
            border-top: 1px solid #4a4a4a;
            border-bottom: 1px solid #4a4a4a;
        }
        .constructor-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 10px;
        }
        .playlist-name-input {
            flex-grow: 1;
            padding: 10px;
            border: 1px solid #555;
            border-radius: 8px;
            background-color: #3a3a3a;
            color: #f0f0f0;
            font-size: 1.1em;
            box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.3);
            outline: none;
            transition: border-color 0.3s, box-shadow 0.3s;
        }
        .playlist-name-input:focus {
            border-color: #00e676;
            box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.3), 0 0 8px rgba(0, 230, 118, 0.5);
        }
        .constructor-controls {
            display: flex;
            gap: 10px;
        }
        .constructor-btn {
            background-color: #4a4a4a;
            color: #f0f0f0;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1em;
            transition: background-color 0.3s, color 0.3s;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }
        .constructor-btn:hover {
            background-color: #00e676;
            color: #1a1a1a;
        }
        .constructor-btn.confirm-btn {
            color: #00e676;
        }
        .constructor-btn.confirm-btn:hover {
            background-color: #00e676;
            color: #1a1a1a;
        }
        .constructor-btn.cancel-btn {
            color: #ff5555;
        }
        .constructor-btn.cancel-btn:hover {
            background-color: #ff5555;
            color: #1a1a1a;
        }
        .constructor-tracks {
            flex-grow: 1;
            overflow-y: auto;
            min-height: 200px; /* –ß—Ç–æ–±—ã –±—ã–ª–æ –≤–∏–¥–Ω–æ –æ–±–ª–∞—Å—Ç—å –¥–ª—è –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏—è */
        }
        .drop-zone-message {
            text-align: center;
            padding: 50px 20px;
            color: #888;
        }
        .drop-zone-message .drop-icon {
            font-size: 3em;
            margin-bottom: 15px;
        }
        .drop-zone-message p {
            font-size: 1em;
            margin-bottom: 20px;
            color: #bbb;
        }
        .saved-playlists {
            margin-top: 20px;
        }
        .playlist-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 15px;
            margin-bottom: 10px;
            background-color: #3a3a3a;
            border-radius: 5px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.2);
            transition: background-color 0.2s; /* üîß –ù–û–í–û–ï: –ü–ª–∞–≤–Ω—ã–π –ø–µ—Ä–µ—Ö–æ–¥ –¥–ª—è –ø–æ–¥—Å–≤–µ—Ç–∫–∏ */
            cursor: pointer; /* üîß –ù–û–í–û–ï: –ö—É—Ä—Å–æ—Ä-—É–∫–∞–∑–∞—Ç–µ–ª—å */
        }
        .playlist-item:hover {
            background-color: #4a4a4a; /* üîß –ù–û–í–û–ï: –ü–æ–¥—Å–≤–µ—Ç–∫–∞ –ø—Ä–∏ –Ω–∞–≤–µ–¥–µ–Ω–∏–∏ */
        }
        .playlist-item:hover .playlist-title {
            color: #00e676; /* üîß –ù–û–í–û–ï: –í—ã–¥–µ–ª—è–µ–º –∑–∞–≥–æ–ª–æ–≤–æ–∫ —Ü–≤–µ—Ç–æ–º */
        }
        .playlist-item:last-child {
            margin-bottom: 0;
        }
        .playlist-info {
            flex-grow: 1;
        }
        .playlist-title {
            font-weight: bold;
            color: #eee;
            font-size: 1.05em;
            margin-bottom: 3px;
        }
        .playlist-meta {
            font-size: 0.8em;
            color: #888;
        }
        .playlist-actions {
            display: flex;
            gap: 10px;
        }
        .playlist-action-btn {
            background: none;
            border: none;
            color: #bbb;
            font-size: 1.2em;
            cursor: pointer;
            padding: 5px;
            border-radius: 3px;
            transition: background-color 0.2s, color 0.2s;
        }
        .playlist-action-btn:hover {
            background-color: rgba(170, 170, 170, 0.2);
            color: #fff;
        }
        .create-playlist-btn {
            background-color: #00e676;
            color: #1a1a1a;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1em;
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 10px;
            transition: background-color 0.3s, transform 0.2s;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        }
        .create-playlist-btn:hover {
            background-color: #00cc66;
            transform: translateY(-2px);
        }
        .create-playlist-btn:active {
            transform: translateY(0);
        }
        .btn-icon {
            font-size: 1.2em;
        }
        .btn-text {
            font-size: 0.9em;
        }

        /* üîß –ù–û–í–´–ï –°–¢–ò–õ–ò: –ü—Ä–µ–¥–ø—Ä–æ—Å–ª—É—à–∫–∞ */
        .preview-player {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            background-color: #2a2a2a;
            border-top: 1px solid #4a4a4a;
            box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.3);
            z-index: 10;
            display: flex;
            flex-direction: column;
            transform: translateY(100%); /* –°–∫—Ä—ã–≤–∞–µ–º –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é */
            transition: transform 0.3s ease-in-out;
        }
        .preview-player.active {
            transform: translateY(0);
        }
        .preview-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 15px;
            border-bottom: 1px solid #4a4a4a;
            background-color: #3a3a3a;
            border-radius: 8px 8px 0 0;
        }
        .preview-track-info {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .preview-title {
            font-weight: bold;
            color: #eee;
            font-size: 1.05em;
        }
        .preview-artist {
            font-size: 0.8em;
            color: #aaa;
        }
        .preview-close {
            background: none;
            border: none;
            color: #f0f0f0;
            font-size: 1.5em;
            cursor: pointer;
            transition: color 0.3s;
        }
        .preview-close:hover {
            color: #ff5555;
        }
        .preview-waveform {
            flex-grow: 1;
            width: 100%;
            height: 100px; /* –í—ã—Å–æ—Ç–∞ –¥–ª—è –≤–æ–ª–Ω—ã */
            background-color: #1a1a1a;
            border-bottom: 1px solid #4a4a4a;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .preview-controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 15px;
            border-top: 1px solid #4a4a4a;
            background-color: #3a3a3a;
            border-radius: 0 0 8px 8px;
        }
        .preview-control-btn {
            background: none;
            border: none;
            color: #00e676;
            font-size: 1.5em;
            cursor: pointer;
            transition: color 0.3s;
        }
        .preview-control-btn:hover {
            color: #00ff8c;
        }
        .preview-time {
            font-size: 0.9em;
            color: #888;
        }
        .preview-current, .preview-total {
            font-weight: bold;
            color: #00e676;
        }
        /* üîß –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏–µ –≤—ã–¥–µ–ª–µ–Ω–∏—è —Ç–µ–∫—Å—Ç–∞ –ø—Ä–∏ DnD */
        .track-item, .search-result-item {
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
        }

        /* üîß –ù–û–í–´–ï –°–¢–ò–õ–ò: Drag & Drop –≤–∏–∑—É–∞–ª—å–Ω—ã–µ —ç—Ñ—Ñ–µ–∫—Ç—ã */
        .track-item.dragging, .search-result-item.dragging {
            opacity: 0.5;
            transform: rotate(2deg);
            background-color: #4a4a4a;
        }

        /* üîß –î–†–û–ü-–ó–û–ù–ê: –ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä –≥–æ—Ç–æ–≤ –∫ –ø—Ä–∏–µ–º—É */
        .constructor-tracks.drag-over {
            background-color: rgba(0, 230, 118, 0.1);
            border: 2px dashed #00e676;
            border-radius: 8px;
        }

        .drop-zone-message.drag-over {
            color: #00e676;
            transform: scale(1.1);
        }

        /* üîß –ù–û–í–´–ï –°–¢–ò–õ–ò: –¢–µ–≥–∏ –ø–ª–µ–π–ª–∏—Å—Ç–æ–≤ –Ω–∞ —Ç—Ä–µ–∫–∞—Ö */
        .playlist-tag-container {
            display: flex;
            gap: 4px;
            align-items: center;
        }
        .playlist-tag {
            background-color: #555;
            color: #ccc;
            border-radius: 4px;
            padding: 2px 6px;
            font-size: 0.7em;
            font-weight: bold;
            cursor: pointer;
            transition: background-color 0.2s, color 0.2s;
            position: relative;
        }
        .playlist-tag:hover {
            background-color: #00e676;
            color: #1a1a1a;
        }

        /* üîß –ù–û–í–´–ï –°–¢–ò–õ–ò: –í—Å–ø–ª—ã–≤–∞—é—â–∞—è –ø–æ–¥—Å–∫–∞–∑–∫–∞ (Tooltip) */
        .playlist-tooltip {
            position: absolute;
            bottom: 120%;
            left: 50%;
            transform: translateX(-50%);
            background-color: #1a1a1a;
            color: #f0f0f0;
            padding: 10px;
            border-radius: 8px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.5);
            z-index: 2000; /* –≤—ã—à–µ –ø–æ–∏—Å–∫–æ–≤–æ–π —Å—Ç—Ä–æ–∫–∏ */
            width: max-content;
            min-width: 150px;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.2s, bottom 0.2s, top 0.2s;
            pointer-events: none;
        }
        .playlist-tooltip.visible {
            opacity: 1;
            visibility: visible;
            bottom: 130%;
        }
        /* –í–∞—Ä–∏–∞–Ω—Ç —Ç—É–ª—Ç–∏–ø–∞, –∫–æ—Ç–æ—Ä—ã–π –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è –≤–Ω–∏–∑ */
        .playlist-tooltip.below {
            bottom: auto;
            top: 120%;
        }
        .playlist-tooltip.below.visible {
            top: 130%;
        }
        .playlist-tooltip h4 {
            margin: 0 0 8px 0;
            font-size: 1em;
            color: #00e676;
            border-bottom: 1px solid #4a4a4a;
            padding-bottom: 5px;
        }
        .playlist-tooltip ul {
            margin: 0;
            padding: 0 0 0 15px;
            list-style: 'üéµ  ';
        }
        .playlist-tooltip li {
            margin-bottom: 4px;
            font-size: 0.9em;
        }

        /* üéµ UPLOAD MODE STYLES - –°–∏—Å—Ç–µ–º–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ç—Ä–µ–∫–æ–≤ */
        .upload-mode-container {
            display: none; /* –°–∫—Ä—ã—Ç –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é */
            flex-direction: column;
            gap: 20px;
            padding: 20px 0;
        }
        
        .upload-mode-container.active {
            display: flex;
        }
        
        /* –ö–Ω–æ–ø–∫–∞ –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ Upload Mode */
        .upload-mode-trigger {
            background: linear-gradient(135deg, #00e676, #00c853);
            color: #1a1a1a;
            border: none;
            padding: 15px 25px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1.1em;
            font-weight: bold;
            text-transform: uppercase;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0, 230, 118, 0.3);
            margin: 10px 0;
        }
        
        .upload-mode-trigger:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 230, 118, 0.4);
        }
        
        /* –ó–∞–≥–æ–ª–æ–≤–æ–∫ —Ä–µ–∂–∏–º–∞ –∑–∞–≥—Ä—É–∑–∫–∏ */
        .upload-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding-bottom: 15px;
            border-bottom: 2px solid #00e676;
        }
        
        .upload-title {
            font-size: 1.4em;
            color: #00e676;
            font-weight: bold;
        }
        
        .upload-back-btn {
            background: #4a4a4a;
            color: #f0f0f0;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        
        .upload-back-btn:hover {
            background-color: #666;
        }
        
        /* –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ–∞–π–ª–æ–≤—ã–µ —è—á–µ–π–∫–∏ */
        .upload-cells {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }
        
        .upload-cell {
            background-color: #333;
            border: 2px dashed #555;
            border-radius: 8px;
            padding: 20px;
            text-align: center;
            transition: all 0.3s ease;
            cursor: pointer;
            position: relative;
            min-height: 120px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }
        
        .upload-cell:hover {
            border-color: #00e676;
            background-color: #2a3a2a;
        }
        
        .upload-cell.drag-over {
            border-color: #00e676;
            background-color: rgba(0, 230, 118, 0.1);
            transform: scale(1.02);
        }
        
        .upload-cell.has-file {
            border-color: #00e676;
            border-style: solid;
            background-color: #1a2a1a;
        }
        
        .upload-cell.processing {
            border-color: #ffab00;
            background-color: #2a2a1a;
        }
        
        .upload-cell.error {
            border-color: #f44336;
            background-color: #2a1a1a;
        }
        
        /* –õ–∏—Ä–∏–∫–∞ –∑–∞–Ω–∏–º–∞–µ—Ç –≤—Å—é —à–∏—Ä–∏–Ω—É */
        .upload-cell.lyrics-cell {
            grid-column: span 2;
        }
        
        .cell-icon {
            font-size: 2.5em;
            margin-bottom: 10px;
            opacity: 0.7;
        }
        
        .cell-title {
            font-weight: bold;
            margin-bottom: 5px;
            color: #f0f0f0;
        }
        
        .cell-subtitle {
            font-size: 0.9em;
            color: #888;
            margin-bottom: 10px;
        }
        
        .cell-status {
            font-size: 0.8em;
            margin-top: 10px;
            padding: 5px 10px;
            border-radius: 15px;
            background-color: #4a4a4a;
            color: #f0f0f0;
        }
        
        .cell-status.processing {
            background-color: #ff9800;
            color: #1a1a1a;
            animation: pulse 1.5s infinite;
        }
        
        .cell-status.success {
            background-color: #4caf50;
            color: #1a1a1a;
        }
        
        .cell-status.error {
            background-color: #f44336;
            color: #fff;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
        
        /* –ü—Ä–æ–≥—Ä–µ—Å—Å –±–∞—Ä –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ */
        .upload-progress {
            width: 100%;
            height: 4px;
            background-color: #555;
            border-radius: 2px;
            margin-top: 10px;
            overflow: hidden;
        }
        
        .upload-progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #00e676, #00c853);
            border-radius: 2px;
            transition: width 0.3s ease;
            width: 0%;
        }
        
        /* –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∫–Ω–æ–ø–∫–∏ */
        .upload-additional {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }
        
        .upload-additional-btn {
            background-color: #4a4a4a;
            color: #f0f0f0;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.9em;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .upload-additional-btn:hover {
            background-color: #666;
            transform: translateY(-1px);
        }
        
        .upload-additional-btn.json-btn:hover {
            background-color: #2196f3;
        }
        
        .upload-additional-btn.stems-btn:hover {
            background-color: #9c27b0;
        }
        
        /* JSON Preview Panel */
        .json-preview {
            display: none;
            background-color: #2a2a2a;
            border: 1px solid #4a4a4a;
            border-radius: 8px;
            padding: 15px;
            margin-top: 15px;
        }
        
        .json-preview.active {
            display: block;
        }
        
        .json-preview-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .json-preview-title {
            font-weight: bold;
            color: #00e676;
        }
        
        .json-preview-actions {
            display: flex;
            gap: 10px;
        }
        
        .json-preview-btn {
            background: #4a4a4a;
            color: #f0f0f0;
            border: none;
            padding: 5px 10px;
            border-radius: 3px;
            cursor: pointer;
            font-size: 0.8em;
        }
        
        .json-preview-btn.apply:hover {
            background-color: #4caf50;
        }
        
        .json-preview-btn.revert:hover {
            background-color: #f44336;
        }
        
        .json-markers-list {
            max-height: 150px;
            overflow-y: auto;
            background-color: #1a1a1a;
            border: 1px solid #333;
            border-radius: 5px;
            padding: 10px;
        }
        
        .json-marker-item {
            display: flex;
            justify-content: space-between;
            padding: 5px 0;
            border-bottom: 1px solid #333;
            font-size: 0.9em;
        }
        
        .json-marker-item:last-child {
            border-bottom: none;
        }
        
        .marker-time {
            color: #00e676;
            font-weight: bold;
        }
        
        .marker-text {
            color: #f0f0f0;
        }
        
        /* Final Upload Actions */
        .upload-final-actions {
            display: none;
            padding-top: 20px;
            border-top: 1px solid #4a4a4a;
            margin-top: 20px;
        }
        
        .upload-final-actions.show {
            display: block;
        }
        
        .track-metadata {
            background-color: #333;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
        }
        
        .metadata-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
        }
        
        .metadata-label {
            color: #888;
            font-weight: bold;
        }
        
        .metadata-value {
            color: #f0f0f0;
        }
        
        .upload-final-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
        }
        
        .upload-final-btn {
            padding: 12px 25px;
            border: none;
            border-radius: 8px;
            font-size: 1em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            text-transform: uppercase;
        }
        
        .upload-final-btn.save {
            background: linear-gradient(135deg, #00e676, #00c853);
            color: #1a1a1a;
        }
        
        .upload-final-btn.save:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 230, 118, 0.4);
        }
        
        .upload-final-btn.cancel {
            background: #666;
            color: #f0f0f0;
        }
        
        .upload-final-btn.cancel:hover {
            background: #888;
        }
    </style>
</head>
<body>
    <div class="mode-nav">
        <button class="mode-btn">–ö–û–ù–¶–ï–†–¢–ù–´–ô</button>
        <button class="mode-btn">–ö–ê–†–ê–û–ö–ï</button>
        <button class="mode-btn active">–†–ï–ü–ï–¢–ò–¶–ò–Ø</button>
        <button class="mode-btn">LIVE</button>
        <button class="mode-btn">–ö–ê–¢–ê–õ–û–ì</button>
    </div>

    <div class="catalog-main-content">
        <!-- –ü–µ—Ä–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞: My Music / My Box -->
        <div class="catalog-column my-music-column">
            <h2 class="column-header">–ú–æ—è –ú—É–∑—ã–∫–∞</h2>
            <div id="my-music-list">
                <!-- –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –∑–∞–≥—Ä—É–∂–∞–µ–º—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç –±—É–¥–µ—Ç –∑–¥–µ—Å—å -->
            </div>
        </div>

        <!-- –í—Ç–æ—Ä–∞—è –∫–æ–ª–æ–Ω–∫–∞: –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∞—è —Å —Ç–∞–±–∞–º–∏ -->
        <div class="catalog-column center-dynamic-column">
            <!-- –¢–∞–±—ã –¥–ª—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –∫–æ–Ω—Ç–µ–Ω—Ç–∞ -->
            <div class="tab-navigation">
                <button class="tab-btn active" data-tab="playlists">–ü–ª–µ–π–ª–∏—Å—Ç—ã</button>
                <button class="tab-btn" data-tab="history">–ò—Å—Ç–æ—Ä–∏—è</button>
                <button class="tab-btn" data-tab="trends">–¢—Ä–µ–Ω–¥—ã</button>
            </div>

            <!-- –ö–æ–Ω—Ç–µ–Ω—Ç —Ç–∞–±–æ–≤ -->
            <div class="tab-content">
                <!-- –¢–∞–±: –ü–ª–µ–π–ª–∏—Å—Ç—ã -->
                <div class="tab-panel active" id="playlists-panel">
                    <!-- –ö–Ω–æ–ø–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –Ω–æ–≤–æ–≥–æ –ø–ª–µ–π–ª–∏—Å—Ç–∞ -->
                    <div class="create-playlist-section">
                        <button class="create-playlist-btn" id="create-playlist-btn">
                            <span class="btn-icon">üìÇ</span>
                            <span class="btn-text">–°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π —Å–µ—Ç-–ª–∏—Å—Ç</span>
                        </button>
                    </div>

                    <!-- –û–±–ª–∞—Å—Ç—å –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–∞ (—Å–∫—Ä—ã—Ç–∞ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é) -->
                    <div class="playlist-constructor" id="playlist-constructor" style="display: none;">
                        <div class="constructor-header">
                            <input type="text" class="playlist-name-input" id="playlist-name-input" 
                                   placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ —Å–µ—Ç-–ª–∏—Å—Ç–∞..." value="–ù–æ–≤—ã–π —Å–µ—Ç-–ª–∏—Å—Ç">
                            <div class="constructor-controls">
                                <button class="constructor-btn confirm-btn" id="confirm-playlist" title="–°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Å–µ—Ç-–ª–∏—Å—Ç">‚úÖ</button>
                                <button class="constructor-btn cancel-btn" id="cancel-playlist" title="–û—Ç–º–µ–Ω–∏—Ç—å">‚ùå</button>
                            </div>
                        </div>
                        <div class="constructor-tracks" id="constructor-tracks">
                            <div class="drop-zone-message">
                                <span class="drop-icon">üéµ</span>
                                <p>–î–æ–±–∞–≤–ª—è–π—Ç–µ —Ç—Ä–µ–∫–∏ –∫–Ω–æ–ø–∫–æ–π ‚ûï –∏–ª–∏ –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏–µ–º</p>
                            </div>
                        </div>
                        <div class="constructor-summary">
                            –¢—Ä–µ–∫–æ–≤: <span id="constructor-track-count">0</span> | 
                            –í—Ä–µ–º—è: <span id="constructor-duration">00:00</span>
                        </div>
                    </div>

                    <!-- –°–ø–∏—Å–æ–∫ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã—Ö –ø–ª–µ–π–ª–∏—Å—Ç–æ–≤ -->
                    <div class="saved-playlists" id="saved-playlists">
                        <!-- –ü–ª–µ–π–ª–∏—Å—Ç—ã –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª—è—Ç—å—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –Ω–∏–∂–µ -->
                    </div>
                </div>

                <!-- –¢–∞–±: –ò—Å—Ç–æ—Ä–∏—è -->
                <div class="tab-panel" id="history-panel">
                    <div class="section-title">üïí –ù–µ–¥–∞–≤–Ω–æ –ø—Ä–æ–∏–≥—Ä–∞–Ω–Ω—ã–µ</div>
                    <div class="history-list">
                        <div class="history-item">
                            <span class="history-track">Bohemian Rhapsody - Queen</span>
                            <span class="history-time">2 —á–∞—Å–∞ –Ω–∞–∑–∞–¥</span>
                            <button class="add-to-current-btn" title="–î–æ–±–∞–≤–∏—Ç—å –≤ —Ç–µ–∫—É—â–∏–π —Å–µ—Ç-–ª–∏—Å—Ç">‚ûï</button>
                        </div>
                        <div class="history-item">
                            <span class="history-track">Stairway to Heaven - Led Zeppelin</span>
                            <span class="history-time">–í—á–µ—Ä–∞</span>
                            <button class="add-to-current-btn" title="–î–æ–±–∞–≤–∏—Ç—å –≤ —Ç–µ–∫—É—â–∏–π —Å–µ—Ç-–ª–∏—Å—Ç">‚ûï</button>
                        </div>
                        <div class="history-item">
                            <span class="history-track">New Divide - Linkin Park</span>
                            <span class="history-time">2 –¥–Ω—è –Ω–∞–∑–∞–¥</span>
                            <button class="add-to-current-btn" title="–î–æ–±–∞–≤–∏—Ç—å –≤ —Ç–µ–∫—É—â–∏–π —Å–µ—Ç-–ª–∏—Å—Ç">‚ûï</button>
                        </div>
                    </div>
                </div>

                <!-- –¢–∞–±: –¢—Ä–µ–Ω–¥—ã -->
                <div class="tab-panel" id="trends-panel">
            <div class="section-title">üìà –¢—Ä–µ–Ω–¥—ã</div>
            <div class="track-card">
                <div class="album-art-placeholder"></div>
                <div class="track-details">
                    <div class="title">Bohemian Rhapsody</div>
                    <div class="artist">Queen</div>
                </div>
                        <button class="add-to-current-btn trend-add-btn" title="–î–æ–±–∞–≤–∏—Ç—å –≤ —Ç–µ–∫—É—â–∏–π —Å–µ—Ç-–ª–∏—Å—Ç">‚ûï</button>
                <div class="trend-indicator"></div>
            </div>
            <div class="track-card">
                <div class="album-art-placeholder"></div>
                <div class="track-details">
                    <div class="title">Stairway to Heaven</div>
                    <div class="artist">Led Zeppelin</div>
                </div>
                        <button class="add-to-current-btn trend-add-btn" title="–î–æ–±–∞–≤–∏—Ç—å –≤ —Ç–µ–∫—É—â–∏–π —Å–µ—Ç-–ª–∏—Å—Ç">‚ûï</button>
                <div class="trend-indicator"></div>
            </div>
            <div class="track-card">
                <div class="album-art-placeholder"></div>
                <div class="track-details">
                    <div class="title">Shape of You</div>
                    <div class="artist">Ed Sheeran</div>
                </div>
                        <button class="add-to-current-btn trend-add-btn" title="–î–æ–±–∞–≤–∏—Ç—å –≤ —Ç–µ–∫—É—â–∏–π —Å–µ—Ç-–ª–∏—Å—Ç">‚ûï</button>
                <div class="trend-indicator"></div>
            </div>

                    <div class="section-title" style="margin-top: 20px;">üí° –ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è –¥–ª—è —Ç–µ–±—è</div>
            <div class="track-card">
                <div class="album-art-placeholder"></div>
                <div class="track-details">
                    <div class="title">Yesterday</div>
                    <div class="artist">The Beatles</div>
                </div>
                        <button class="add-to-current-btn trend-add-btn" title="–î–æ–±–∞–≤–∏—Ç—å –≤ —Ç–µ–∫—É—â–∏–π —Å–µ—Ç-–ª–∏—Å—Ç">‚ûï</button>
            </div>
            <div class="track-card">
                <div class="album-art-placeholder"></div>
                <div class="track-details">
                    <div class="title">Hallelujah</div>
                    <div class="artist">Leonard Cohen</div>
                </div>
                        <button class="add-to-current-btn trend-add-btn" title="–î–æ–±–∞–≤–∏—Ç—å –≤ —Ç–µ–∫—É—â–∏–π —Å–µ—Ç-–ª–∏—Å—Ç">‚ûï</button>
            </div>
                </div>
            </div>
                </div>

        <!-- –¢—Ä–µ—Ç—å—è –∫–æ–ª–æ–Ω–∫–∞: –£–º–Ω—ã–π –ü–æ–∏—Å–∫ (—Å–∂–∏–º–∞–µ—Ç—Å—è –ø—Ä–∏ –∞–∫—Ç–∏–≤–Ω–æ–º —Å–µ—Ç-–ª–∏—Å—Ç–µ) -->
        <div class="catalog-column smart-search-column" id="search-column">
            <input type="text" placeholder="–ü–æ–∏—Å–∫ —Ç—Ä–µ–∫–æ–≤, –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª–µ–π, —Ç–µ–∫—Å—Ç–æ–≤..." id="search-input">
            
            <!-- üéµ –ù–û–í–´–ô –ë–õ–û–ö: –ö–Ω–æ–ø–∫–∞ –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ Upload Mode -->
            <button class="upload-mode-trigger" id="upload-mode-trigger">
                üìÅ –ó–∞–≥—Ä—É–∑–∏—Ç—å –ù–æ–≤—ã–π –¢—Ä–µ–∫
            </button>
            
            <!-- üéµ –ù–û–í–´–ô –ë–õ–û–ö: Upload Mode Container -->
            <div class="upload-mode-container" id="upload-mode-container">
                <div class="upload-header">
                    <div class="upload-title">üìÅ –ó–∞–≥—Ä—É–∑–∫–∞ –ù–æ–≤–æ–≥–æ –¢—Ä–µ–∫–∞</div>
                    <button class="upload-back-btn" id="upload-back-btn">‚Üê –ù–∞–∑–∞–¥ –∫ –ø–æ–∏—Å–∫—É</button>
            </div>
                
                <!-- –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ–∞–π–ª–æ–≤—ã–µ —è—á–µ–π–∫–∏ -->
                <div class="upload-cells">
                    <!-- –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞–ª—å–Ω–∞—è –¥–æ—Ä–æ–∂–∫–∞ -->
                    <div class="upload-cell" id="instrumental-cell" data-file-type="instrumental">
                        <div class="cell-icon">üéµ</div>
                        <div class="cell-title">–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞–ª</div>
                        <div class="cell-subtitle">MP3, WAV, FLAC</div>
                        <div class="cell-status">–ü–µ—Ä–µ—Ç–∞—â–∏—Ç–µ –∏–ª–∏ –∫–ª–∏–∫–Ω–∏—Ç–µ</div>
                        <div class="upload-progress">
                            <div class="upload-progress-bar"></div>
                </div>
                        <input type="file" accept="audio/*" style="display: none;" id="instrumental-input">
            </div>
                    
                    <!-- –í–æ–∫–∞–ª—å–Ω–∞—è –¥–æ—Ä–æ–∂–∫–∞ -->
                    <div class="upload-cell" id="vocal-cell" data-file-type="vocal">
                        <div class="cell-icon">üé§</div>
                        <div class="cell-title">–í–æ–∫–∞–ª</div>
                        <div class="cell-subtitle">MP3, WAV, FLAC</div>
                        <div class="cell-status">–ü–µ—Ä–µ—Ç–∞—â–∏—Ç–µ –∏–ª–∏ –∫–ª–∏–∫–Ω–∏—Ç–µ</div>
                        <div class="upload-progress">
                            <div class="upload-progress-bar"></div>
                        </div>
                        <input type="file" accept="audio/*" style="display: none;" id="vocal-input">
        </div>

                    <!-- –õ–∏—Ä–∏–∫–∞ -->
                    <div class="upload-cell lyrics-cell" id="lyrics-cell" data-file-type="lyrics">
                        <div class="cell-icon">üìù</div>
                        <div class="cell-title">–õ–∏—Ä–∏–∫–∞</div>
                        <div class="cell-subtitle">RTF, TXT, LRC</div>
                        <div class="cell-status">–ü–µ—Ä–µ—Ç–∞—â–∏—Ç–µ –∏–ª–∏ –∫–ª–∏–∫–Ω–∏—Ç–µ</div>
                        <div class="upload-progress">
                            <div class="upload-progress-bar"></div>
                </div>
                        <input type="file" accept=".rtf,.txt,.lrc" style="display: none;" id="lyrics-input">
                </div>
                </div>
                
                <!-- –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∫–Ω–æ–ø–∫–∏ -->
                <div class="upload-additional">
                    <button class="upload-additional-btn json-btn" id="add-json-btn">
                        üìä –î–æ–±–∞–≤–∏—Ç—å JSON
                        <input type="file" accept=".json" style="display: none;" id="json-input">
                    </button>
                    <button class="upload-additional-btn stems-btn" id="add-stems-btn">
                        ü•Å –¢—Ä–∏–≥–µ—Ä—ã (stems)
                        <input type="file" accept="audio/*" multiple style="display: none;" id="stems-input">
                    </button>
                </div>
                
                <!-- JSON Preview Panel -->
                <div class="json-preview" id="json-preview">
                    <div class="json-preview-header">
                        <div class="json-preview-title">üîç –ü—Ä–µ–≤—å—é –º–∞—Ä–∫–µ—Ä–æ–≤ JSON</div>
                        <div class="json-preview-actions">
                            <button class="json-preview-btn apply" id="json-apply">‚úÖ –ü—Ä–∏–º–µ–Ω–∏—Ç—å</button>
                            <button class="json-preview-btn revert" id="json-revert">‚ùå –û—Ç–º–µ–Ω–∏—Ç—å</button>
                </div>
                </div>
                    <div class="json-markers-list" id="json-markers-list">
                        <!-- –ú–∞—Ä–∫–µ—Ä—ã –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                </div>
                </div>
                
                <!-- –§–∏–Ω–∞–ª—å–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è -->
                <div class="upload-final-actions" id="upload-final-actions">
                    <div class="track-metadata" id="track-metadata">
                        <div class="metadata-row">
                            <span class="metadata-label">–ù–∞–∑–≤–∞–Ω–∏–µ:</span>
                            <span class="metadata-value" id="track-title-meta">–ù–æ–≤—ã–π —Ç—Ä–µ–∫</span>
                </div>
                        <div class="metadata-row">
                            <span class="metadata-label">–ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å:</span>
                            <span class="metadata-value" id="track-artist-meta">–ù–µ–∏–∑–≤–µ—Å—Ç–µ–Ω</span>
                </div>
                        <div class="metadata-row">
                            <span class="metadata-label">–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:</span>
                            <span class="metadata-value" id="track-duration-meta">--:--</span>
                </div>
                        <div class="metadata-row">
                            <span class="metadata-label">–†–∞–∑–º–µ—Ä:</span>
                            <span class="metadata-value" id="track-size-meta">-- MB</span>
                        </div>
                    </div>
                    <div class="upload-final-buttons">
                        <button class="upload-final-btn save" id="upload-save-btn">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ –∫–∞—Ç–∞–ª–æ–≥</button>
                        <button class="upload-final-btn cancel" id="upload-cancel-btn">‚ùå –û—Ç–º–µ–Ω–∏—Ç—å</button>
            </div>
        </div>
    </div>
            
            <!-- üîß –ë–õ–û–ö: –ü—Ä–µ–¥–ø—Ä–æ—Å–ª—É—à–∫–∞ (—Å–∫—Ä—ã—Ç –≤ Upload Mode) -->
            <div class="preview-player" id="preview-player" style="display: none;">
                <div class="preview-header">
                    <div class="preview-track-info">
                        <div class="preview-title" id="preview-title">New Divide</div>
                        <div class="preview-artist" id="preview-artist">Linkin Park</div>
            </div>
                    <button class="preview-close" id="preview-close">‚úï</button>
                </div>
                <div class="preview-waveform" id="preview-waveform">
                    <!-- –ó–¥–µ—Å—å –±—É–¥–µ—Ç wavesurfer.js -->
            </div>
                <div class="preview-controls">
                    <button class="preview-control-btn" id="preview-play-pause">‚ñ∂Ô∏è</button>
                    <span class="preview-time">
                        <span id="preview-current">0:00</span> / <span id="preview-total">0:00</span>
                    </span>
                </div>
        </div>

            <div class="search-results" id="search-results">
                <!-- üîß –û–ë–ù–û–í–õ–ï–ù–ù–´–ï —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–∏—Å–∫–∞ -->
                <div class="search-result-item" draggable="true" data-track-id="New Divide-Linkin Park">
                    <div class="track-icon">üéµ</div>
                    <div class="track-details">
                        <div class="track-title">New Divide</div>
                        <div class="track-artist">Linkin Park</div>
                </div>
                    <div class="track-actions">
                        <button class="preview-btn" title="–ü—Ä–µ–¥–ø—Ä–æ—Å–ª—É—à–∫–∞">‚ñ∂Ô∏è</button>
                        <button class="add-to-setlist-btn" title="–î–æ–±–∞–≤–∏—Ç—å –≤ —Å–µ—Ç-–ª–∏—Å—Ç">‚ûï</button>
                </div>
                </div>
                <div class="search-result-item" draggable="true" data-track-id="When They Come For Me-Linkin Park">
                    <div class="track-icon">üé§</div>
                    <div class="track-details">
                        <div class="track-title">When They Come For Me</div>
                        <div class="track-artist">Linkin Park</div>
                </div>
                    <div class="track-actions">
                        <button class="preview-btn" title="–ü—Ä–µ–¥–ø—Ä–æ—Å–ª—É—à–∫–∞">‚ñ∂Ô∏è</button>
                        <button class="add-to-setlist-btn" title="–î–æ–±–∞–≤–∏—Ç—å –≤ —Å–µ—Ç-–ª–∏—Å—Ç">‚ûï</button>
                </div>
                </div>
                <div class="search-result-item" draggable="true" data-track-id="Love The Way You Lie-Eminem">
                    <div class="track-icon">‚úçÔ∏è</div>
                    <div class="track-details">
                        <div class="track-title">Love The Way You Lie</div>
                        <div class="track-artist">Eminem feat. Rihanna</div>
                </div>
                    <div class="track-actions">
                        <button class="preview-btn" title="–ü—Ä–µ–¥–ø—Ä–æ—Å–ª—É—à–∫–∞">‚ñ∂Ô∏è</button>
                        <button class="add-to-setlist-btn" title="–î–æ–±–∞–≤–∏—Ç—å –≤ —Å–µ—Ç-–ª–∏—Å—Ç">‚ûï</button>
                </div>
                </div>
                <div class="search-result-item" draggable="true" data-track-id="Dream On-Aerosmith">
                    <div class="track-icon">üéµ</div>
                    <div class="track-details">
                        <div class="track-title">Dream On</div>
                        <div class="track-artist">Aerosmith</div>
                </div>
                    <div class="track-actions">
                        <button class="preview-btn" title="–ü—Ä–µ–¥–ø—Ä–æ—Å–ª—É—à–∫–∞">‚ñ∂Ô∏è</button>
                        <button class="add-to-setlist-btn" title="–î–æ–±–∞–≤–∏—Ç—å –≤ —Å–µ—Ç-–ª–∏—Å—Ç">‚ûï</button>
                </div>
            </div>
                <div class="search-result-item" draggable="true" data-track-id="Bohemian Rhapsody-Queen">
                    <div class="track-icon">üé§</div>
                    <div class="track-details">
                        <div class="track-title">Bohemian Rhapsody</div>
                        <div class="track-artist">Queen</div>
                    </div>
                    <div class="track-actions">
                        <button class="preview-btn" title="–ü—Ä–µ–¥–ø—Ä–æ—Å–ª—É—à–∫–∞">‚ñ∂Ô∏è</button>
                        <button class="add-to-setlist-btn" title="–î–æ–±–∞–≤–∏—Ç—å –≤ —Å–µ—Ç-–ª–∏—Å—Ç">‚ûï</button>
                    </div>
                </div>
        </div>
    </div>

        <!-- üîß –£–î–ê–õ–ï–ù–û: –°—Ç–∞—Ä—ã–π –ø—Ä–∞–≤—ã–π –¥–æ–∫ –ø–æ–ª–Ω–æ—Å—Ç—å—é —É–±—Ä–∞–Ω -->
    </div>

    <!-- üîß –û–í–ï–†–õ–ï–ô –î–õ–Ø –ó–ê–¢–ï–ú–ù–ï–ù–ò–Ø -->
    <div class="dock-overlay" id="dock-overlay"></div>

    <script>
        // üöÄ –ù–û–í–ê–Ø –ê–†–•–ò–¢–ï–ö–¢–£–†–ê: EventBus + Modular System
        
        // üì° EventBus - –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ —Å–æ–±—ã—Ç–∏–π
        class EventBus {
            constructor() {
                this.events = {};
            }
            
            on(event, callback) {
                if (!this.events[event]) this.events[event] = [];
                this.events[event].push(callback);
            }
            
            emit(event, data) {
                if (this.events[event]) {
                    this.events[event].forEach(callback => callback(data));
                }
                console.log(`üì° Event: ${event}`, data);
            }
            
            off(event, callback) {
                if (this.events[event]) {
                    this.events[event] = this.events[event].filter(cb => cb !== callback);
                }
            }
        }

        // üóÇÔ∏è StateManager - –ì–ª–æ–±–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
        class StateManager {
            constructor() {
                this.state = {
                    isBuildingPlaylist: false,
                    currentBuildingPlaylist: [],
                    savedPlaylists: [], // üîß –ù–û–í–û–ï: –•—Ä–∞–Ω–∏–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ –ø–ª–µ–π–ª–∏—Å—Ç—ã
                    trackPlaylistMapping: {}, // üîß –ù–û–í–û–ï: –û—Ç—Å–ª–µ–∂–∏–≤–∞–µ–º —Ç—Ä–µ–∫–∏ –≤ –ø–ª–µ–π–ª–∏—Å—Ç–∞—Ö
                    addedTracks: new Set()
                };
            }
            
            setState(newState) {
                this.state = { ...this.state, ...newState };
                console.log('üóÇÔ∏è State updated:', this.state);
            }
            
            getState() {
                return this.state;
            }
        }

        // üéµ PlaylistBuilder - –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–æ–º –ø–ª–µ–π–ª–∏—Å—Ç–æ–≤
        class PlaylistBuilder {
            constructor(eventBus, stateManager) {
                this.eventBus = eventBus;
                this.stateManager = stateManager;
                this.elementBeingEdited = null; // üîß –ù–û–í–û–ï: –û—Ç—Å–ª–µ–∂–∏–≤–∞–µ–º —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–µ–º—ã–π –ø–ª–µ–π–ª–∏—Å—Ç
                this.initElements();
                this.initEvents();
            }
            
            initElements() {
                this.createBtn = document.getElementById('create-playlist-btn');
                this.constructor = document.getElementById('playlist-constructor');
                this.nameInput = document.getElementById('playlist-name-input');
                this.confirmBtn = document.getElementById('confirm-playlist');
                this.cancelBtn = document.getElementById('cancel-playlist');
                this.tracksContainer = document.getElementById('constructor-tracks');
                this.trackCount = document.getElementById('constructor-track-count');
                this.duration = document.getElementById('constructor-duration');
                this.initDropZone();
            }
            
            initEvents() {
                this.createBtn.addEventListener('click', () => this.startBuilding());
                this.confirmBtn.addEventListener('click', () => this.confirmPlaylist());
                this.cancelBtn.addEventListener('click', () => this.cancelBuilding());
                
                this.eventBus.on('track:add-to-building', (trackData) => this.addTrack(trackData));
                this.eventBus.on('track:remove-from-building', (trackData) => this.removeTrack(trackData));
                this.eventBus.on('playlist:edit', (payload) => this.editPlaylist(payload)); // üîß –ù–û–í–û–ï: –°–ª—É—à–∞–µ–º —Å–æ–±—ã—Ç–∏–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
            }
            
            initDropZone() {
                this.tracksContainer.addEventListener('dragover', (event) => {
                    event.preventDefault();
                    if (this.stateManager.getState().isBuildingPlaylist) {
                        this.tracksContainer.classList.add('drag-over');
                    }
                });
                
                this.tracksContainer.addEventListener('dragleave', () => {
                    this.tracksContainer.classList.remove('drag-over');
                });
                
                this.tracksContainer.addEventListener('drop', (event) => {
                    event.preventDefault();
                    if (!this.stateManager.getState().isBuildingPlaylist) return;

                    this.tracksContainer.classList.remove('drag-over');
                    const trackId = event.dataTransfer.getData('text/plain');

                    if (trackId) {
                        const [title, artist] = trackId.split('-');
                        const originalTrack = myMusicData.find(a => a.artist === artist)?.tracks.find(t => t.title === title);
                        
                        if (originalTrack) {
                            const trackData = {
                                title: originalTrack.title,
                                artist: artist,
                                duration: originalTrack.duration || 0
                            };
                            this.eventBus.emit('track:add-to-building', trackData);
                        }
                    }
                });
            }
            
            startBuilding() {
                this.stateManager.setState({ isBuildingPlaylist: true });
                this.constructor.style.display = 'flex';
                this.createBtn.style.display = 'none';
                this.eventBus.emit('playlist:build-start');
                this.updateSummary();
            }
            
            addTrack(trackData) {
                const state = this.stateManager.getState();
                const trackId = `${trackData.title}-${trackData.artist}`;

                if (state.addedTracks.has(trackId)) {
                    alert(`${trackData.title} —É–∂–µ –≤ —Å–µ—Ç-–ª–∏—Å—Ç–µ!`);
                    return;
                }
                
                state.currentBuildingPlaylist.push(trackData);
                state.addedTracks.add(trackId);
                this.stateManager.setState(state);
                
                this.renderTrack(trackData);
                this.updateSummary();
                this.eventBus.emit('playlist:item-added', trackData);
            }
            
            removeTrack(trackData) {
                const state = this.stateManager.getState();
                const trackId = `${trackData.title}-${trackData.artist}`;
                
                state.currentBuildingPlaylist = state.currentBuildingPlaylist.filter(t => `${t.title}-${t.artist}` !== trackId);
                state.addedTracks.delete(trackId);
                this.stateManager.setState(state);
                
                this.updateSummary();
                this.eventBus.emit('playlist:item-removed', trackData);
            }
            
            renderTrack(trackData) {
                const dropMessage = this.tracksContainer.querySelector('.drop-zone-message');
                if (dropMessage) dropMessage.style.display = 'none';
                
                const trackElement = document.createElement('div');
                trackElement.className = 'constructor-track-item';
                trackElement.draggable = true;
                trackElement.dataset.trackId = `${trackData.title}-${trackData.artist}`;
                
                trackElement.innerHTML = `
                    <span>${trackData.title} - ${trackData.artist}</span>
                    <button class="remove-track-btn" title="–£–¥–∞–ª–∏—Ç—å">‚ùå</button>
                `;
                
                trackElement.querySelector('.remove-track-btn').addEventListener('click', () => {
                    trackElement.remove();
                    this.removeTrack(trackData);
                    
                    if (this.stateManager.getState().currentBuildingPlaylist.length === 0) {
                        const message = this.tracksContainer.querySelector('.drop-zone-message');
                        if (message) message.style.display = 'block';
                    }
                });
                
                this.tracksContainer.appendChild(trackElement);
            }
            
            updateSummary() {
                const playlist = this.stateManager.getState().currentBuildingPlaylist;
                const totalSeconds = playlist.reduce((total, track) => total + (track.duration || 0), 0);
                
                this.trackCount.textContent = playlist.length;
                this.duration.textContent = this.formatTime(totalSeconds);
            }
            
            confirmPlaylist() {
                const state = this.stateManager.getState();
                const playlistName = this.nameInput.value.trim() || '–ù–æ–≤—ã–π —Å–µ—Ç-–ª–∏—Å—Ç';
                
                if (state.currentBuildingPlaylist.length === 0) {
                    alert('–î–æ–±–∞–≤—å—Ç–µ —Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω —Ç—Ä–µ–∫ –≤ —Å–µ—Ç-–ª–∏—Å—Ç!');
                    return;
                }
                
                const playlistData = {
                    id: Date.now(),
                    name: playlistName,
                    tracks: [...state.currentBuildingPlaylist]
                };

                if (this.elementBeingEdited) {
                    // üîß –û–ë–ù–û–í–õ–ï–ù–û: –û–±–Ω–æ–≤–ª—è–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –ø–ª–µ–π–ª–∏—Å—Ç
                    const originalId = this.elementBeingEdited.dataset.playlistId;
                    playlistData.id = originalId;
                    
                    const playlistIndex = state.savedPlaylists.findIndex(p => p.id == originalId);
                    if (playlistIndex > -1) {
                        state.savedPlaylists[playlistIndex] = playlistData;
                    }
                    this.updatePlaylistInList(this.elementBeingEdited, playlistData);
                    this.elementBeingEdited = null;
                } else {
                    // üîß –û–ë–ù–û–í–õ–ï–ù–û: –°–æ—Ö—Ä–∞–Ω—è–µ–º –Ω–æ–≤—ã–π –ø–ª–µ–π–ª–∏—Å—Ç
                    state.savedPlaylists.push(playlistData);
                    this.savePlaylistToList(playlistData);
                }
                
                // üîß –ù–û–í–û–ï: –û–±–Ω–æ–≤–ª—è–µ–º –∫–∞—Ä—Ç—É —Ç—Ä–µ–∫–æ–≤
                this.updateTrackMapping();
                
                this.cancelBuilding();
                this.eventBus.emit('playlist:confirmed', playlistData);
            }

            // üîß –ù–û–í–´–ô –ú–ï–¢–û–î: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–∞—Ä—Ç—ã —Ç—Ä–µ–∫–æ–≤
            updateTrackMapping() {
                const { savedPlaylists } = this.stateManager.getState();
                const newMapping = {};

                savedPlaylists.forEach(playlist => {
                    playlist.tracks.forEach(track => {
                        const trackId = `${track.title}-${track.artist}`;
                        if (!newMapping[trackId]) {
                            newMapping[trackId] = [];
                        }
                        newMapping[trackId].push(playlist.name);
                    });
                });
                
                this.stateManager.setState({ trackPlaylistMapping: newMapping });
                this.eventBus.emit('state:track-mapping-updated');
            }

            savePlaylistToList(playlistData) {
                const savedPlaylistsContainer = document.getElementById('saved-playlists');
                const totalSeconds = playlistData.tracks.reduce((total, track) => total + (track.duration || 0), 0);
                const formattedTime = this.formatTime(totalSeconds);
                
                const playlistElement = document.createElement('div');
                playlistElement.className = 'playlist-item';
                playlistElement.dataset.playlistId = playlistData.id; // üîß –ù–û–í–û–ï: ID –¥–ª—è —Å–≤—è–∑–∏
                playlistElement.dataset.playlistData = JSON.stringify(playlistData);

                playlistElement.innerHTML = `
                    <div class="playlist-info">
                        <div class="playlist-title">${playlistData.name}</div>
                        <div class="playlist-meta">${playlistData.tracks.length} —Ç—Ä–µ–∫–æ–≤ ‚Ä¢ ${formattedTime}</div>
                    </div>
                    <div class="playlist-actions">
                        <button class="playlist-action-btn play-btn" title="–í–æ—Å–ø—Ä–æ–∏–∑–≤–µ—Å—Ç–∏">‚ñ∂Ô∏è</button>
                        <button class="playlist-action-btn delete-btn" title="–£–¥–∞–ª–∏—Ç—å">üóëÔ∏è</button>
                    </div>
                `;
                
                this.addPlaylistActionListeners(playlistElement);
                
                const sectionTitle = savedPlaylistsContainer.querySelector('.section-title');
                if (sectionTitle) {
                    sectionTitle.insertAdjacentElement('afterend', playlistElement);
                } else {
                    savedPlaylistsContainer.appendChild(playlistElement);
                }
                
                alert(`üíæ –°–µ—Ç-–ª–∏—Å—Ç "${playlistData.name}" —Å–æ—Ö—Ä–∞–Ω–µ–Ω!`);
            }
            
            editPlaylist({ element, data }) {
                this.startBuilding();
                this.elementBeingEdited = element;
                this.nameInput.value = data.name;
                
                data.tracks.forEach(track => {
                    this.addTrack(track); 
                    
                    const trackId = `${track.title}-${track.artist}`;
                    document.querySelectorAll(`[data-track-id="${trackId}"]`).forEach(trackElement => {
                        const button = trackElement.querySelector('.add-to-playlist-btn, .add-to-setlist-btn');
                        if (button) {
                            button.textContent = '‚úÖ';
                            button.disabled = true;
                            button.classList.remove('add-btn-pulse'); // ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û: –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ —É–±–∏—Ä–∞–µ–º –ø—É–ª—å—Å–∞—Ü–∏—é
                        }
                    });
                });
            }

            updatePlaylistInList(element, playlistData) {
                const totalSeconds = playlistData.tracks.reduce((total, track) => total + (track.duration || 0), 0);
                const formattedTime = this.formatTime(totalSeconds);
                
                element.dataset.playlistData = JSON.stringify(playlistData);
                element.querySelector('.playlist-title').textContent = playlistData.name;
                element.querySelector('.playlist-meta').textContent = `${playlistData.tracks.length} —Ç—Ä–µ–∫–æ–≤ ‚Ä¢ ${formattedTime}`;
                
                element.style.display = 'flex';
                alert(`üíæ –°–µ—Ç-–ª–∏—Å—Ç "${playlistData.name}" –æ–±–Ω–æ–≤–ª–µ–Ω!`);
            }

            addPlaylistActionListeners(element) {
                // üîß –ò–°–ü–†–ê–í–õ–ï–ù–û: –í–µ—Å—å —ç–ª–µ–º–µ–Ω—Ç –∫–ª–∏–∫–∞–±–µ–ª—å–Ω—ã–π –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
                element.addEventListener('click', (event) => {
                    if (event.target.closest('.playlist-action-btn')) {
                        return; // –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –∫–ª–∏–∫–∏ –ø–æ –∫–Ω–æ–ø–∫–∞–º
                    }
                    const data = JSON.parse(element.dataset.playlistData);
                    element.style.display = 'none';
                    this.eventBus.emit('playlist:edit', { element, data });
                });

                element.querySelector('.delete-btn').addEventListener('click', (event) => {
                    event.stopPropagation(); // –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ–º "–≤—Å–ø–ª—ã—Ç–∏–µ", —á—Ç–æ–±—ã –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª–æ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
                    const data = JSON.parse(element.dataset.playlistData);
                    if (confirm(`–£–¥–∞–ª–∏—Ç—å –ø–ª–µ–π–ª–∏—Å—Ç "${data.name}"?`)) {
                        element.remove();
                    }
                });

                element.querySelector('.play-btn').addEventListener('click', (event) => {
                    event.stopPropagation(); // –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ–º "–≤—Å–ø–ª—ã—Ç–∏–µ"
                    const data = JSON.parse(element.dataset.playlistData);
                    alert(`‚ñ∂Ô∏è –í–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ –ø–ª–µ–π–ª–∏—Å—Ç–∞ "${data.name}"`);
                });
            }
            
            cancelBuilding() {
                // üîß –ò–°–ü–†–ê–í–õ–ï–ù–û: –ï—Å–ª–∏ –º—ã —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–ª–∏ –ø–ª–µ–π–ª–∏—Å—Ç, –æ–Ω –±–æ–ª—å—à–µ –Ω–µ —É–¥–∞–ª—è–µ—Ç—Å—è –ø—Ä–∏ –æ—Ç–º–µ–Ω–µ
                if (this.elementBeingEdited) {
                    this.elementBeingEdited.style.display = 'flex';
                    this.elementBeingEdited = null;
                }

                this.stateManager.setState({ 
                    isBuildingPlaylist: false, 
                    currentBuildingPlaylist: [],
                    addedTracks: new Set()
                });
                
                this.constructor.style.display = 'none';
                this.createBtn.style.display = 'flex';
                this.tracksContainer.innerHTML = '<div class="drop-zone-message"><span class="drop-icon">üéµ</span><p>–î–æ–±–∞–≤–ª—è–π—Ç–µ —Ç—Ä–µ–∫–∏ –∫–Ω–æ–ø–∫–æ–π ‚ûï –∏–ª–∏ –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏–µ–º</p></div>';
                this.nameInput.value = '–ù–æ–≤—ã–π —Å–µ—Ç-–ª–∏—Å—Ç';
                
                this.eventBus.emit('playlist:build-cancelled');
            }
            
            formatTime(seconds) {
                const minutes = Math.floor(seconds / 60);
                const remainingSeconds = seconds % 60;
                return `${minutes.toString().padStart(2, '0')}:${remainingSeconds.toString().padStart(2, '0')}`;
            }
        }

        // üè∑Ô∏è TrackTagsView - –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–µ–≥–∞–º–∏ –Ω–∞ —Ç—Ä–µ–∫–∞—Ö
        class TrackTagsView {
            constructor(eventBus, stateManager) {
                this.eventBus = eventBus;
                this.stateManager = stateManager;
                this.eventBus.on('state:track-mapping-updated', () => this.renderAllTags());
                this.eventBus.on('playlist:confirmed', () => this.renderAllTags());
                this.eventBus.on('playlist:build-cancelled', () => this.renderAllTags());
            }

            renderAllTags() {
                const { trackPlaylistMapping } = this.stateManager.getState();
                
                const allTracks = document.querySelectorAll('.track-item, .search-result-item');
                const firstMyMusicTrack = document.querySelector('.track-item'); // üîß –ù–∞—Ö–æ–¥–∏–º –ø–µ—Ä–≤—ã–π —Ç—Ä–µ–∫ –≤ "–ú–æ—è –ú—É–∑—ã–∫–∞"
                const firstSearchResult = document.querySelector('.search-result-item');

                allTracks.forEach(trackElement => {
                    const trackId = trackElement.dataset.trackId;
                    const playlists = trackPlaylistMapping[trackId] || [];
                    
                    let controls = trackElement.querySelector('.track-item-controls, .track-actions');
                    if (!controls) return;
                    
                    controls.querySelectorAll('.playlist-tag-container').forEach(tag => tag.remove());
                    
                    if (playlists.length > 0) {
                        const tagContainer = document.createElement('span');
                        tagContainer.className = 'playlist-tag-container';
                        
                        const tag = document.createElement('span');
                        tag.className = 'playlist-tag';
                        tag.textContent = 'Mix List';
                        
                        const tooltip = document.createElement('div');
                        tooltip.className = 'playlist-tooltip';

                        // üîß –ò–°–ü–†–ê–í–õ–ï–ù–û: –ü—Ä–∏–º–µ–Ω—è–µ–º –∫–ª–∞—Å—Å .below –∫ –ø–µ—Ä–≤—ã–º —Ç—Ä–µ–∫–∞–º –≤ –û–ë–ï–ò–• –∫–æ–ª–æ–Ω–∫–∞—Ö
                        if (trackElement === firstSearchResult || trackElement === firstMyMusicTrack) {
                            tooltip.classList.add('below');
                        }

                        tooltip.innerHTML = `
                            <h4>–í—Ö–æ–¥–∏—Ç –≤:</h4>
                            <ul>
                                ${playlists.map(p => `<li>${p}</li>`).join('')}
                            </ul>
                        `;
                        tag.appendChild(tooltip);
                        
                        tag.addEventListener('mouseenter', () => tooltip.classList.add('visible'));
                        tag.addEventListener('mouseleave', () => tooltip.classList.remove('visible'));

                        tagContainer.appendChild(tag);
                        controls.prepend(tagContainer);
                    }
                });
            }
        }

        // üé® UIFeedback - –í–∏–∑—É–∞–ª—å–Ω—ã–µ —ç—Ñ—Ñ–µ–∫—Ç—ã
        class UIFeedback {
            constructor(eventBus) {
                this.eventBus = eventBus;
                this.initEvents();
            }
            
            initEvents() {
                this.eventBus.on('playlist:build-start', () => this.activateBuildingMode());
                this.eventBus.on('playlist:build-cancelled', () => this.deactivateBuildingMode());
                this.eventBus.on('playlist:confirmed', () => this.deactivateBuildingMode()); // üîß –ò–°–ü–†–ê–í–õ–ï–ù–û: –°–ª—É—à–∞–µ–º –∏ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ
            }
            
            activateBuildingMode() {
                // –î–æ–±–∞–≤–ª—è–µ–º –∑–µ–ª–µ–Ω—ã–µ –æ–±–≤–æ–¥–∫–∏ –≤—Å–µ–º –∫–æ–ª–æ–Ω–∫–∞–º
                document.querySelectorAll('.catalog-column').forEach(column => {
                    column.classList.add('building-mode');
                });
                
                // üîß –ò–°–ü–†–ê–í–õ–ï–ù–û: –î–æ–±–∞–≤–ª—è–µ–º –ø—É–ª—å—Å–∞—Ü–∏—é —Ç–æ–ª—å–∫–æ –∞–∫—Ç–∏–≤–Ω—ã–º –∫–Ω–æ–ø–∫–∞–º ‚ûï
                document.querySelectorAll('.add-to-playlist-btn:not(:disabled), .add-to-current-btn:not(:disabled), .add-to-setlist-btn:not(:disabled)').forEach(btn => {
                    btn.classList.add('add-btn-pulse');
                });
                
                console.log('üé® –†–µ–∂–∏–º –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–∞ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω!');
            }
            
            deactivateBuildingMode() {
                // –£–±–∏—Ä–∞–µ–º –æ–±–≤–æ–¥–∫–∏
                document.querySelectorAll('.catalog-column').forEach(column => {
                    column.classList.remove('building-mode');
                });
                
                // –£–±–∏—Ä–∞–µ–º –ø—É–ª—å—Å–∞—Ü–∏—é
                document.querySelectorAll('.add-btn-pulse').forEach(btn => {
                    btn.classList.remove('add-btn-pulse');
                });

                // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –≤—Å–µ –≤—Ä–µ–º–µ–Ω–Ω—ã–µ –∫–Ω–æ–ø–∫–∏ "‚úÖ" –æ–±—Ä–∞—Ç–Ω–æ –≤ "‚ûï"
                document.querySelectorAll('.add-to-playlist-btn, .add-to-current-btn, .add-to-setlist-btn').forEach(btn => {
                    // üîß –ò–°–ü–†–ê–í–õ–ï–ù–û: –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ —É —Ç—Ä–µ–∫–∞ —Ç–µ–≥. –ï—Å–ª–∏ –¥–∞, –∫–Ω–æ–ø–∫—É –Ω–µ —Ç—Ä–æ–≥–∞–µ–º.
                    const controls = btn.closest('.track-item-controls, .track-actions');
                    if (controls && !controls.querySelector('.playlist-tag-container')) {
                        btn.textContent = '‚ûï';
                        btn.disabled = false;
                        btn.title = '–î–æ–±–∞–≤–∏—Ç—å –≤ —Å–µ—Ç-–ª–∏—Å—Ç';
                    }
                });

                // –°–≤–æ—Ä–∞—á–∏–≤–∞–µ–º –≤—Å–µ –æ—Ç–∫—Ä—ã—Ç—ã–µ –≥—Ä—É–ø–ø—ã –∞—Ä—Ç–∏—Å—Ç–æ–≤
                document.querySelectorAll('.artist-group.expanded').forEach(group => {
                    group.classList.remove('expanded');
                    group.querySelector('.track-list').classList.remove('expanded');
                    group.querySelector('.toggle-icon').textContent = '+';
                });
                
                console.log('üé® –†–µ–∂–∏–º –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–∞ –¥–µ–∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω, UI —Å–±—Ä–æ—à–µ–Ω!');
            }
        }

        // üéß –î–∞–Ω–Ω—ã–µ —Ç—Ä–µ–∫–æ–≤
        const myMusicData = [
            {
                artist: "Linkin Park",
                tracks: [
                    { title: "New Divide", played: 12, favorite: true, duration: 268 },
                    { title: "When They Come For Me", played: 8, favorite: false, duration: 293 },
                ]
            },
            {
                artist: "Eminem",
                tracks: [
                    { title: "Love The Way You Lie", played: 25, favorite: true, duration: 263 },
                ]
            },
            {
                artist: "Queen",
                tracks: [
                    { title: "Bohemian Rhapsody", played: 30, favorite: true, duration: 355 },
                    { title: "Don't Stop Me Now", played: 20, favorite: false, duration: 209 },
                ]
            },
            {
                artist: "Aerosmith",
                tracks: [
                    { title: "Dream On", played: 5, favorite: false, duration: 267 },
                ]
            }
        ];

        // üöÄ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å–∏—Å—Ç–µ–º—ã
        const eventBus = new EventBus();
        const stateManager = new StateManager();
        const playlistBuilder = new PlaylistBuilder(eventBus, stateManager);
        const uiFeedback = new UIFeedback(eventBus);
        const trackTagsView = new TrackTagsView(eventBus, stateManager); // üîß –ù–û–í–û–ï: –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º View –¥–ª—è —Ç–µ–≥–æ–≤

        // üîß –ù–û–í–û–ï: –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–Ω–æ–ø–æ–∫ –Ω–∞ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –ø–ª–µ–π–ª–∏—Å—Ç–∞—Ö
        function initSavedPlaylistActions() {
            document.querySelectorAll('#saved-playlists .playlist-item').forEach(item => {
                const playBtn = item.querySelector('.playlist-action-btn[title="–í–æ—Å–ø—Ä–æ–∏–∑–≤–µ—Å—Ç–∏"]');
                const editBtn = item.querySelector('.playlist-action-btn[title="–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å"]');
                const deleteBtn = item.querySelector('.playlist-action-btn[title="–£–¥–∞–ª–∏—Ç—å"]');

                if (playBtn) {
                    playBtn.addEventListener('click', (event) => {
                        event.stopPropagation();
                        const title = item.querySelector('.playlist-title').textContent;
                        alert(`‚ñ∂Ô∏è –í–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ –ø–ª–µ–π–ª–∏—Å—Ç–∞ "${title}"`);
                    });
                }
                
                // –ü—Ä–æ—Å—Ç–æ —É–¥–∞–ª—è–µ–º –∫–Ω–æ–ø–∫—É —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
                if (editBtn) {
                    editBtn.remove();
                }
                
                if (deleteBtn) {
                    deleteBtn.addEventListener('click', (event) => {
                        event.stopPropagation();
                        const title = item.querySelector('.playlist-title').textContent;
                        if (confirm(`–£–¥–∞–ª–∏—Ç—å –ø–ª–µ–π–ª–∏—Å—Ç "${title}"?`)) {
                            item.remove();
                        }
                    });
                }
            });
        }

        // üì± –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Ç—Ä–µ–∫–∞
        function addTrackToBuilding(trackData, buttonElement = null) {
            if (!stateManager.getState().isBuildingPlaylist) {
                alert('–°–Ω–∞—á–∞–ª–∞ —Å–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—ã–π —Å–µ—Ç-–ª–∏—Å—Ç!');
                return;
            }
            
            const trackId = `${trackData.title}-${trackData.artist}`;
            if (stateManager.getState().addedTracks.has(trackId)) {
                return; // –¢—Ä–µ–∫ —É–∂–µ –¥–æ–±–∞–≤–ª–µ–Ω
            }
            
            eventBus.emit('track:add-to-building', trackData);
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∫–Ω–æ–ø–∫—É –µ—Å–ª–∏ –µ—Å—Ç—å
            if (buttonElement) {
                buttonElement.textContent = '‚úÖ';
                buttonElement.disabled = true;
                buttonElement.title = "–£–∂–µ –≤ —Å–µ—Ç-–ª–∏—Å—Ç–µ";
            }
        }

        // üéµ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è "–ú–æ–µ–π –º—É–∑—ã–∫–∏"
        function renderMyMusic() {
            const myMusicList = document.getElementById('my-music-list');
            myMusicList.innerHTML = '';

            myMusicData.forEach(artistData => {
                const artistGroup = document.createElement('div');
                artistGroup.className = 'artist-group';

                const artistHeader = document.createElement('div');
                artistHeader.className = 'artist-header';
                artistHeader.innerHTML = `<span>${artistData.artist}</span><span>${artistData.tracks.length} —Ç—Ä–µ–∫–∞ <span class="toggle-icon">+</span></span>`;

                const trackList = document.createElement('ul');
                trackList.className = 'track-list';

                artistData.tracks.forEach(track => {
                    const trackItem = document.createElement('li');
                    trackItem.className = 'track-item';
                    trackItem.draggable = true; // –î–æ–±–∞–≤–ª—è–µ–º draggable
                    trackItem.dataset.trackId = `${track.title}-${artistData.artist}`; // –î–ª—è DnD
                    const favoriteClass = track.favorite ? 'active' : '';
                    trackItem.innerHTML = `
                        <span>${track.title} <span class="track-meta-info">(–ò—Å–ø–æ–ª–Ω–µ–Ω–æ ${track.played} —Ä–∞–∑)${track.played > 20 ? ' üî•' : ''}</span></span>
                        <span class="track-item-controls">
                            <button class="add-to-playlist-btn" title="–î–æ–±–∞–≤–∏—Ç—å –≤ —Å–µ—Ç-–ª–∏—Å—Ç" data-track-title="${track.title}" data-artist="${artistData.artist}">‚ûï</button>
                            <button class="play-button" title="–í–æ—Å–ø—Ä–æ–∏–∑–≤–µ—Å—Ç–∏">‚ñ∂</button>
                            <button class="favorite-button ${favoriteClass}" title="–í –∏–∑–±—Ä–∞–Ω–Ω–æ–µ">‚≠ê</button>
                        </span>
                    `;
                    trackList.appendChild(trackItem);
                });
                
                artistGroup.appendChild(artistHeader);
                artistGroup.appendChild(trackList);
                myMusicList.appendChild(artistGroup);
                
                // üîß –í–û–°–°–¢–ê–ù–û–í–õ–ï–ù–û: –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —Ä–∞—Å–∫—Ä—ã—Ç–∏—è –≥—Ä—É–ø–ø—ã
                artistHeader.addEventListener('click', () => {
                    const toggleIcon = artistHeader.querySelector('.toggle-icon');
                    const isExpanded = artistGroup.classList.toggle('expanded');
                    trackList.classList.toggle('expanded', isExpanded);
                    toggleIcon.textContent = isExpanded ? '‚àí' : '+';
                });
            });

            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–Ω–æ–ø–æ–∫ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è
            document.querySelectorAll('.add-to-playlist-btn').forEach(button => {
                button.addEventListener('click', (event) => {
                    event.stopPropagation();
                    
                    const trackTitle = event.target.dataset.trackTitle;
                    const artist = event.target.dataset.artist;
                    const originalTrack = myMusicData.find(a => a.artist === artist)?.tracks.find(t => t.title === trackTitle);
                    
                    if (originalTrack) {
                        const trackData = {
                            title: originalTrack.title,
                            artist: artist,
                            duration: originalTrack.duration || 0
                        };
                        addTrackToBuilding(trackData, event.target);
                    }
                });
            });

            // üîß –ù–û–í–û–ï: –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ DnD –¥–ª—è "–ú–æ–µ–π –º—É–∑—ã–∫–∏"
            document.querySelectorAll('.my-music-column .track-item').forEach(track => {
                track.addEventListener('dragstart', (event) => {
                    event.dataTransfer.setData('text/plain', track.dataset.trackId);
                    track.classList.add('dragging');
                });
                track.addEventListener('dragend', () => {
                    track.classList.remove('dragging');
                });
            });
        }

        // üìä –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Ç–∞–±–æ–≤
        function initTabSystem() {
            const tabBtns = document.querySelectorAll('.tab-btn');
            const tabPanels = document.querySelectorAll('.tab-panel');

            tabBtns.forEach(btn => {
                btn.addEventListener('click', () => {
                    const targetTab = btn.dataset.tab;
                    
                    tabBtns.forEach(b => b.classList.remove('active'));
                    tabPanels.forEach(p => p.classList.remove('active'));
                    
                    btn.classList.add('active');
                    document.getElementById(targetTab + '-panel').classList.add('active');
                });
            });
        }

        // üîç –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–Ω–æ–ø–æ–∫ –≤ –∏—Å—Ç–æ—Ä–∏–∏ –∏ —Ç—Ä–µ–Ω–¥–∞—Ö
        function initHistoryAndTrendsButtons() {
            document.querySelectorAll('#history-panel .add-to-current-btn, #trends-panel .trend-add-btn').forEach(button => {
                button.addEventListener('click', (event) => {
                    const isHistory = event.target.closest('#history-panel');
                    let title, artist;
                    
                    if (isHistory) {
                        const trackText = event.target.closest('.history-item').querySelector('.history-track').textContent;
                        [title, artist] = trackText.split(' - ');
                    } else {
                        const trackCard = event.target.closest('.track-card');
                        title = trackCard.querySelector('.title').textContent;
                        artist = trackCard.querySelector('.artist').textContent;
                    }
                    
                    const originalTrack = myMusicData.find(a => a.artist === artist)?.tracks.find(t => t.title === title);
                    const trackData = {
                        title: title,
                        artist: artist,
                        duration: originalTrack?.duration || 210
                    };
                    
                    addTrackToBuilding(trackData, event.target);
                });
            });
        }

        // üîç –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø–æ–∏—Å–∫–∞
        function initSearchButtons() {
            document.querySelectorAll('.search-result-item .add-to-setlist-btn').forEach(button => {
                button.addEventListener('click', (event) => {
                    event.stopPropagation();
                    
                    const searchItem = event.target.closest('.search-result-item');
                    const title = searchItem.querySelector('.track-title').textContent;
                    const artist = searchItem.querySelector('.track-artist').textContent;
                    
                    const originalTrack = myMusicData.find(a => a.artist === artist)?.tracks.find(t => t.title === title);
                    const trackData = {
                        title: title,
                        artist: artist,
                        duration: originalTrack?.duration || 180
                    };
                    
                    addTrackToBuilding(trackData, event.target);
                });
            });

            // üîß –ù–û–í–û–ï: –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ DnD –¥–ª—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –ø–æ–∏—Å–∫–∞
            document.querySelectorAll('.search-result-item').forEach(track => {
                track.addEventListener('dragstart', (event) => {
                    event.dataTransfer.setData('text/plain', track.dataset.trackId);
                    track.classList.add('dragging');
                });
                track.addEventListener('dragend', () => {
                    track.classList.remove('dragging');
                });
            });
        }

        // üöÄ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        document.addEventListener('DOMContentLoaded', () => {
            initTabSystem();
            renderMyMusic();
            initHistoryAndTrendsButtons();
            initSearchButtons();
            // initSavedPlaylistActions(); // üîß –£–î–ê–õ–ï–ù–û: –í—ã–∑–æ–≤ —Ñ—É–Ω–∫—Ü–∏–∏ —Ç–æ–∂–µ —É–±–∏—Ä–∞–µ–º
            
            // üéµ –ù–û–í–û–ï: –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Upload Manager
            uploadManager = new UploadManager();
            
            console.log('üöÄ –ù–æ–≤–∞—è –º–æ–¥—É–ª—å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –∫–∞—Ç–∞–ª–æ–≥–∞ –≥–æ—Ç–æ–≤–∞!');
            console.log('üì° EventBus –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω');
            console.log('üóÇÔ∏è StateManager –≥–æ—Ç–æ–≤');
            console.log('üéµ PlaylistBuilder –∞–∫—Ç–∏–≤–µ–Ω');
            console.log('üé® UIFeedback –ø–æ–¥–∫–ª—é—á–µ–Ω');
            console.log('üè∑Ô∏è TrackTagsView –∞–∫—Ç–∏–≤–µ–Ω');
            console.log('üìÅ UploadManager –≥–æ—Ç–æ–≤ –∫ —Ä–∞–±–æ—Ç–µ');
        });

        // üéµ UPLOAD MODE SYSTEM - –°–∏—Å—Ç–µ–º–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ç—Ä–µ–∫–æ–≤
        // –†–∞–∑—Ä–∞–±–æ—Ç–∞–Ω–æ —Å —É—á–µ—Ç–æ–º –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π –æ—Ç GPT (—Å—Ç—Ä—É–∫—Ç—É—Ä–∞), Gemini (–º–∞—à–∏–Ω–∞ —Å–æ—Å—Ç–æ—è–Ω–∏–π), Claude (–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞)
        
        class UploadManager {
            constructor() {
                this.isActive = false;
                this.uploadSession = {
                    files: {},
                    metadata: {},
                    status: 'idle' // idle, collecting, processing, ready, saving
                };
                this.currentQuota = null;
                
                this.initElements();
                this.initEventListeners();
                this.checkStorageQuota();
            }
            
            initElements() {
                this.triggerBtn = document.getElementById('upload-mode-trigger');
                this.container = document.getElementById('upload-mode-container');
                this.backBtn = document.getElementById('upload-back-btn');
                this.searchInput = document.getElementById('search-input');
                this.searchResults = document.getElementById('search-results');
                this.previewPlayer = document.getElementById('preview-player');
                
                // Upload cells
                this.cells = {
                    instrumental: document.getElementById('instrumental-cell'),
                    vocal: document.getElementById('vocal-cell'),
                    lyrics: document.getElementById('lyrics-cell')
                };
                
                // File inputs
                this.inputs = {
                    instrumental: document.getElementById('instrumental-input'),
                    vocal: document.getElementById('vocal-input'),
                    lyrics: document.getElementById('lyrics-input'),
                    json: document.getElementById('json-input'),
                    stems: document.getElementById('stems-input')
                };
                
                // Additional controls
                this.jsonBtn = document.getElementById('add-json-btn');
                this.stemsBtn = document.getElementById('add-stems-btn');
                this.jsonPreview = document.getElementById('json-preview');
                this.finalActions = document.getElementById('upload-final-actions');
                this.saveBtn = document.getElementById('upload-save-btn');
                this.cancelBtn = document.getElementById('upload-cancel-btn');
            }
            
            initEventListeners() {
                // –ê–∫—Ç–∏–≤–∞—Ü–∏—è/–¥–µ–∞–∫—Ç–∏–≤–∞—Ü–∏—è Upload Mode
                this.triggerBtn.addEventListener('click', () => this.activateUploadMode());
                this.backBtn.addEventListener('click', () => this.deactivateUploadMode());
                this.cancelBtn.addEventListener('click', () => this.deactivateUploadMode());
                
                // Upload cells
                Object.keys(this.cells).forEach(type => {
                    const cell = this.cells[type];
                    const input = this.inputs[type];
                    
                    // Click to select file
                    cell.addEventListener('click', () => input.click());
                    
                    // File input change
                    input.addEventListener('change', (e) => this.handleFileSelect(type, e.target.files[0]));
                    
                    // Drag & Drop
                    cell.addEventListener('dragover', (e) => this.handleDragOver(e, cell));
                    cell.addEventListener('dragleave', (e) => this.handleDragLeave(e, cell));
                    cell.addEventListener('drop', (e) => this.handleDrop(e, type, cell));
                });
                
                // Additional buttons
                this.jsonBtn.addEventListener('click', () => this.inputs.json.click());
                this.stemsBtn.addEventListener('click', () => this.inputs.stems.click());
                this.inputs.json.addEventListener('change', (e) => this.handleJsonFile(e.target.files[0]));
                this.inputs.stems.addEventListener('change', (e) => this.handleStemsFiles(e.target.files));
                
                // Final actions
                this.saveBtn.addEventListener('click', () => this.saveToLibrary());
                
                // JSON preview actions
                document.getElementById('json-apply').addEventListener('click', () => this.applyJsonMarkers());
                document.getElementById('json-revert').addEventListener('click', () => this.revertJsonMarkers());
            }
            
            async checkStorageQuota() {
                try {
                    if ('storage' in navigator && 'estimate' in navigator.storage) {
                        const estimate = await navigator.storage.estimate();
                        this.currentQuota = {
                            used: estimate.usage,
                            available: estimate.quota,
                            percentage: (estimate.usage / estimate.quota) * 100
                        };
                        console.log('üìä Storage quota:', this.currentQuota);
                    }
                } catch (error) {
                    console.warn('‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –∫–≤–æ—Ç–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞:', error);
                }
            }
            
            activateUploadMode() {
                console.log('üìÅ –ê–∫—Ç–∏–≤–∞—Ü–∏—è Upload Mode');
                this.isActive = true;
                this.uploadSession.status = 'collecting';
                
                // UI –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ
                this.triggerBtn.style.display = 'none';
                this.container.classList.add('active');
                this.searchInput.style.display = 'none';
                this.searchResults.style.display = 'none';
                if (this.previewPlayer) this.previewPlayer.style.display = 'none';
                
                // Emit event
                eventBus.emit('upload:mode-activated');
            }
            
            deactivateUploadMode() {
                console.log('üîô –î–µ–∞–∫—Ç–∏–≤–∞—Ü–∏—è Upload Mode');
                this.isActive = false;
                this.uploadSession.status = 'idle';
                
                // UI –≤–æ–∑–≤—Ä–∞—Ç
                this.triggerBtn.style.display = 'block';
                this.container.classList.remove('active');
                this.searchInput.style.display = 'block';
                this.searchResults.style.display = 'block';
                
                // –û—á–∏—Å—Ç–∫–∞ —Å–µ—Å—Å–∏–∏
                this.clearUploadSession();
                
                // Emit event
                eventBus.emit('upload:mode-deactivated');
            }
            
            clearUploadSession() {
                this.uploadSession = {
                    files: {},
                    metadata: {},
                    status: 'idle'
                };
                
                // –°–±—Ä–æ—Å UI
                Object.values(this.cells).forEach(cell => {
                    cell.classList.remove('has-file', 'processing', 'error');
                    const status = cell.querySelector('.cell-status');
                    const progress = cell.querySelector('.upload-progress-bar');
                    status.textContent = '–ü–µ—Ä–µ—Ç–∞—â–∏—Ç–µ –∏–ª–∏ –∫–ª–∏–∫–Ω–∏—Ç–µ';
                    status.className = 'cell-status';
                    progress.style.width = '0%';
                });
                
                this.jsonPreview.classList.remove('active');
                this.finalActions.classList.remove('show');
            }
            
            handleDragOver(e, cell) {
                e.preventDefault();
                cell.classList.add('drag-over');
            }
            
            handleDragLeave(e, cell) {
                cell.classList.remove('drag-over');
            }
            
            handleDrop(e, type, cell) {
                e.preventDefault();
                cell.classList.remove('drag-over');
                
                const files = e.dataTransfer.files;
                if (files.length > 0) {
                    this.handleFileSelect(type, files[0]);
                }
            }
            
            async handleFileSelect(type, file) {
                if (!file) return;
                
                console.log(`üìÅ –í—ã–±—Ä–∞–Ω —Ñ–∞–π–ª –¥–ª—è ${type}:`, file.name);
                
                // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–≤–æ—Ç—ã
                if (this.currentQuota && file.size > (this.currentQuota.available - this.currentQuota.used)) {
                    alert('‚ùå –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –º–µ—Å—Ç–∞ –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–∞!');
                    return;
                }
                
                const cell = this.cells[type];
                const status = cell.querySelector('.cell-status');
                const progress = cell.querySelector('.upload-progress-bar');
                
                try {
                    // –ú–∞—à–∏–Ω–∞ —Å–æ—Å—Ç–æ—è–Ω–∏–π: –û–∂–∏–¥–∞–Ω–∏–µ -> –û–±—Ä–∞–±–æ—Ç–∫–∞
                    cell.classList.add('processing');
                    status.textContent = '–û–±—Ä–∞–±–æ—Ç–∫–∞...';
                    status.className = 'cell-status processing';
                    
                    // –ò–º–∏—Ç–∞—Ü–∏—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏ (Web Worker)
                    const processedFile = await this.processFile(file, type, (progressPercent) => {
                        progress.style.width = `${progressPercent}%`;
                    });
                    
                    // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ —Å–µ—Å—Å–∏–∏
                    this.uploadSession.files[type] = processedFile;
                    
                    // –ú–∞—à–∏–Ω–∞ —Å–æ—Å—Ç–æ—è–Ω–∏–π: –û–±—Ä–∞–±–æ—Ç–∫–∞ -> –ì–æ—Ç–æ–≤–æ
                    cell.classList.remove('processing');
                    cell.classList.add('has-file');
                    status.textContent = `‚úÖ ${file.name}`;
                    status.className = 'cell-status success';
                    progress.style.width = '100%';
                    
                    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ –∫ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—é
                    this.checkReadyToSave();
                    
                } catch (error) {
                    console.error('‚ùå –û—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Ñ–∞–π–ª–∞:', error);
                    
                    // –ú–∞—à–∏–Ω–∞ —Å–æ—Å—Ç–æ—è–Ω–∏–π: –û–±—Ä–∞–±–æ—Ç–∫–∞ -> –û—à–∏–±–∫–∞
                    cell.classList.remove('processing');
                    cell.classList.add('error');
                    status.textContent = `‚ùå –û—à–∏–±–∫–∞: ${error.message}`;
                    status.className = 'cell-status error';
                    progress.style.width = '0%';
                }
            }
            
            async processFile(file, type, progressCallback) {
                return new Promise((resolve, reject) => {
                    // –ò–º–∏—Ç–∞—Ü–∏—è Web Worker –æ–±—Ä–∞–±–æ—Ç–∫–∏
                    let progress = 0;
                    const interval = setInterval(() => {
                        progress += Math.random() * 20;
                        if (progress >= 100) {
                            progress = 100;
                            clearInterval(interval);
                            
                            // –°–∏–º—É–ª—è—Ü–∏—è –∏–∑–≤–ª–µ—á–µ–Ω–∏—è –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö
                            setTimeout(() => {
                                const metadata = this.extractMetadata(file, type);
                                resolve({
                                    file: file,
                                    metadata: metadata,
                                    url: URL.createObjectURL(file),
                                    type: type
                                });
                            }, 200);
                        }
                        progressCallback(Math.floor(progress));
                    }, 100);
                });
            }
            
            extractMetadata(file, type) {
                const metadata = {
                    name: file.name,
                    size: file.size,
                    type: file.type,
                    lastModified: file.lastModified
                };
                
                if (type === 'instrumental' || type === 'vocal') {
                    // –î–ª—è –∞—É–¥–∏–æ - –¥–æ–±–∞–≤–ª—è–µ–º –ø—Ä–∏–º–µ—Ä–Ω—É—é –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å (–≤ —Ä–µ–∞–ª—å–Ω–æ—Å—Ç–∏ —á–µ—Ä–µ–∑ Web Audio API)
                    metadata.duration = 180 + Math.random() * 60; // 3-4 –º–∏–Ω—É—Ç—ã
                    metadata.bitrate = '320 kbps';
                    metadata.sampleRate = '44.1 kHz';
                }
                
                return metadata;
            }
            
            async handleJsonFile(file) {
                if (!file) return;
                
                try {
                    const text = await file.text();
                    const jsonData = JSON.parse(text);
                    
                    // –í–∞–ª–∏–¥–∞—Ü–∏—è JSON —Å—Ç—Ä—É–∫—Ç—É—Ä—ã
                    if (!jsonData.markers || !Array.isArray(jsonData.markers)) {
                        throw new Error('JSON –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å –º–∞—Å—Å–∏–≤ markers');
                    }
                    
                    this.uploadSession.jsonMarkers = jsonData.markers;
                    this.renderJsonPreview(jsonData.markers);
                    this.jsonPreview.classList.add('active');
                    
                    console.log('üìä JSON –º–∞—Ä–∫–µ—Ä—ã –∑–∞–≥—Ä—É–∂–µ–Ω—ã:', jsonData.markers.length);
                    
                } catch (error) {
                    console.error('‚ùå –û—à–∏–±–∫–∞ —á—Ç–µ–Ω–∏—è JSON:', error);
                    alert(`‚ùå –û—à–∏–±–∫–∞ –≤ JSON —Ñ–∞–π–ª–µ: ${error.message}`);
                }
            }
            
            renderJsonPreview(markers) {
                const markersList = document.getElementById('json-markers-list');
                markersList.innerHTML = '';
                
                markers.forEach(marker => {
                    const item = document.createElement('div');
                    item.className = 'json-marker-item';
                    item.innerHTML = `
                        <span class="marker-time">${this.formatTime(marker.time)}</span>
                        <span class="marker-text">${marker.text || marker.label || '–ú–∞—Ä–∫–µ—Ä'}</span>
                    `;
                    markersList.appendChild(item);
                });
            }
            
            formatTime(seconds) {
                const mins = Math.floor(seconds / 60);
                const secs = Math.floor(seconds % 60);
                return `${mins}:${secs.toString().padStart(2, '0')}`;
            }
            
            async handleStemsFiles(files) {
                if (files.length === 0) return;
                
                console.log('ü•Å Stems —Ñ–∞–π–ª—ã –∑–∞–≥—Ä—É–∂–µ–Ω—ã (–º–∞–∫–µ—Ç):', files.length);
                
                // –ü–æ–∫–∞ —á—Ç–æ –ø—Ä–æ—Å—Ç–æ —Å–æ—Ö—Ä–∞–Ω—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é
                this.uploadSession.stems = Array.from(files).map(file => ({
                    name: file.name,
                    size: file.size,
                    type: file.type
                }));
                
                alert(`ü•Å –ó–∞–≥—Ä—É–∂–µ–Ω–æ ${files.length} stems —Ñ–∞–π–ª–æ–≤ (—Ñ—É–Ω–∫—Ü–∏—è –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ)`);
            }
            
            applyJsonMarkers() {
                if (this.uploadSession.jsonMarkers) {
                    this.uploadSession.metadata.markers = this.uploadSession.jsonMarkers;
                    alert('‚úÖ JSON –º–∞—Ä–∫–µ—Ä—ã –ø—Ä–∏–º–µ–Ω–µ–Ω—ã –∫ —Ç—Ä–µ–∫—É');
                    this.checkReadyToSave();
                }
            }
            
            revertJsonMarkers() {
                delete this.uploadSession.metadata.markers;
                this.jsonPreview.classList.remove('active');
                alert('‚ùå JSON –º–∞—Ä–∫–µ—Ä—ã –æ—Ç–º–µ–Ω–µ–Ω—ã');
            }
            
            checkReadyToSave() {
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è (—Ö–æ—Ç—è –±—ã –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞–ª)
                const hasMinimum = this.uploadSession.files.instrumental;
                
                if (hasMinimum) {
                    this.updateMetadataDisplay();
                    this.finalActions.classList.add('show');
                    this.uploadSession.status = 'ready';
                }
            }
            
            updateMetadataDisplay() {
                const instrumental = this.uploadSession.files.instrumental;
                if (!instrumental) return;
                
                const title = instrumental.metadata.name.replace(/\.[^/.]+$/, ""); // –£–±–∏—Ä–∞–µ–º —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ
                const artist = "–ù–µ–∏–∑–≤–µ—Å—Ç–µ–Ω"; // –í –±—É–¥—É—â–µ–º –∏–∑ ID3 —Ç–µ–≥–æ–≤
                const duration = this.formatTime(instrumental.metadata.duration || 180);
                const size = ((instrumental.file.size / 1024 / 1024).toFixed(1)) + ' MB';
                
                document.getElementById('track-title-meta').textContent = title;
                document.getElementById('track-artist-meta').textContent = artist;
                document.getElementById('track-duration-meta').textContent = duration;
                document.getElementById('track-size-meta').textContent = size;
            }
            
            async saveToLibrary() {
                if (this.uploadSession.status !== 'ready') {
                    alert('‚ùå –ó–∞–≥—Ä—É–∑–∫–∞ –Ω–µ –≥–æ—Ç–æ–≤–∞ –∫ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—é');
                    return;
                }
                
                try {
                    this.uploadSession.status = 'saving';
                    this.saveBtn.textContent = 'üíæ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ...';
                    this.saveBtn.disabled = true;
                    
                    // –ò–º–∏—Ç–∞—Ü–∏—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –≤ IndexedDB
                    await new Promise(resolve => setTimeout(resolve, 1500));
                    
                    // –í —Ä–µ–∞–ª—å–Ω–æ—Å—Ç–∏ –∑–¥–µ—Å—å –±—É–¥–µ—Ç –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å TrackCatalog
                    console.log('üíæ –¢—Ä–µ–∫ —Å–æ—Ö—Ä–∞–Ω–µ–Ω –≤ –±–∏–±–ª–∏–æ—Ç–µ–∫—É:', this.uploadSession);
                    
                    alert('‚úÖ –¢—Ä–µ–∫ —É—Å–ø–µ—à–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω –≤ –≤–∞—à—É –±–∏–±–ª–∏–æ—Ç–µ–∫—É!');
                    
                    // Emit —Å–æ–±—ã—Ç–∏–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Ç—Ä–µ–∫–∞
                    eventBus.emit('track:uploaded', {
                        files: this.uploadSession.files,
                        metadata: this.uploadSession.metadata
                    });
                    
                    this.deactivateUploadMode();
                    
                } catch (error) {
                    console.error('‚ùå –û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è:', error);
                    alert('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ —Ç—Ä–µ–∫–∞');
                    
                    this.saveBtn.textContent = 'üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ –∫–∞—Ç–∞–ª–æ–≥';
                    this.saveBtn.disabled = false;
                }
            }
        }
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Upload Manager
        let uploadManager;
    </script>
</body>
</html> 