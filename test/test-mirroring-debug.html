<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üî¨ –¢–µ—Å—Ç –ó–µ—Ä–∫–∞–ª–∏—Ä–æ–≤–∞–Ω–∏—è - –û—Ç–ª–∞–¥–∫–∞ –ú–∞—Å–∫–∏</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #1e3c72, #2a5298);
            font-family: Arial, sans-serif;
            color: white;
        }

        .test-container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .test-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .test-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .test-item {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 15px;
            text-align: center;
        }

        .test-item h3 {
            margin: 0 0 10px 0;
            color: #FFD700;
        }

        .test-canvas, .test-video {
            width: 100%;
            max-width: 250px;
            height: 180px;
            border-radius: 10px;
            border: 2px solid #FFD700;
            background: #000;
        }

        .controls {
            text-align: center;
            margin-bottom: 20px;
        }

        .btn {
            background: linear-gradient(45deg, #FF6B6B, #4ECDC4);
            border: none;
            padding: 12px 24px;
            border-radius: 25px;
            color: white;
            font-weight: bold;
            cursor: pointer;
            margin: 5px;
            transition: transform 0.2s;
        }

        .btn:hover {
            transform: scale(1.05);
        }

        .status {
            background: rgba(0, 0, 0, 0.3);
            padding: 15px;
            border-radius: 10px;
            margin-top: 20px;
        }

        .info-panel {
            background: rgba(0, 0, 0, 0.5);
            padding: 20px;
            border-radius: 15px;
            margin-top: 20px;
        }

        .test-explanation {
            background: rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <div class="test-header">
            <h1>üî¨ –¢–µ—Å—Ç –ó–µ—Ä–∫–∞–ª–∏—Ä–æ–≤–∞–Ω–∏—è Selfie Segmentation</h1>
            <p>–ê–Ω–∞–ª–∏–∑ –ø–æ–≤–µ–¥–µ–Ω–∏—è –º–∞—Å–∫–∏ –∏ –≤–∏–¥–µ–æ –¥–ª—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏</p>
        </div>

        <div class="test-explanation">
            <h3>üéØ –¶–µ–ª—å —Ç–µ—Å—Ç–∞:</h3>
            <p>1. –ü–æ–Ω—è—Ç—å –∫–∞–∫ –≤–µ–¥–µ—Ç —Å–µ–±—è –º–∞—Å–∫–∞ Selfie Segmentation –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ –≤–∏–¥–µ–æ</p>
            <p>2. –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω—É—é –ª–æ–≥–∏–∫—É –∑–µ—Ä–∫–∞–ª–∏—Ä–æ–≤–∞–Ω–∏—è</p>
            <p>3. –ù–∞–π—Ç–∏ –æ–ø—Ç–∏–º–∞–ª—å–Ω—ã–π —Å–ø–æ—Å–æ–± —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏</p>
        </div>

        <div class="controls">
            <button class="btn" onclick="startCamera()">üì∑ –ó–∞–ø—É—Å—Ç–∏—Ç—å –∫–∞–º–µ—Ä—É</button>
            <button class="btn" onclick="startSegmentation()">üé® –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å–µ–≥–º–µ–Ω—Ç–∞—Ü–∏—é</button>
            <button class="btn" onclick="toggleVideoMirroring()">üîÑ –ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å –∑–µ—Ä–∫–∞–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –≤–∏–¥–µ–æ</button>
            <button class="btn" onclick="toggleMaskMirroring()">üé≠ –ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å –∑–µ—Ä–∫–∞–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –º–∞—Å–∫–∏</button>
            <button class="btn" onclick="stopAll()">‚èπÔ∏è –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –≤—Å–µ</button>
        </div>

        <div class="test-grid">
            <!-- –û—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–µ –≤–∏–¥–µ–æ -->
            <div class="test-item">
                <h3>üìπ –û—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–µ –≤–∏–¥–µ–æ</h3>
                <video id="originalVideo" class="test-video" autoplay muted playsinline></video>
                <p id="videoStatus">–í–∏–¥–µ–æ –≤—ã–∫–ª—é—á–µ–Ω–æ</p>
            </div>

            <!-- –í–∏–¥–µ–æ —Å –∑–µ—Ä–∫–∞–ª–∏—Ä–æ–≤–∞–Ω–∏–µ–º -->
            <div class="test-item">
                <h3>üîÑ –í–∏–¥–µ–æ —Å –∑–µ—Ä–∫–∞–ª–∏—Ä–æ–≤–∞–Ω–∏–µ–º</h3>
                <video id="mirroredVideo" class="test-video" autoplay muted playsinline style="transform: scaleX(-1);"></video>
                <p id="mirroredVideoStatus">CSS: transform: scaleX(-1)</p>
            </div>

            <!-- –ú–∞—Å–∫–∞ —Å–µ–≥–º–µ–Ω—Ç–∞—Ü–∏–∏ -->
            <div class="test-item">
                <h3>üé≠ –ú–∞—Å–∫–∞ —Å–µ–≥–º–µ–Ω—Ç–∞—Ü–∏–∏ (RAW)</h3>
                <canvas id="maskCanvas" class="test-canvas"></canvas>
                <p id="maskStatus">–ú–∞—Å–∫–∞ –Ω–µ –∞–∫—Ç–∏–≤–Ω–∞</p>
            </div>

            <!-- –ú–∞—Å–∫–∞ —Å –∑–µ—Ä–∫–∞–ª–∏—Ä–æ–≤–∞–Ω–∏–µ–º -->
            <div class="test-item">
                <h3>üîÑ –ú–∞—Å–∫–∞ –∑–µ—Ä–∫–∞–ª–∏—Ä–æ–≤–∞–Ω–Ω–∞—è</h3>
                <canvas id="mirroredMaskCanvas" class="test-canvas"></canvas>
                <p id="mirroredMaskStatus">–ú–∞—Å–∫–∞ —Å scale(-1, 1)</p>
            </div>

            <!-- –†–µ–∑—É–ª—å—Ç–∞—Ç 1: –û–±—ã—á–Ω–æ–µ –Ω–∞–ª–æ–∂–µ–Ω–∏–µ -->
            <div class="test-item">
                <h3>‚úÖ –¢–µ—Å—Ç 1: –û–±—ã—á–Ω–æ–µ –Ω–∞–ª–æ–∂–µ–Ω–∏–µ</h3>
                <canvas id="result1Canvas" class="test-canvas"></canvas>
                <p>–í–∏–¥–µ–æ + –º–∞—Å–∫–∞ (–±–µ–∑ –∑–µ—Ä–∫–∞–ª–∏—Ä–æ–≤–∞–Ω–∏—è)</p>
            </div>

            <!-- –†–µ–∑—É–ª—å—Ç–∞—Ç 2: –ó–µ—Ä–∫–∞–ª–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –≤–∏–¥–µ–æ -->
            <div class="test-item">
                <h3>‚úÖ –¢–µ—Å—Ç 2: –ó–µ—Ä–∫–∞–ª–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –≤–∏–¥–µ–æ</h3>
                <canvas id="result2Canvas" class="test-canvas"></canvas>
                <p>–ó–µ—Ä–∫–∞–ª–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –≤–∏–¥–µ–æ + –º–∞—Å–∫–∞</p>
            </div>

            <!-- –†–µ–∑—É–ª—å—Ç–∞—Ç 3: –ó–µ—Ä–∫–∞–ª–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –º–∞—Å–∫–∞ -->
            <div class="test-item">
                <h3>‚úÖ –¢–µ—Å—Ç 3: –ó–µ—Ä–∫–∞–ª–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –º–∞—Å–∫–∞</h3>
                <canvas id="result3Canvas" class="test-canvas"></canvas>
                <p>–í–∏–¥–µ–æ + –∑–µ—Ä–∫–∞–ª–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –º–∞—Å–∫–∞</p>
            </div>

            <!-- –†–µ–∑—É–ª—å—Ç–∞—Ç 4: –û–±–∞ –∑–µ—Ä–∫–∞–ª–∏—Ä–æ–≤–∞–Ω—ã -->
            <div class="test-item">
                <h3>‚úÖ –¢–µ—Å—Ç 4: –û–±–∞ –∑–µ—Ä–∫–∞–ª–∏—Ä–æ–≤–∞–Ω—ã</h3>
                <canvas id="result4Canvas" class="test-canvas"></canvas>
                <p>–ó–µ—Ä–∫–∞–ª–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –≤–∏–¥–µ–æ + –∑–µ—Ä–∫–∞–ª–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –º–∞—Å–∫–∞</p>
            </div>
        </div>

        <div class="info-panel">
            <h3>üìä –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ç–µ—Å—Ç–µ:</h3>
            <div id="testInfo">
                <p><strong>–°—Ç–∞—Ç—É—Å –∫–∞–º–µ—Ä—ã:</strong> <span id="cameraInfo">–ù–µ –∞–∫—Ç–∏–≤–Ω–∞</span></p>
                <p><strong>–°—Ç–∞—Ç—É—Å —Å–µ–≥–º–µ–Ω—Ç–∞—Ü–∏–∏:</strong> <span id="segmentationInfo">–ù–µ –∞–∫—Ç–∏–≤–Ω–∞</span></p>
                <p><strong>–û–±—Ä–∞–±–æ—Ç–∞–Ω–æ –∫–∞–¥—Ä–æ–≤:</strong> <span id="frameCount">0</span></p>
                <p><strong>–†–∞–∑–º–µ—Ä –≤–∏–¥–µ–æ:</strong> <span id="videoSize">-</span></p>
                <p><strong>–ó–µ—Ä–∫–∞–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –≤–∏–¥–µ–æ:</strong> <span id="videoMirrorStatus">–í—ã–∫–ª—é—á–µ–Ω–æ</span></p>
                <p><strong>–ó–µ—Ä–∫–∞–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –º–∞—Å–∫–∏:</strong> <span id="maskMirrorStatus">–í—ã–∫–ª—é—á–µ–Ω–æ</span></p>
            </div>
        </div>

        <div class="status">
            <h3>üìù –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –∞–Ω–∞–ª–∏–∑–∞:</h3>
            <div id="analysisResults">
                <p>–ó–∞–ø—É—Å—Ç–∏—Ç–µ —Ç–µ—Å—Ç –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤...</p>
            </div>
        </div>
    </div>

    <!-- MediaPipe Selfie Segmentation -->
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/control_utils/control_utils.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/drawing_utils/drawing_utils.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/selfie_segmentation/selfie_segmentation.js" crossorigin="anonymous"></script>

    <script>
        // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
        let originalVideo = null;
        let mirroredVideo = null;
        let selfieSegmentation = null;
        let isProcessing = false;
        let frameCount = 0;
        let videoMirrored = false;
        let maskMirrored = false;
        let currentMask = null;

        // Canvas —ç–ª–µ–º–µ–Ω—Ç—ã
        let maskCanvas, mirroredMaskCanvas, result1Canvas, result2Canvas, result3Canvas, result4Canvas;
        let maskCtx, mirroredMaskCtx, result1Ctx, result2Ctx, result3Ctx, result4Ctx;

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        window.onload = function() {
            originalVideo = document.getElementById('originalVideo');
            mirroredVideo = document.getElementById('mirroredVideo');
            
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è canvas
            maskCanvas = document.getElementById('maskCanvas');
            mirroredMaskCanvas = document.getElementById('mirroredMaskCanvas');
            result1Canvas = document.getElementById('result1Canvas');
            result2Canvas = document.getElementById('result2Canvas');
            result3Canvas = document.getElementById('result3Canvas');
            result4Canvas = document.getElementById('result4Canvas');

            // –ü–æ–ª—É—á–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–≤
            maskCtx = maskCanvas.getContext('2d');
            mirroredMaskCtx = mirroredMaskCanvas.getContext('2d');
            result1Ctx = result1Canvas.getContext('2d');
            result2Ctx = result2Canvas.getContext('2d');
            result3Ctx = result3Canvas.getContext('2d');
            result4Ctx = result4Canvas.getContext('2d');

            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ä–∞–∑–º–µ—Ä—ã canvas
            const canvases = [maskCanvas, mirroredMaskCanvas, result1Canvas, result2Canvas, result3Canvas, result4Canvas];
            canvases.forEach(canvas => {
                canvas.width = 250;
                canvas.height = 180;
            });

            console.log('üî¨ –¢–µ—Å—Ç –∑–µ—Ä–∫–∞–ª–∏—Ä–æ–≤–∞–Ω–∏—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω');
        };

        // –ó–∞–ø—É—Å–∫ –∫–∞–º–µ—Ä—ã
        async function startCamera() {
            try {
                const stream = await navigator.mediaDevices.getUserMedia({
                    video: { 
                        width: { ideal: 640 },
                        height: { ideal: 480 },
                        facingMode: 'user'
                    }
                });

                originalVideo.srcObject = stream;
                mirroredVideo.srcObject = stream;

                originalVideo.onloadedmetadata = () => {
                    updateInfo('cameraInfo', '–ê–∫—Ç–∏–≤–Ω–∞');
                    updateInfo('videoSize', `${originalVideo.videoWidth}x${originalVideo.videoHeight}`);
                    updateInfo('videoStatus', '–í–∏–¥–µ–æ –∞–∫—Ç–∏–≤–Ω–æ');
                    updateInfo('mirroredVideoStatus', 'CSS: transform: scaleX(-1) –ê–ö–¢–ò–í–ù–û');
                    
                    console.log('üìπ –ö–∞–º–µ—Ä–∞ –∑–∞–ø—É—â–µ–Ω–∞');
                };

            } catch (error) {
                console.error('‚ùå –û—à–∏–±–∫–∞ –∑–∞–ø—É—Å–∫–∞ –∫–∞–º–µ—Ä—ã:', error);
                updateAnalysis('‚ùå –û—à–∏–±–∫–∞ –∑–∞–ø—É—Å–∫–∞ –∫–∞–º–µ—Ä—ã: ' + error.message);
            }
        }

        // –ó–∞–ø—É—Å–∫ —Å–µ–≥–º–µ–Ω—Ç–∞—Ü–∏–∏
        async function startSegmentation() {
            try {
                if (!originalVideo || originalVideo.readyState < 2) {
                    updateAnalysis('‚ö†Ô∏è –°–Ω–∞—á–∞–ª–∞ –∑–∞–ø—É—Å—Ç–∏—Ç–µ –∫–∞–º–µ—Ä—É');
                    return;
                }

                selfieSegmentation = new SelfieSegmentation({
                    locateFile: (file) => `https://cdn.jsdelivr.net/npm/@mediapipe/selfie_segmentation/${file}`
                });

                selfieSegmentation.setOptions({
                    modelSelection: 0,
                    selfieMode: true
                });

                selfieSegmentation.onResults((results) => {
                    processSegmentationResults(results);
                });

                isProcessing = true;
                processFrame();

                updateInfo('segmentationInfo', '–ê–∫—Ç–∏–≤–Ω–∞');
                updateInfo('maskStatus', '–ú–∞—Å–∫–∞ –∞–∫—Ç–∏–≤–Ω–∞');
                updateInfo('mirroredMaskStatus', '–ú–∞—Å–∫–∞ —Å scale(-1, 1) –ê–ö–¢–ò–í–ù–ê');

                console.log('üé® Selfie Segmentation –∑–∞–ø—É—â–µ–Ω');

            } catch (error) {
                console.error('‚ùå –û—à–∏–±–∫–∞ –∑–∞–ø—É—Å–∫–∞ —Å–µ–≥–º–µ–Ω—Ç–∞—Ü–∏–∏:', error);
                updateAnalysis('‚ùå –û—à–∏–±–∫–∞ –∑–∞–ø—É—Å–∫–∞ —Å–µ–≥–º–µ–Ω—Ç–∞—Ü–∏–∏: ' + error.message);
            }
        }

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ —Å–µ–≥–º–µ–Ω—Ç–∞—Ü–∏–∏
        function processSegmentationResults(results) {
            if (!results.segmentationMask) return;

            currentMask = results.segmentationMask;
            frameCount++;
            updateInfo('frameCount', frameCount);

            // –û—á–∏—â–∞–µ–º –≤—Å–µ canvas
            clearAllCanvas();

            // 1. –†–∏—Å—É–µ–º RAW –º–∞—Å–∫—É
            maskCtx.drawImage(currentMask, 0, 0, maskCanvas.width, maskCanvas.height);

            // 2. –†–∏—Å—É–µ–º –∑–µ—Ä–∫–∞–ª–∏—Ä–æ–≤–∞–Ω–Ω—É—é –º–∞—Å–∫—É
            mirroredMaskCtx.save();
            mirroredMaskCtx.scale(-1, 1);
            mirroredMaskCtx.drawImage(currentMask, -mirroredMaskCanvas.width, 0, mirroredMaskCanvas.width, mirroredMaskCanvas.height);
            mirroredMaskCtx.restore();

            // 3. –¢–µ—Å—Ç 1: –û–±—ã—á–Ω–æ–µ –Ω–∞–ª–æ–∂–µ–Ω–∏–µ (–≤–∏–¥–µ–æ + –º–∞—Å–∫–∞)
            result1Ctx.drawImage(originalVideo, 0, 0, result1Canvas.width, result1Canvas.height);
            result1Ctx.globalCompositeOperation = 'multiply';
            result1Ctx.drawImage(currentMask, 0, 0, result1Canvas.width, result1Canvas.height);
            result1Ctx.globalCompositeOperation = 'source-over';

            // 4. –¢–µ—Å—Ç 2: –ó–µ—Ä–∫–∞–ª–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –≤–∏–¥–µ–æ + –æ–±—ã—á–Ω–∞—è –º–∞—Å–∫–∞
            result2Ctx.save();
            result2Ctx.scale(-1, 1);
            result2Ctx.drawImage(originalVideo, -result2Canvas.width, 0, result2Canvas.width, result2Canvas.height);
            result2Ctx.restore();
            result2Ctx.globalCompositeOperation = 'multiply';
            result2Ctx.drawImage(currentMask, 0, 0, result2Canvas.width, result2Canvas.height);
            result2Ctx.globalCompositeOperation = 'source-over';

            // 5. –¢–µ—Å—Ç 3: –û–±—ã—á–Ω–æ–µ –≤–∏–¥–µ–æ + –∑–µ—Ä–∫–∞–ª–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –º–∞—Å–∫–∞
            result3Ctx.drawImage(originalVideo, 0, 0, result3Canvas.width, result3Canvas.height);
            result3Ctx.globalCompositeOperation = 'multiply';
            result3Ctx.save();
            result3Ctx.scale(-1, 1);
            result3Ctx.drawImage(currentMask, -result3Canvas.width, 0, result3Canvas.width, result3Canvas.height);
            result3Ctx.restore();
            result3Ctx.globalCompositeOperation = 'source-over';

            // 6. –¢–µ—Å—Ç 4: –ó–µ—Ä–∫–∞–ª–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –≤–∏–¥–µ–æ + –∑–µ—Ä–∫–∞–ª–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –º–∞—Å–∫–∞
            result4Ctx.save();
            result4Ctx.scale(-1, 1);
            result4Ctx.drawImage(originalVideo, -result4Canvas.width, 0, result4Canvas.width, result4Canvas.height);
            result4Ctx.restore();
            result4Ctx.globalCompositeOperation = 'multiply';
            result4Ctx.save();
            result4Ctx.scale(-1, 1);
            result4Ctx.drawImage(currentMask, -result4Canvas.width, 0, result4Canvas.width, result4Canvas.height);
            result4Ctx.restore();
            result4Ctx.globalCompositeOperation = 'source-over';

            // –ê–Ω–∞–ª–∏–∑ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –∫–∞–∂–¥—ã–µ 30 –∫–∞–¥—Ä–æ–≤
            if (frameCount % 30 === 0) {
                analyzeResults();
            }
        }

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–∞–¥—Ä–æ–≤
        function processFrame() {
            if (!isProcessing || !selfieSegmentation || !originalVideo) return;

            if (originalVideo.readyState >= 2) {
                selfieSegmentation.send({ image: originalVideo });
            }

            requestAnimationFrame(processFrame);
        }

        // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –∑–µ—Ä–∫–∞–ª–∏—Ä–æ–≤–∞–Ω–∏—è –≤–∏–¥–µ–æ
        function toggleVideoMirroring() {
            videoMirrored = !videoMirrored;
            const status = videoMirrored ? '–í–∫–ª—é—á–µ–Ω–æ' : '–í—ã–∫–ª—é—á–µ–Ω–æ';
            updateInfo('videoMirrorStatus', status);
            
            if (videoMirrored) {
                originalVideo.style.transform = 'scaleX(-1)';
            } else {
                originalVideo.style.transform = 'none';
            }
            
            console.log('üîÑ –ó–µ—Ä–∫–∞–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –≤–∏–¥–µ–æ:', status);
        }

        // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –∑–µ—Ä–∫–∞–ª–∏—Ä–æ–≤–∞–Ω–∏—è –º–∞—Å–∫–∏
        function toggleMaskMirroring() {
            maskMirrored = !maskMirrored;
            const status = maskMirrored ? '–í–∫–ª—é—á–µ–Ω–æ' : '–í—ã–∫–ª—é—á–µ–Ω–æ';
            updateInfo('maskMirrorStatus', status);
            
            console.log('üé≠ –ó–µ—Ä–∫–∞–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –º–∞—Å–∫–∏:', status);
        }

        // –ê–Ω–∞–ª–∏–∑ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
        function analyzeResults() {
            const analysis = `
                <h4>üìä –ê–Ω–∞–ª–∏–∑ –∫–∞–¥—Ä–∞ ${frameCount}:</h4>
                <p><strong>–¢–µ—Å—Ç 1 (–≤–∏–¥–µ–æ + –º–∞—Å–∫–∞):</strong> ${analyzeTest('result1')}</p>
                <p><strong>–¢–µ—Å—Ç 2 (–∑–µ—Ä–∫–∞–ª–æ –≤–∏–¥–µ–æ + –º–∞—Å–∫–∞):</strong> ${analyzeTest('result2')}</p>
                <p><strong>–¢–µ—Å—Ç 3 (–≤–∏–¥–µ–æ + –∑–µ—Ä–∫–∞–ª–æ –º–∞—Å–∫–∏):</strong> ${analyzeTest('result3')}</p>
                <p><strong>–¢–µ—Å—Ç 4 (–∑–µ—Ä–∫–∞–ª–æ –≤–∏–¥–µ–æ + –∑–µ—Ä–∫–∞–ª–æ –º–∞—Å–∫–∏):</strong> ${analyzeTest('result4')}</p>
                <hr>
                <p><strong>üí° –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:</strong> –í–Ω–∏–º–∞—Ç–µ–ª—å–Ω–æ —Å—Ä–∞–≤–Ω–∏—Ç–µ –≤—Å–µ 4 —Ç–µ—Å—Ç–∞. –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç - —Ç–æ—Ç, –≥–¥–µ –º–∞—Å–∫–∞ —Ç–æ—á–Ω–æ —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å –∫–æ–Ω—Ç—É—Ä–æ–º —á–µ–ª–æ–≤–µ–∫–∞.</p>
            `;
            
            updateAnalysis(analysis);
        }

        // –ê–Ω–∞–ª–∏–∑ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Ç–µ—Å—Ç–∞
        function analyzeTest(testId) {
            // –ó–¥–µ—Å—å –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –±–æ–ª–µ–µ —Å–ª–æ–∂–Ω—É—é –ª–æ–≥–∏–∫—É –∞–Ω–∞–ª–∏–∑–∞
            return "–í–∏–∑—É–∞–ª—å–Ω–æ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ –º–∞—Å–∫–∏ –∏ –∫–æ–Ω—Ç—É—Ä–∞ —á–µ–ª–æ–≤–µ–∫–∞";
        }

        // –û—á–∏—Å—Ç–∫–∞ –≤—Å–µ—Ö canvas
        function clearAllCanvas() {
            const contexts = [maskCtx, mirroredMaskCtx, result1Ctx, result2Ctx, result3Ctx, result4Ctx];
            contexts.forEach(ctx => {
                ctx.clearRect(0, 0, ctx.canvas.width, ctx.canvas.height);
            });
        }

        // –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –≤—Å–µ—Ö –ø—Ä–æ—Ü–µ—Å—Å–æ–≤
        function stopAll() {
            isProcessing = false;
            
            if (originalVideo && originalVideo.srcObject) {
                originalVideo.srcObject.getTracks().forEach(track => track.stop());
                originalVideo.srcObject = null;
                mirroredVideo.srcObject = null;
            }

            clearAllCanvas();
            
            updateInfo('cameraInfo', '–ù–µ –∞–∫—Ç–∏–≤–Ω–∞');
            updateInfo('segmentationInfo', '–ù–µ –∞–∫—Ç–∏–≤–Ω–∞');
            updateInfo('videoStatus', '–í–∏–¥–µ–æ –≤—ã–∫–ª—é—á–µ–Ω–æ');
            updateInfo('maskStatus', '–ú–∞—Å–∫–∞ –Ω–µ –∞–∫—Ç–∏–≤–Ω–∞');
            
            console.log('‚èπÔ∏è –í—Å–µ –ø—Ä–æ—Ü–µ—Å—Å—ã –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã');
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏
        function updateInfo(elementId, text) {
            const element = document.getElementById(elementId);
            if (element) {
                element.textContent = text;
            }
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∞–Ω–∞–ª–∏–∑–∞
        function updateAnalysis(html) {
            const element = document.getElementById('analysisResults');
            if (element) {
                element.innerHTML = html;
            }
        }
    </script>
</body>
</html> 