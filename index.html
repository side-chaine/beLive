<!DOCTYPE html>
<html lang="en">
<head>
<link rel="manifest" href="/beLive/manifest.webmanifest">
  <meta name="theme-color" content="#6366f1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <link rel="apple-touch-icon" href="/beLive/img/icon-192.png">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=0.5, maximum-scale=0.5, user-scalable=no">
    <title>beLive - –¢—Ä–∞–Ω—Å–ª—è—Ü–∏–∏ –¥–ª—è –º—É–∑—ã–∫–∞–Ω—Ç–æ–≤</title>
    <link rel="icon" href="data:, ">
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="css/transport-controls.css">
    <link rel="stylesheet" href="css/karaoke-styles.css">
    <link rel="stylesheet" href="css/block-type-markers.css">
    <link rel="stylesheet" href="css/live-mode.css">
    <link rel="stylesheet" href="css/mode-buttons-override.css">
    <link rel="stylesheet" href="css/font-selector.css">
    <link rel="stylesheet" href="css/waveform-source-switcher.css">
    <link rel="stylesheet" href="css/avatar-page.css">
    <link rel="stylesheet" href="css/home-button-enhanced.css">
    <link rel="stylesheet" href="css/bmp-styles.css">
    <link rel="stylesheet" href="css/catalog-v2.css">
    <link rel="stylesheet" href="css/dark-overlay.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    
    <!-- MediaPipe Official CDN Libraries -->
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/control_utils/control_utils.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/drawing_utils/drawing_utils.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/face_detection/face_detection.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/face_mesh/face_mesh.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands/hands.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/pose/pose.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/holistic/holistic.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/selfie_segmentation/selfie_segmentation.js" crossorigin="anonymous"></script>
    
    <!-- Pitchy Library for Professional Pitch Detection -->
    <script type="module">
        import { PitchDetector } from "https://esm.sh/pitchy@4";
        window.PitchDetector = PitchDetector;
        console.log('‚úÖ Pitchy –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞ –≤ beLive');
    </script>
    <link rel="stylesheet" href="css/rehearsal-styles.css">
    <link rel="stylesheet" href="css/concert-styles.css">
    <link rel="stylesheet" href="css/karaoke-styles.css">
    <link rel="stylesheet" href="css/conveyor-styles.css"> <!-- MOVED: –°—Ç–∏–ª–∏ –¥–ª—è –∫–æ–Ω–≤–µ–π–µ—Ä–∞ -->
    <link rel="stylesheet" href="css/loop-button-styles.css">

    <!-- Google Fonts for Font Selector -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&family=Montserrat:wght@400;700&family=Open+Sans:wght@400;700&family=Bebas+Neue&family=Playfair+Display:wght@400;700&family=Merriweather:wght@400;700&family=Lora:wght@400;700&family=PT+Serif:wght@400;700&family=Oswald:wght@400;700&family=Lobster&family=Pacifico&family=Caveat&display=swap" rel="stylesheet">
    <!-- Orbitron font for cockpit design -->
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;700;900&display=swap" rel="stylesheet">
    <script src="js/dev-flags.js"></script>

    <!-- Export Feature Styles -->
    <style>
        .glass-btn.export-blocks-btn { /* —Å—Ç–µ–∫–ª—è–Ω–Ω–∞—è, –∫–∞–∫ —É –≤–∞—Å */
             background: rgba(255, 255, 255, 0.1);
             border: 1px solid rgba(255, 255, 255, 0.2);
             color: white;
             padding: 8px 15px;
             border-radius: 8px;
             cursor: pointer;
             font-size: 1em;
             backdrop-filter: blur(5px);
             transition: all 0.3s ease;
          }
          .glass-btn.export-blocks-btn.active { background: rgba(255,180,68,0.2); border-color: rgba(255,180,68,0.8); }
          .loop-wagon.is-export-selected { outline: 2px solid #ffb444; outline-offset: -2px; background-color: rgba(255,180,68,0.15); }
          .export-mini { position: fixed; left: 50%; top: 50%; transform: translate(-50%, -50%); backdrop-filter: blur(6px); background: rgba(30,30,30,0.6); border: 1px solid rgba(255,255,255,0.2); border-radius: 10px; padding: 10px; z-index: 99999; min-width: 200px; }
        .export-mini.hidden { display:none; }
        .export-mini__row { display:flex; gap:8px; margin-bottom:6px; }
        .export-mini__hint { font-size: 0.8em; color: rgba(255,255,255,0.7); margin-top: 8px; text-align: center; }
        .export-mini .mini-opt, .export-mini .mini-confirm, .export-mini .mini-cancel { /* —Å—Ç–∏–ª–∏ –¥–ª—è –∫–Ω–æ–ø–æ–∫ –≤–Ω—É—Ç—Ä–∏ –º–æ–¥–∞–ª–∫–∏, –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å .unified-btn –∏–ª–∏ .glass-btn –µ—Å–ª–∏ –æ–Ω–∏ —É–∂–µ –µ—Å—Ç—å */ padding: 6px 10px; border-radius: 6px; border: 1px solid rgba(255,255,255,0.2); background: rgba(50,50,50,0.4); color: white; cursor: pointer; flex-grow: 1; }
        .export-mini .mini-confirm { background: linear-gradient(90deg, #ffa53a, #ffe08e); border-color: #ffb444; }
        .export-mini .mini-cancel { background: rgba(80,80,80,0.4); }
        .export-mini .mini-opt:hover, .export-mini .mini-confirm:hover, .export-mini .mini-cancel:hover { opacity: 0.8; }
        /* –ü—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä */
        .export-mini__progress { position: relative; height: 3px; background: rgba(255,255,255,0.1); border-radius: 2px; overflow:hidden; margin-top: 8px;}
        .export-mini__progress .bar { display:block; height:100%; width:0%; background: linear-gradient(90deg, #ffa53a, #ffe08e); }
        .export-mini.busy .mini-confirm, .export-mini.busy .mini-cancel, .export-mini.busy .mini-opt { opacity: 0.6; pointer-events:none; }
    </style>
</head>
<body>
    <div class="app-container" id="app-root">
        <!-- 1. –í–µ—Ä—Ö–Ω—è—è –ø–∞–Ω–µ–ª—å —Å –ª–æ–≥–æ—Ç–∏–ø–æ–º –∏ –∫–Ω–æ–ø–∫–∞–º–∏ —Ä–µ–∂–∏–º–æ–≤ -->
        <header class="app-header">
            <div class="header-content glass-effect">
                <!-- –ì—Ä—É–ø–ø–∞ 1: –õ–æ–≥–æ—Ç–∏–ø –∏ –ª–µ–≤—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã -->
                <div class="header-left-group" style="display: flex; align-items: center; gap: 5px;">
                <button id="home-btn" class="home-btn" title="–í–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞ —Å—Ç–∞—Ä—Ç–æ–≤—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É">
                    <span class="home-logo">beLIVE</span>
                </button>
                
                <!-- BPM –∫–æ–Ω—Ç—Ä–æ–ª—å –¥–ª—è —Ä–µ–∂–∏–º–∞ —Ä–µ–ø–µ—Ç–∏—Ü–∏–∏ (–º–µ–∂–¥—É –ª–æ–≥–æ—Ç–∏–ø–æ–º –∏ —Ä–µ–∂–∏–º–∞–º–∏) -->
                <div class="bpm-controls" id="bpm-controls" style="position: relative; display: flex; align-items: center; gap: 8px;">
                    <button class="bmp-btn" id="bpm-down" title="–ó–∞–º–µ–¥–ª–∏—Ç—å —Ç–µ–º–ø –Ω–∞ 5%">‚àí5</button>
                    <button class="bmp-btn bpm-value-btn" id="bpm-value" title="–°–±—Ä–æ—Å–∏—Ç—å –∫ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–º—É —Ç–µ–º–ø—É">100%</button>
                    <button class="bmp-btn" id="bpm-up" title="–£—Å–∫–æ—Ä–∏—Ç—å —Ç–µ–º–ø –Ω–∞ 5%">+5</button>
                </div>
                </div>
                
                <!-- –ì—Ä—É–ø–ø–∞ 2: –¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–µ –∫–Ω–æ–ø–∫–∏ —Ä–µ–∂–∏–º–æ–≤ (–ø–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä—É—é—Ç—Å—è –∞–±—Å–æ–ª—é—Ç–Ω–æ) -->
                <div class="mode-buttons">
                    <button id="concert-mode" class="mode-button btn-concert" data-mode="concert">–ö–æ–Ω—Ü–µ—Ä—Ç–Ω—ã–π</button>
                    <button id="karaoke-mode" class="mode-button btn-karaoke" data-mode="karaoke">–ö–∞—Ä–∞–æ–∫–µ</button>
                    <button id="rehearsal-mode" class="mode-button btn-rehearsal" data-mode="rehearsal">–†–µ–ø–µ—Ç–∏—Ü–∏—è</button>
                    <button id="live-mode" class="mode-button btn-live" data-mode="live">LIVE</button>
                </div>
                
                <!-- –ì—Ä—É–ø–ø–∞ 3: –ü—Ä–∞–≤—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã (–ö–∞—Ç–∞–ª–æ–≥ –∏ –ú–∞—Å—à—Ç–∞–±) -->
                <div class="header-right-group">
                <div class="scale-controls">
                        <button class="scale-btn" id="scale-down" title="–£–º–µ–Ω—å—à–∏—Ç—å —à—Ä–∏—Ñ—Ç">-</button>
                        <button class="scale-btn scale-value-btn" id="scale-value" title="–°–±—Ä–æ—Å–∏—Ç—å –º–∞—Å—à—Ç–∞–±">100%</button>
                        <button class="scale-btn" id="scale-up" title="–£–≤–µ–ª–∏—á–∏—Ç—å —à—Ä–∏—Ñ—Ç">+</button>
                    </div>
                    <button id="catalog-btn" class="animated-gradient-btn">Catalog</button>
                    <div class="user-avatar" id="avatar-btn" title="Avatar Studio">üë§</div>
                </div>
            </div>
        </header>
        
        <!-- 3. –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è —Ç–µ–∫—Å—Ç–∞ -->
        <div id="lyrics-container">
            <div id="base-text-overlay" style="display:none"></div>
            <div id="lyrics-display">
                <div class="welcome-message">
                    <h1>Welcome to beLIVE</h1>
                    <p>Your lyrics assistant for live performances</p>
                    <p>Click the Catalog button to start adding tracks</p>
                </div>
            </div>
        </div>
        
        <!-- 4. –ù–∏–∂–Ω—è—è –ø–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–ª–µ–µ—Ä–æ–º (–ü–ï–†–ï–ú–ï–©–ï–ù–ê –í–ù–ò–ó) -->
        <div id="transport-controls">
            <div class="transport-controls-row" id="main-control-groups">
                <!-- Group 1: Playback -->
                <div class="control-group">
                    <button id="play-pause" class="unified-btn">Play</button>
                    <button id="monitor-btn" class="unified-btn" title="Monitor settings">üéß Monitor</button>
                </div>
                
                <!-- Group 2: Volume -->
                <div class="control-group">
                <div class="volume-controls">
                    <div class="volume-control">
                        <label>Instrumental</label>
                            <input type="range" id="instrumental-volume" class="volume-slider" min="0" max="100" value="100">
                    </div>
                    <div class="volume-control">
                        <label>Vocals</label>
                            <input type="range" id="vocals-volume" class="volume-slider" min="0" max="100" value="100">
                        </div>
                    </div>
                </div>
                
                <!-- Group 3: Core Tools -->
                <div class="control-group">
                    <button id="toggle-loopblock-mode" class="unified-btn">Operator</button>
                    <div id="ai-model-selection-hub" class="ai-model-dropdown hidden">
                        <div class="ai-model-dropdown-list" id="ai-model-selection-hub-list"></div>
                    </div>
                    <button id="style-selector-btn" class="unified-btn" title="Select text style">
                    <i class="fas fa-text-height"></i> Styles
                </button>
                    <button id="piano-keyboard-btn" class="unified-btn" title="–ê–Ω–∞–ª–∏–∑ —Ç–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏">
                        <i class="fas fa-chart-line"></i> Pitch
                </button>
                    <button id="mask-mode-btn" class="unified-btn" title="–ú–∞—Å–∫–∏ –∏ —ç—Ñ—Ñ–µ–∫—Ç—ã">
                        <i class="fas fa-theater-masks"></i> –ú–∞—Å–∫–∏
                </button>
                </div>

                <!-- Group 4: Sync & Mic -->
                <div class="control-group">
                    <button id="sync-btn" class="unified-btn" title="–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Ç–µ–∫—Å—Ç–∞ –∏ –º—É–∑—ã–∫–∏">Sync</button>
                    <div class="mic-control">
                        <span>Mic:</span>
                        <input type="range" id="mic-volume" class="mic-volume-slider volume-slider" min="0" max="100" value="70" title="–ì—Ä–æ–º–∫–æ—Å—Ç—å –º–∏–∫—Ä–æ—Ñ–æ–Ω–∞">
                        <button id="mic-toggle-btn" class="unified-btn" title="–í–∫–ª—é—á–∏—Ç—å/–≤—ã–∫–ª—é—á–∏—Ç—å –º–∏–∫—Ä–æ—Ñ–æ–Ω">
                            <i class="fas fa-microphone"></i>
                </button>
                    </div>
                    <div class="vocal-mix-control">
                        <label class="switch">
                            <input type="checkbox" id="vocal-mix-toggle">
                            <span class="slider round"></span>
                        </label>
                        <span class="vocal-mix-label">VocalMix</span>
                    </div>
                </div>

                <!-- Group 5: Catalog -->
                <div class="control-group">
                    <!-- BUTTON MOVED TO HEADER -->
                </div>
            </div>
            
            <div class="transport-controls-row" id="progress-and-toggle-row">
                <div id="transport-toggle" title="–ü–æ–∫–∞–∑–∞—Ç—å/—Å–∫—Ä—ã—Ç—å –ø–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è">
                    <i class="fas fa-sliders-h"></i>
                </div>
                <div id="time-display">0:00 / 0:00</div>
                <div id="progress-bar-container">
                    <div id="progress-bar-loaded"></div>
                    <div id="progress-bar"></div>
                    <div id="progress-tooltip">0:00</div>
                </div>
            </div>
        </div>
        
        <!-- Piano Keyboard Container (initially hidden) -->
        <div id="piano-keyboard-container" class="hidden">
            <div class="piano-header">
                <button id="back-to-transport" class="back-button" title="–í–µ—Ä–Ω—É—Ç—å—Å—è –∫ —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–Ω–æ–π –ø–∞–Ω–µ–ª–∏">
                    <i class="fas fa-arrow-left"></i> –¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç
                </button>
                <h2>üéπ –ê–Ω–∞–ª–∏–∑ –≤–æ–∫–∞–ª–∞ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏</h2>
                <div class="piano-status" id="piano-status">–ì–æ—Ç–æ–≤ –∫ –∞–Ω–∞–ª–∏–∑—É</div>
            </div>
            
            <!-- Professional Settings (compact) -->
            <div class="piano-settings">
                <div class="setting-group">
                    <label>üéµ –î–∏–∞–ø–∞–∑–æ–Ω: <span id="piano-freq-range">65-1050 Hz</span></label>
                    <input type="range" id="piano-freq-range-slider" min="50" max="2000" value="1050" step="50">
                </div>
                <div class="setting-group">
                    <label>üéØ –ß—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å: <span id="piano-sensitivity">80%</span></label>
                    <input type="range" id="piano-sensitivity-slider" min="50" max="95" value="80" step="5">
                </div>
                <div class="setting-group">
                    <label>üßπ –§–∏–ª—å—Ç—Ä: <span id="piano-filter">200–º—Å</span></label>
                    <input type="range" id="piano-filter-slider" min="50" max="500" value="200" step="50">
                </div>
            </div>
            
            <!-- Piano Visualization Area -->
            <div class="piano-visualization">
                <canvas id="piano-canvas"></canvas>
            </div>
        </div>
        
        <!-- Track Catalog (initially hidden) -->
        <div id="track-catalog" class="hidden">
            <div class="catalog-header">
                <h2>Track Catalog</h2>
                <div class="catalog-actions">
                    <button id="clear-catalog" class="btn-danger" title="–£–¥–∞–ª–∏—Ç—å –≤—Å–µ —Ç—Ä–µ–∫–∏ –∏–∑ –∫–∞—Ç–∞–ª–æ–≥–∞">–û—á–∏—Å—Ç–∏—Ç—å –∫–∞—Ç–∞–ª–æ–≥</button>
                    <button id="close-catalog">–ó–∞–∫—Ä—ã—Ç—å</button>
                </div>
            </div>
            <div id="catalog-tracks"></div>
            <div id="upload-section">
                <h3>Upload New Track</h3>
                <div class="upload-container">
                    <div class="upload-row">
                        <div class="upload-box">
                            <label>Instrumental Track</label>
                            <div id="instrumental-dropzone" class="dropzone">
                                <div class="dropzone-content">
                                    <div class="icon">üéπ</div>
                                    <p>Drop track file</p>
                                </div>
                                <input type="file" id="instrumental-upload" accept="audio/*">
                            </div>
                        </div>
                        
                        <div class="upload-box">
                            <label>Vocals Track (optional)</label>
                            <div id="vocals-dropzone" class="dropzone">
                                <div class="dropzone-content">
                                    <div class="icon">üé§</div>
                                    <p>Drop vocals file</p>
                                </div>
                                <input type="file" id="vocals-upload" accept="audio/*">
                            </div>
                        </div>
                        
                        <div class="upload-box">
                            <label>Lyrics</label>
                            <div id="lyrics-dropzone" class="dropzone">
                                <div class="dropzone-content">
                                    <div class="icon">üìù</div>
                                    <p>Drop text file</p>
                                </div>
                                <input type="file" id="lyrics-upload" accept=".txt,.text,.lrc,.md,.rtf,.doc,.docx,.srt,.sub,.vtt,.ass,.ssa,.xml,.json,.csv,text/plain,text/rtf,application/rtf,application/msword,application/vnd.openxmlformats-officedocument.wordprocessingml.document,text/*,application/json,application/xml">
                            </div>
                        </div>
                    </div>
                    
                    <button id="upload-btn">Upload Track</button>
                    
                    <div class="import-markers-container">
                        <hr>
                        <h3>Restore Track Markers</h3>
                        <p class="info-text">Import track markers from a previously saved JSON file</p>
                        <div class="import-box">
                            <input type="file" id="import-markers-input" accept=".json" style="display:none">
                            <button id="import-markers-btn" class="btn-secondary">
                                <span class="icon">üì•</span> Import Markers
                            </button>
                            <span id="import-file-name">No file selected</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Style Selector Container (initially hidden) - REMOVED, handled by JS -->
        
        <!-- –ö–æ–Ω—Ü–µ–ø—Ü–∏—è "–ñ–∏–≤–∞—è –õ–µ–Ω—Ç–∞" (—Å–∫—Ä—ã—Ç–∞ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é) -->
        <div id="live-feed-concept" class="hidden">
            <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ -->
            <header class="live-feed-header">
                <div class="logo">
                    <span class="logo-text">beLIVE</span>
                    <span class="tagline">–ñ–∏–≤–∞—è –ª–µ–Ω—Ç–∞</span>
                </div>
                <div class="user-info">
                    <div class="progress-ring">
                        <div class="daily-progress">
                            <span class="progress-text">3/5</span>
                            <span class="progress-label">—Ü–µ–ª–∏</span>
                        </div>
                    </div>
                    <div class="user-avatar">üë§</div>
                </div>
                <button id="back-to-hall" class="back-to-hall-btn" title="–í–µ—Ä–Ω—É—Ç—å—Å—è –≤ –∫–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–π –∑–∞–ª">
                    ‚Üê –ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–π –∑–∞–ª
                </button>
            </header>
            
            <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç -->
            <main class="live-feed-main">
                <!-- –õ–µ–≤–∞—è –ø–∞–Ω–µ–ª—å: Live –ø–æ—Ç–æ–∫–∏ -->
                <section class="live-streams">
                    <div class="section-header">
                        <h2>üî¥ Live Streams</h2>
                        <div class="filter-tabs">
                            <button class="tab active" data-filter="karaoke">–ö–∞—Ä–∞–æ–∫–µ</button>
                            <button class="tab" data-filter="training">–û–±—É—á–µ–Ω–∏–µ</button>
                            <button class="tab" data-filter="duet">–î—É—ç—Ç—ã</button>
                        </div>
                    </div>
                    
                    <div class="streams-grid">
                        <div class="stream-card" data-type="karaoke">
                            <div class="stream-preview">
                                <div class="stream-thumbnail">üé§</div>
                                <div class="live-indicator">LIVE</div>
                                <div class="viewer-count">1.2K</div>
                            </div>
                            <div class="stream-info">
                                <h3>–ê–Ω–Ω–∞ –ø–æ–µ—Ç —Ä–æ–∫-—Ö–∏—Ç—ã</h3>
                                <p>–ü—Ä–∏—Å–æ–µ–¥–∏–Ω—è–π—Ç–µ—Å—å –∫ –∫–∞—Ä–∞–æ–∫–µ!</p>
                                <div class="stream-actions">
                                    <button class="join-btn">üéµ –°–ø–µ—Ç—å –¥—É—ç—Ç</button>
                                    <button class="watch-btn">üëÅÔ∏è –°–º–æ—Ç—Ä–µ—Ç—å</button>
                                </div>
                            </div>
                        </div>
                        
                        <div class="stream-card" data-type="training">
                            <div class="stream-preview">
                                <div class="stream-thumbnail">üé≠</div>
                                <div class="live-indicator">LIVE</div>
                                <div class="viewer-count">856</div>
                            </div>
                            <div class="stream-info">
                                <h3>–£—Ä–æ–∫ –≤–æ–∫–∞–ª–∞: –¥—ã—Ö–∞–Ω–∏–µ</h3>
                                <p>–ë–∞–∑–æ–≤—ã–µ —Ç–µ—Ö–Ω–∏–∫–∏ –¥–ª—è –Ω–∞—á–∏–Ω–∞—é—â–∏—Ö</p>
                                <div class="stream-actions">
                                    <button class="join-btn">üìö –£—á–∏—Ç—å—Å—è</button>
                                    <button class="watch-btn">üëÅÔ∏è –°–º–æ—Ç—Ä–µ—Ç—å</button>
                                </div>
                            </div>
                        </div>
                        
                        <div class="stream-card" data-type="karaoke">
                            <div class="stream-preview">
                                <div class="stream-thumbnail">üåü</div>
                                <div class="live-indicator">LIVE</div>
                                <div class="viewer-count">2.1K</div>
                            </div>
                            <div class="stream-info">
                                <h3>–ë–∏—Ç–≤–∞ –≥–æ–ª–æ—Å–æ–≤</h3>
                                <p>–ö—Ç–æ —Å–ø–æ–µ—Ç –ª—É—á—à–µ? –ì–æ–ª–æ—Å—É–π!</p>
                                <div class="stream-actions">
                                    <button class="join-btn">‚öîÔ∏è –£—á–∞—Å—Ç–≤–æ–≤–∞—Ç—å</button>
                                    <button class="watch-btn">üëÅÔ∏è –°–º–æ—Ç—Ä–µ—Ç—å</button>
                                </div>
                            </div>
                        </div>

                        <div class="stream-card" data-type="duet">
                            <div class="stream-preview">
                                <div class="stream-thumbnail">üé∏</div>
                                <div class="live-indicator">LIVE</div>
                                <div class="viewer-count">643</div>
                            </div>
                            <div class="stream-info">
                                <h3>–î–∂–µ–º-—Å–µ—Å—Å–∏—è</h3>
                                <p>–ò–º–ø—Ä–æ–≤–∏–∑–∞—Ü–∏—è —Å –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞–º–∏</p>
                                <div class="stream-actions">
                                    <button class="join-btn">üé∂ –ò–≥—Ä–∞—Ç—å</button>
                                    <button class="watch-btn">üëÅÔ∏è –°–º–æ—Ç—Ä–µ—Ç—å</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>
                
                <!-- –ü—Ä–∞–≤–∞—è –ø–∞–Ω–µ–ª—å -->
                <aside class="live-feed-sidebar">
                    <section>
                        <h3>üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç</h3>
                        <div class="action-buttons">
                            <button class="quick-btn concert" data-mode="concert">–ö–æ–Ω—Ü–µ—Ä—Ç</button>
                            <button class="quick-btn karaoke" data-mode="karaoke">–ö–∞—Ä–∞–æ–∫–µ</button>
                            <button class="quick-btn practice" data-mode="rehearsal">–†–µ–ø–µ—Ç–∏—Ü–∏—è</button>
                            <button class="quick-btn live" data-mode="live">LIVE</button>
                        </div>
                    </section>
                    
                    <section>
                        <h3>üìä –í–∞—à –ø—Ä–æ–≥—Ä–µ—Å—Å</h3>
                        <p>–°–µ–≥–æ–¥–Ω—è –≤—ã —É–∂–µ —Å–ø–µ–ª–∏ <strong>23 –º–∏–Ω—É—Ç—ã</strong> –∏ –≤—ã–ø–æ–ª–Ω–∏–ª–∏ <strong>7 –ø–µ—Å–µ–Ω</strong> —Å —Ç–æ—á–Ω–æ—Å—Ç—å—é <strong>91%</strong>.</p>
                    </section>
                    
                    <section>
                        <h3>üî• –¢—Ä–µ–Ω–¥—ã –Ω–µ–¥–µ–ª–∏</h3>
                        <p><strong>#1</strong> Bohemian Rhapsody (+1,847)</p>
                        <p><strong>#2</strong> Someone Like You (+1,523)</p>
                        <p><strong>#3</strong> Perfect (+1,401)</p>
                    </section>
                    
                    <section>
                        <h3>üë• –î—Ä—É–∑—å—è –æ–Ω–ª–∞–π–Ω</h3>
                        <div class="friends-list">
                            <div class="friend-item">
                                <span class="friend-name">üü¢ –ú–∞—Ä–∏—è</span>
                                <button class="friend-join-btn">–ü—Ä–∏—Å–æ–µ–¥–∏–Ω–∏—Ç—å—Å—è</button>
                            </div>
                            <div class="friend-item">
                                <span class="friend-name">üü¢ –ê–ª–µ–∫—Å–µ–π</span>
                                <button class="friend-join-btn">–ü—Ä–∏—Å–æ–µ–¥–∏–Ω–∏—Ç—å—Å—è</button>
                            </div>
                            <div class="friend-item">
                                <span class="friend-name">üü° –ï–∫–∞—Ç–µ—Ä–∏–Ω–∞</span>
                                <button class="friend-join-btn">–ü—Ä–∏—Å–æ–µ–¥–∏–Ω–∏—Ç—å—Å—è</button>
                            </div>
                        </div>
                    </section>
                </aside>
            </main>
        </div>
        
        <!-- Live Mode Containers -->
        <div id="live-video-container" class="hidden">
            <div class="live-header">
                <h1 class="live-title">LIVE</h1>
            </div>
            <video id="live-video" autoplay muted playsinline disablepictureinpicture disableremoteplayback webkit-playsinline x-webkit-airplay="deny"></video>
            <div id="lyrics-overlay"></div>
            <div class="live-controls">
                <button id="record-button" class="live-control-btn">
                    <i class="fas fa-record-vinyl"></i> –ó–∞–ø–∏—Å—å
                </button>
                <button id="stream-button" class="live-control-btn">
                    <i class="fas fa-broadcast-tower"></i> –°—Ç—Ä–∏–º
                </button>
                <button id="toggle-effects" class="live-control-btn">
                    <i class="fas fa-mask"></i> –≠—Ñ—Ñ–µ–∫—Ç—ã
                </button>
                <button id="settings-button" class="live-control-btn">
                    <i class="fas fa-cog"></i> –ù–∞—Å—Ç—Ä–æ–π–∫–∏
                </button>
            </div>
            <div id="recording-indicator" class="hidden">REC</div>
        </div>
        
        <!-- Masks Panel -->
        <div id="masks-panel" class="hidden">
            <div class="masks-header">
                <button class="back-button"><i class="fas fa-arrow-left"></i> –ù–∞–∑–∞–¥</button>
                <h2>–ú–∞—Å–∫–∏ –∏ —ç—Ñ—Ñ–µ–∫—Ç—ã</h2>
            </div>
            <div class="categories">
                <!-- –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
            </div>
            <div id="masks-container">
                <!-- –ú–∞—Å–∫–∏ –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
            </div>
        </div>
        
        <!-- Modal Container -->
        <div id="modal-container" class="hidden">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>–ù–∞—Å—Ç—Ä–æ–π–∫–∏</h3>
                    <button id="close-modal">&times;</button>
                </div>
                <div class="modal-body">
                    <!-- –°–æ–¥–µ—Ä–∂–∏–º–æ–µ –±—É–¥–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω–æ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                </div>
            </div>
        </div>
        
        <!-- Status Display for Live mode -->
        <div id="live-status-display" class="hidden"></div>
    </div>

    <!-- Avatar Studio Page Container -->
    <div id="avatar-page-container" class="hidden">
        <div class="cockpit-pro">
            <!-- –£–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –Ω–∞–≤–∏–≥–∞—Ü–∏—è –∫–∞–∫ –≤ –æ—Å–Ω–æ–≤–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ -->
            <header class="cockpit-nav">
                <!-- –ì—Ä—É–ø–ø–∞ 1: –õ–æ–≥–æ—Ç–∏–ø –∏ –ª–µ–≤—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã -->
                <div class="header-left-group">
                    <button class="home-btn" title="beLIVE Avatar Studio">
                        <span class="home-logo">beLIVE</span>
                    </button>
                </div>
                
                <!-- –ì—Ä—É–ø–ø–∞ 2: –¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–µ –∫–Ω–æ–ø–∫–∏ —Ä–µ–∂–∏–º–æ–≤ -->
                <div class="mode-buttons">
                    <button class="mode-button btn-concert" data-mode="concert">–ö–æ–Ω—Ü–µ—Ä—Ç–Ω—ã–π</button>
                    <button class="mode-button btn-karaoke active" data-mode="karaoke">–ö–∞—Ä–∞–æ–∫–µ</button>
                    <button class="mode-button btn-rehearsal" data-mode="rehearsal">–†–µ–ø–µ—Ç–∏—Ü–∏—è</button>
                    <button class="mode-button btn-live" data-mode="live">LIVE</button>
                </div>
                
                <!-- –ì—Ä—É–ø–ø–∞ 3: –ü—Ä–∞–≤—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã -->
                <div class="header-right-group">
                    <div class="scale-controls">
                        <button class="scale-btn">-</button>
                        <button class="scale-btn scale-value-btn">120%</button>
                        <button class="scale-btn">+</button>
                    </div>
                    <button class="animated-gradient-btn">Catalog</button>
                    <div class="progress-ring">
                        <div class="daily-progress">
                            <span class="progress-text">3/5</span>
                            <span class="progress-label">—Ü–µ–ª–∏</span>
                        </div>
                    </div>
                    <div class="user-avatar active">üë§</div>
                </div>
                
                <!-- –ö–Ω–æ–ø–∫–∞ –≤–æ–∑–≤—Ä–∞—Ç–∞ -->
                <button id="back-to-live-feed" class="back-button">‚Üê Live Feed</button>
            </header>

            <!-- –ö–∞—Ä—É—Å–µ–ª—å —Ç—Ä–µ–∫–æ–≤ -->
            <section class="track-carousel-container">
                <div class="carousel-track-list">
                    <!-- –ü–µ—Ä–≤—ã–π –Ω–∞–±–æ—Ä —Ç—Ä–µ–∫–æ–≤ -->
                    <!-- –¢—Ä–µ–∫ 1 -->
                    <div class="carousel-track-item active" onclick="selectTrack(this)" data-track-id="1">
                        <div class="track-item-glow"></div>
                        <div class="track-item-cover cover-1">
                            <div class="live-singers">
                                <a href="#" class="singer">Sveta</a>
                                <a href="#" class="singer">Mike</a>
                            </div>
                        </div>
                        <h4 class="track-item-title">Bohemian Rhapsody</h4>
                    </div>
                    <!-- –¢—Ä–µ–∫ 2 -->
                    <div class="carousel-track-item" onclick="selectTrack(this)" data-track-id="2">
                        <div class="track-item-glow"></div>
                        <div class="track-item-cover cover-2"></div>
                        <h4 class="track-item-title">Stairway to Heaven</h4>
                    </div>
                    <!-- –¢—Ä–µ–∫ 3 -->
                    <div class="carousel-track-item" onclick="selectTrack(this)" data-track-id="3">
                        <div class="track-item-glow"></div>
                        <div class="track-item-cover cover-3">
                            <div class="live-singers">
                                <a href="#" class="singer">Vasya</a>
                            </div>
                        </div>
                        <h4 class="track-item-title">Hallelujah</h4>
                    </div>
                    <!-- –¢—Ä–µ–∫ 4 -->
                    <div class="carousel-track-item" onclick="selectTrack(this)" data-track-id="4">
                        <div class="track-item-glow"></div>
                        <div class="track-item-cover cover-4">
                            <div class="live-singers">
                                <a href="#" class="singer">John</a>
                                <a href="#" class="singer">Lisa</a>
                                <a href="#" class="singer">Max</a>
                            </div>
                        </div>
                        <h4 class="track-item-title">Smells Like Teen Spirit</h4>
                    </div>
                    <!-- –¢—Ä–µ–∫ 5 -->
                    <div class="carousel-track-item" onclick="selectTrack(this)" data-track-id="5">
                        <div class="track-item-glow"></div>
                        <div class="track-item-cover cover-5"></div>
                        <h4 class="track-item-title">Hotel California</h4>
                    </div>
                    <!-- –¢—Ä–µ–∫ 6 -->
                    <div class="carousel-track-item" onclick="selectTrack(this)" data-track-id="6">
                        <div class="track-item-glow"></div>
                        <div class="track-item-cover cover-6">
                            <div class="live-singers">
                                <a href="#" class="singer">Anna</a>
                            </div>
                        </div>
                        <h4 class="track-item-title">Yesterday</h4>
                    </div>
                    
                    <!-- –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –Ω–∞–±–æ—Ä —Ç—Ä–µ–∫–æ–≤ –¥–ª—è –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ–π –ø—Ä–æ–∫—Ä—É—Ç–∫–∏ -->
                    <!-- –¢—Ä–µ–∫ 1 (–¥—É–±–ª—å) -->
                    <div class="carousel-track-item" onclick="selectTrack(this)" data-track-id="1">
                        <div class="track-item-glow"></div>
                        <div class="track-item-cover cover-1">
                            <div class="live-singers">
                                <a href="#" class="singer">Sveta</a>
                                <a href="#" class="singer">Mike</a>
                            </div>
                        </div>
                        <h4 class="track-item-title">Bohemian Rhapsody</h4>
                    </div>
                    <!-- –¢—Ä–µ–∫ 2 (–¥—É–±–ª—å) -->
                    <div class="carousel-track-item" onclick="selectTrack(this)" data-track-id="2">
                        <div class="track-item-glow"></div>
                        <div class="track-item-cover cover-2"></div>
                        <h4 class="track-item-title">Stairway to Heaven</h4>
                    </div>
                    <!-- –¢—Ä–µ–∫ 3 (–¥—É–±–ª—å) -->
                    <div class="carousel-track-item" onclick="selectTrack(this)" data-track-id="3">
                        <div class="track-item-glow"></div>
                        <div class="track-item-cover cover-3">
                            <div class="live-singers">
                                <a href="#" class="singer">Vasya</a>
                            </div>
                        </div>
                        <h4 class="track-item-title">Hallelujah</h4>
                    </div>
                    <!-- –¢—Ä–µ–∫ 4 (–¥—É–±–ª—å) -->
                    <div class="carousel-track-item" onclick="selectTrack(this)" data-track-id="4">
                        <div class="track-item-glow"></div>
                        <div class="track-item-cover cover-4">
                            <div class="live-singers">
                                <a href="#" class="singer">John</a>
                                <a href="#" class="singer">Lisa</a>
                                <a href="#" class="singer">Max</a>
                            </div>
                        </div>
                        <h4 class="track-item-title">Smells Like Teen Spirit</h4>
                    </div>
                    <!-- –¢—Ä–µ–∫ 5 (–¥—É–±–ª—å) -->
                    <div class="carousel-track-item" onclick="selectTrack(this)" data-track-id="5">
                        <div class="track-item-glow"></div>
                        <div class="track-item-cover cover-5"></div>
                        <h4 class="track-item-title">Hotel California</h4>
                    </div>
                    <!-- –¢—Ä–µ–∫ 6 (–¥—É–±–ª—å) -->
                    <div class="carousel-track-item" onclick="selectTrack(this)" data-track-id="6">
                        <div class="track-item-glow"></div>
                        <div class="track-item-cover cover-6">
                            <div class="live-singers">
                                <a href="#" class="singer">Anna</a>
                            </div>
                        </div>
                        <h4 class="track-item-title">Yesterday</h4>
                    </div>
                </div>
            </section>

            <!-- –¶–µ–Ω—Ç—Ä–∞–ª—å–Ω–∞—è —Ä–∞–±–æ—á–∞—è –æ–±–ª–∞—Å—Ç—å -->
            <main class="cockpit-main-area">
                <!-- –õ–µ–≤–∞—è —á–∞—Å—Ç—å: –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ —Ç—Ä–µ–∫—É -->
                <aside class="side-panel" id="user-track-stats">
                    <div class="panel-content-wrapper" id="user-track-stats-content">
                        <!-- –ö–æ–Ω—Ç–µ–Ω—Ç –±—É–¥–µ—Ç –º–µ–Ω—è—Ç—å—Å—è —á–µ—Ä–µ–∑ JS -->
                    </div>
                </aside>

                <!-- –¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π –•–∞–± -->
                <div class="central-hub">
                    <div class="energy-ring ring-1"></div>
                    <div class="energy-ring ring-2"></div>
                    <img src="https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?w=200&h=200&fit=crop&crop=face" alt="–ê—Ä—Ç–∏—Å—Ç" class="hub-avatar">
                </div>
                
                <!-- –ü—Ä–∞–≤–∞—è —á–∞—Å—Ç—å: –°–ø–∏—Å–æ–∫ –ø–æ—é—â–∏—Ö —Å–µ–π—á–∞—Å -->
                <aside class="side-panel" id="live-session-list">
                    <div class="panel-content-wrapper" id="live-session-list-content">
                        <!-- –ö–æ–Ω—Ç–µ–Ω—Ç –±—É–¥–µ—Ç –º–µ–Ω—è—Ç—å—Å—è —á–µ—Ä–µ–∑ JS -->
                    </div>
                </aside>
            </main>
        </div>

        <!-- –°–∫—Ä—ã—Ç—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è —Ç—Ä–µ–∫–æ–≤ -->
        <div id="track-data-1" style="display: none;">
            <div class="left-panel-data">
                <h3 class="panel-title">–í–∞—à–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h3>
                <div class="stats-item">
                    <span class="stats-label">–õ—É—á—à–∞—è —Ç–æ—á–Ω–æ—Å—Ç—å</span>
                    <span class="stats-value">92%</span>
                </div>
                <div class="accuracy-bar"><div class="accuracy-fill" style="width: 92%;"></div></div>
                <div class="stats-item">
                    <span class="stats-label">–ò—Å–ø–æ–ª–Ω–µ–Ω–æ —Ä–∞–∑</span>
                    <span class="stats-value">15</span>
                </div>
                <div class="ai-suggestion">
                    <div class="ai-header">üí° AI-–°–æ–≤–µ—Ç</div>
                    <p class="ai-text">–û—Ç–ª–∏—á–Ω—ã–π —Ñ–∞–ª—å—Ü–µ—Ç! –°–¥–µ–ª–∞–π –ø–µ—Ä–µ—Ö–æ–¥ –∫ –æ—Å–Ω–æ–≤–Ω–æ–π –ø–∞—Ä—Ç–∏–∏ –ø–ª–∞–≤–Ω–µ–µ –≤ —Ç–∞–∫—Ç–µ 34.</p>
                </div>
            </div>
            <div class="right-panel-data">
                <h3 class="panel-title">–°–µ–π—á–∞—Å –ø–æ—é—Ç</h3>
                <ul class="live-list">
                    <li><a href="#">Sveta <span class="session-type duo">–î—É—ç—Ç?</span></a></li>
                    <li><a href="#">Mike <span class="session-type solo">–°–æ–ª–æ</span></a></li>
                </ul>
            </div>
        </div>
        <div id="track-data-2" style="display: none;">
            <div class="left-panel-data">
                <h3 class="panel-title">–í–∞—à–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h3>
                <div class="stats-item"><span class="stats-label">–õ—É—á—à–∞—è —Ç–æ—á–Ω–æ—Å—Ç—å</span><span class="stats-value">81%</span></div>
                <div class="accuracy-bar"><div class="accuracy-fill" style="width: 81%;"></div></div>
                <div class="stats-item"><span class="stats-label">–ò—Å–ø–æ–ª–Ω–µ–Ω–æ —Ä–∞–∑</span><span class="stats-value">7</span></div>
                <div class="ai-suggestion"><div class="ai-header">üí° AI-–°–æ–≤–µ—Ç</div><p class="ai-text">–ü–∏—Ç—á –≤ –∫—Ä–µ—â–µ–Ω–¥–æ –ø–æ—á—Ç–∏ –∏–¥–µ–∞–ª–µ–Ω. –û–±—Ä–∞—Ç–∏ –≤–Ω–∏–º–∞–Ω–∏–µ –Ω–∞ "–°–æ–ª—å" –≤ –±—Ä–∏–¥–∂–µ.</p></div>
            </div>
            <div class="right-panel-data">
                <h3 class="panel-title">–°–µ–π—á–∞—Å –ø–æ—é—Ç</h3>
                <p class="no-one-singing">–ù–∏–∫–æ–≥–æ –Ω–µ—Ç –≤ —ç—Ñ–∏—Ä–µ. <br>–ë—É–¥—å –ø–µ—Ä–≤—ã–º!</p>
            </div>
        </div>
        <div id="track-data-3" style="display: none;">
            <div class="left-panel-data">
                <h3 class="panel-title">–í–∞—à–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h3>
                <div class="stats-item"><span class="stats-label">–õ—É—á—à–∞—è —Ç–æ—á–Ω–æ—Å—Ç—å</span><span class="stats-value">88%</span></div>
                <div class="accuracy-bar"><div class="accuracy-fill" style="width: 88%;"></div></div>
                <div class="stats-item"><span class="stats-label">–ò—Å–ø–æ–ª–Ω–µ–Ω–æ —Ä–∞–∑</span><span class="stats-value">21</span></div>
                <div class="ai-suggestion"><div class="ai-header">üí° AI-–°–æ–≤–µ—Ç</div><p class="ai-text">–í–µ–ª–∏–∫–æ–ª–µ–ø–Ω–∞—è –¥–∏–Ω–∞–º–∏–∫–∞. –ò—Å–ø–æ–ª—å–∑—É–π —Å—Ö–æ–∂—É—é —Ç–µ—Ö–Ω–∏–∫—É –¥–ª—è "Yesterday".</p></div>
            </div>
            <div class="right-panel-data">
                <h3 class="panel-title">–°–µ–π—á–∞—Å –ø–æ—é—Ç</h3>
                <ul class="live-list">
                    <li><a href="#">Vasya <span class="session-type solo">–°–æ–ª–æ</span></a></li>
                </ul>
            </div>
        </div>
        <div id="track-data-4" style="display: none;">
            <div class="left-panel-data">
                <h3 class="panel-title">–í–∞—à–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h3>
                <div class="stats-item"><span class="stats-label">–õ—É—á—à–∞—è —Ç–æ—á–Ω–æ—Å—Ç—å</span><span class="stats-value">76%</span></div>
                <div class="accuracy-bar"><div class="accuracy-fill" style="width: 76%;"></div></div>
                <div class="stats-item"><span class="stats-label">–ò—Å–ø–æ–ª–Ω–µ–Ω–æ —Ä–∞–∑</span><span class="stats-value">11</span></div>
                <div class="ai-suggestion"><div class="ai-header">üí° AI-–°–æ–≤–µ—Ç</div><p class="ai-text">–•–æ—Ä–æ—à–∏–π –¥—Ä–∞–π–≤. –î–ª—è –∞—É—Ç–µ–Ω—Ç–∏—á–Ω–æ—Å—Ç–∏ –¥–æ–±–∞–≤—å –±–æ–ª—å—à–µ "—Ö—Ä–∏–ø–æ—Ç—Ü—ã".</p></div>
            </div>
            <div class="right-panel-data">
                <h3 class="panel-title">–°–µ–π—á–∞—Å –ø–æ—é—Ç</h3>
                <ul class="live-list">
                    <li><a href="#">John <span class="session-type trio">–¢—Ä–∏–æ</span></a></li>
                    <li><a href="#">Lisa <span class="session-type trio">–¢—Ä–∏–æ</span></a></li>
                    <li><a href="#">Max <span class="session-type trio">–¢—Ä–∏–æ</span></a></li>
                </ul>
            </div>
        </div>
        <div id="track-data-5" style="display: none;">
            <div class="left-panel-data">
                <h3 class="panel-title">–í–∞—à–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h3>
                <p class="no-one-singing">–í—ã –µ—â–µ –Ω–µ –ø–µ–ª–∏ —ç—Ç—É –ø–µ—Å–Ω—é.</p>
            </div>
            <div class="right-panel-data">
                <h3 class="panel-title">–°–µ–π—á–∞—Å –ø–æ—é—Ç</h3>
                <p class="no-one-singing">–ù–∏–∫–æ–≥–æ –Ω–µ—Ç –≤ —ç—Ñ–∏—Ä–µ.</p>
            </div>
        </div>
        <div id="track-data-6" style="display: none;">
            <div class="left-panel-data">
                <h3 class="panel-title">–í–∞—à–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h3>
                <div class="stats-item"><span class="stats-label">–õ—É—á—à–∞—è —Ç–æ—á–Ω–æ—Å—Ç—å</span><span class="stats-value">95%</span></div>
                <div class="accuracy-bar"><div class="accuracy-fill" style="width: 95%;"></div></div>
                <div class="stats-item"><span class="stats-label">–ò—Å–ø–æ–ª–Ω–µ–Ω–æ —Ä–∞–∑</span><span class="stats-value">34</span></div>
                <div class="ai-suggestion"><div class="ai-header">üí° AI-–°–æ–≤–µ—Ç</div><p class="ai-text">–¢–≤–æ–µ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏–µ –ø–æ—á—Ç–∏ —ç—Ç–∞–ª–æ–Ω–Ω–æ–µ. –ü–æ–ø—Ä–æ–±—É–π —Å–µ–±—è –≤ —Ä–µ–∂–∏–º–µ "–†–µ–∂–∏—Å—Å–µ—Ä".</p></div>
            </div>
            <div class="right-panel-data">
                <h3 class="panel-title">–°–µ–π—á–∞—Å –ø–æ—é—Ç</h3>
                <ul class="live-list">
                    <li><a href="#">Anna <span class="session-type duo">–î—É—ç—Ç?</span></a></li>
                </ul>
            </div>
        </div>
    </div>

    <!-- Transport Panel Toggle Button - MOVED -->

    <!-- Modal Block Editor Container (initially hidden) -->
    <div id="modal-block-editor-container" class="hidden">
        <!-- –°–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞ –±–ª–æ–∫–æ–≤ –±—É–¥–µ—Ç –∑–¥–µ—Å—å -->
        <div id="integrated-block-editor-content">
            <div class="editor-layout">  <!-- –ù–æ–≤—ã–π flex-–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä -->
                <main class="editor-main-area"> <!-- –û–±–ª–∞—Å—Ç—å –¥–ª—è –±–ª–æ–∫–æ–≤ —Ç–µ–∫—Å—Ç–∞ -->
                    <header class="editor-header">
                        <h1>–†–µ–∂–∏–º –°–æ–∑–¥–∞–Ω–∏—è –ë–ª–æ–∫–æ–≤</h1>
                        <!-- –ö–Ω–æ–ø–∫–∞ "–î–æ–±–∞–≤–∏—Ç—å –±–ª–æ–∫" –ø–µ—Ä–µ–Ω–µ—Å–µ–Ω–∞ –≤ editor-sidebar -->
                    </header>
                    <div class="block-list-area">
                        <!-- –°—é–¥–∞ –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª—è—Ç—å—Å—è –±–ª–æ–∫–∏ —Ç–µ–∫—Å—Ç–∞ -->
                    </div>
                </main>
                <aside class="editor-sidebar"> <!-- –ù–æ–≤–∞—è –±–æ–∫–æ–≤–∞—è –ø–∞–Ω–µ–ª—å –¥–ª—è –∫–Ω–æ–ø–æ–∫ -->
                    <button id="add-block-btn" class="btn">–î–æ–±–∞–≤–∏—Ç—å –±–ª–æ–∫</button>
                    <button id="edit-mode-toggle-btn" class="btn">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Ç–µ–∫—Å—Ç</button>
                    <button id="delete-selected-block-btn" class="btn btn-danger" disabled>–£–¥–∞–ª–∏—Ç—å –±–ª–æ–∫</button>
                    <button id="undo-block-btn" class="btn" title="–û—Ç–º–µ–Ω–∏—Ç—å (Ctrl/‚åò+Z)" disabled>‚Ü∂ Undo</button>
                    <button id="redo-block-btn" class="btn" title="–ü–æ–≤—Ç–æ—Ä–∏—Ç—å (Ctrl/‚åò+Shift+Z)" disabled>‚Ü∑ Redo</button>
                    <button id="save-track-modal-btn" class="btn btn-primary">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ç—Ä–µ–∫</button>
                    <button id="cancel-edit-modal-btn" class="btn">–û—Ç–º–µ–Ω–∞</button>
                    <div id="block-editor-status" style="margin-top: 10px; font-size: 0.9em; color: #555;">–†–µ–¥–∞–∫—Ç–æ—Ä –Ω–µ–∞–∫—Ç–∏–≤–µ–Ω.</div>
                </aside>
            </div>
        </div>
    </div>

    <!-- Component Scripts -->
    <script>
        // Ensure scripts load in the correct order with proper initialization
        window.addEventListener('load', function() {
            console.log('Application fully loaded, components initialized');
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ñ–ª–∞–≥ –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ Live —Ä–µ–∂–∏–º–∞
            if (sessionStorage.getItem('activateLiveMode') === 'true') {
                console.log('Auto-activating Live mode from redirect');
                sessionStorage.removeItem('activateLiveMode');
                
                // –î–∞–µ–º –≤—Ä–µ–º—è –¥–ª—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –≤—Å–µ—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
                setTimeout(function() {
                    // –ù–∞—Ö–æ–¥–∏–º –∏ –∞–∫—Ç–∏–≤–∏—Ä—É–µ–º –∫–Ω–æ–ø–∫—É Live
                    const liveButton = document.querySelector('.mode-button[data-mode="live"]');
                    if (liveButton) {
                        liveButton.click();
                    } else {
                        console.error('Live mode button not found');
                    }
                }, 1000);
            }
        });
    </script>
    <script src="js/debug-config.js"></script>
    <script src="js/overlay.js"></script>

    <!-- üéµ CORE ENGINE & UTILITIES -->
    <!-- –ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–´–ô –ü–û–†–Ø–î–û–ö –ó–ê–ì–†–£–ó–ö–ò -->
    <!-- StateManager –∏ ViewManager –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –∑–∞–≥—Ä—É–∂–µ–Ω—ã –î–û app.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/rtf.js@0.4.0/dist/rtf.min.js"></script>
    <script src="js/utils.js"></script>
    <script src="js/state-manager.js"></script>
    <script src="js/view-manager.js"></script> <!-- –î–û–ë–ê–í–õ–ï–ù ViewManager -->
    
    <!-- –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã –∏ –ª–æ–≥–≥–µ—Ä -->
    <script src="js/constants.js"></script>
    <script src="js/logger.js"></script>
    <script src="js/audio-source-adapter.js"></script>
    
    <!-- üéµ COMPONENT SCRIPTS -->
    <script src="js/color-service.js"></script>
    <script src="js/audio-engine.js"></script>
    <script src="js/enhanced-rtf-processor.js"></script>
    <script src="js/rtf-parser.js"></script>
    <script src="js/rtf-simple-parser.js?v=2025-11-18"></script> <!-- –î–û–ë–ê–í–õ–ï–ù–û: SimpleRtf Parser -->
    <script src="js/rtf-parser-adapter.js?v=2025-11-18"></script>
    <script src="js/lyrics-display.js"></script>
    <script src="js/enhanced-text-processor.js?v=2025-11-18"></script>
    <script src="js/text-processor-integrator.js"></script>
    <script src="js/track-catalog.js"></script>
    <script src="js/marker-manager.js"></script>
    <script src="js/waveform-editor.js"></script>
    <script src="js/text-style-manager.js"></script>
    <script src="js/drag-boundary-controller.js"></script>
    <script src="js/block-loop-control.js"></script>
    <script type="module" src="js/audio-exporter.js"></script>
    <script src="js/export-ui.js"></script>
    <script src="js/background-effects-engine.js"></script>
    <script src="js/mask-system.js"></script>
    <script src="js/rtf-parser-integration.js"></script>
    <script src="js/modal-block-editor.js"></script>
    <script src="js/piano-keyboard.js"></script>
    <script src="js/karaoke-background.js"></script>
    <script src="js/rehearsal-background.js"></script>
    <script src="js/concert-background.js"></script>
    <script src="js/monitor-mix.js"></script>
    <script src="js/monitor-ui.js"></script>
 
    <!-- Live Mode Scripts -->
    <script src="js/live-mode.js"></script>
    <script src="js/live-feed.js"></script>

    <!-- üéµ CATALOG V2 SCRIPT (MUST BE BEFORE APP.JS) -->
    <script src="js/catalog-v2.js?v=2.0"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>

    <!-- Export Feature UI -->

    <!-- üöÄ MAIN APPLICATION SCRIPT (MUST BE LAST) -->
    <script src="js/app.js"></script>
    
    <!-- –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è -->
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è CatalogV2 –ø–æ—Å–ª–µ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ DOM
            try {
                if (window.CatalogV2) {
                    window.catalogV2 = new CatalogV2();
                    console.log('‚úÖ CatalogV2 —É—Å–ø–µ—à–Ω–æ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω –≤ DOMContentLoaded');
                } else {
                    console.error('‚ùå CatalogV2 class –Ω–µ –Ω–∞–π–¥–µ–Ω –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–∫—Ä–∏–ø—Ç–∞');
                }
            } catch (error) {
                console.error('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ CatalogV2:', error);
            }
        });
    </script>

    <div id="block-editor-container" class="hidden"></div>
    <div id="font-selector-modal" class="hidden"></div>
    <div id="loading-overlay" class="hidden">
        <div class="loading-spinner"></div>
        <p>–ó–∞–≥—Ä—É–∑–∫–∞ —Ç—Ä–µ–∫–∞...</p>
    </div>

    <!-- üéµ CATALOG V2 OVERLAY -->
    <div id="catalog-v2-overlay" class="catalog-v2-overlay hidden">
        <div class="catalog-v2-container">
            <div class="catalog-v2-header">
                <h2>üéµ –ö–∞—Ç–∞–ª–æ–≥ —Ç—Ä–µ–∫–æ–≤</h2>
                <button id="catalog-v2-close" class="catalog-v2-close-btn">‚úï –ó–∞–∫—Ä—ã—Ç—å</button>
            </div>
            <div class="catalog-v2-content">
                <!-- 3-–ö–û–õ–û–ù–û–ß–ù–ê–Ø –°–¢–†–£–ö–¢–£–†–ê -->
                <div class="catalog-v2-grid">
                    <!-- –ö–û–õ–û–ù–ö–ê 1: –ú–û–Ø –ú–£–ó–´–ö–ê -->
                    <div class="catalog-column my-music-column">
                        <h3>üéµ –ú–æ—è –º—É–∑—ã–∫–∞</h3>
                        <div class="my-music-content">
                            <p class="empty-state">–ó–∞–≥—Ä—É–∑–∏—Ç–µ —Ç—Ä–µ–∫–∏ —á–µ—Ä–µ–∑ "Upload Track" ‚Üí</p>
                        </div>
                    </div>
                    
                    <!-- –ö–û–õ–û–ù–ö–ê 2: –ü–õ–ï–ô–õ–ò–°–¢–´/–ò–°–¢–û–†–ò–Ø/–¢–†–ï–ù–î–´ -->
                    <div class="catalog-column center-dynamic-column">
                        <div class="tab-navigation">
                            <button class="tab-btn active" data-tab="playlists">–ü–ª–µ–π–ª–∏—Å—Ç—ã</button>
                            <button class="tab-btn" data-tab="history">–ò—Å—Ç–æ—Ä–∏—è</button>
                            <button class="tab-btn" data-tab="trends">–¢—Ä–µ–Ω–¥—ã</button>
                        </div>
                        <div class="tab-panels">
                            <div class="tab-panel active" id="playlists-panel">
                                <p class="empty-state">–°–æ–∑–¥–∞–π—Ç–µ —Å–≤–æ–π –ø–µ—Ä–≤—ã–π –ø–ª–µ–π–ª–∏—Å—Ç</p>
                            </div>
                            <div class="tab-panel" id="history-panel">
                                <p class="empty-state">–ò—Å—Ç–æ—Ä–∏—è –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è –ø—É—Å—Ç–∞</p>
                                <!-- Admin-only: –∫–Ω–æ–ø–∫–∞ –æ—á–∏—Å—Ç–∫–∏ –ë–î —Å–∫—Ä—ã—Ç–∞ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π. –í–∫–ª—é—á–∞—Ç—å —Ç–æ–ª—å–∫–æ –≤ dev-—Å–±–æ—Ä–∫–µ. -->
                            </div>
                            <div class="tab-panel" id="trends-panel">
                                <p class="empty-state">–ó–∞–≥—Ä—É–∂–∞—é—Ç—Å—è —Ç—Ä–µ–Ω–¥—ã...</p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- –ö–û–õ–û–ù–ö–ê 3: –ü–û–ò–°–ö/–ó–ê–ì–†–£–ó–ö–ê -->
                    <div class="catalog-column smart-search-column">
                        <div class="search-upload-toggle">
                            <button class="toggle-btn active" data-mode="search">–ü–æ–∏—Å–∫</button>
                            <button class="toggle-btn" data-mode="upload">Upload Track</button>
                        </div>
                        <div class="search-mode-content active">
                            <input type="text" class="search-input" placeholder="–ü–æ–∏—Å–∫ —Ç—Ä–µ–∫–æ–≤...">
                            <div class="search-results">
                                <p class="empty-state">–í–≤–µ–¥–∏—Ç–µ –∑–∞–ø—Ä–æ—Å –¥–ª—è –ø–æ–∏—Å–∫–∞</p>
                            </div>
                        </div>
                        <div class="upload-mode-content">
                            <div class="upload-mode-container">
                                
                                <div class="upload-grid compact">
                                    <!-- INSTRUMENTAL CELL -->
                                    <div class="upload-cell" data-type="instrumental">
                                        <div class="upload-icon">üéµ</div>
                                        <input type="file" id="instrumental-input" class="file-input" accept="audio/*">
                                        <label for="instrumental-input" class="file-label">Instrumental</label>
                                    </div>
                                    
                                    <!-- VOCAL CELL -->
                                    <div class="upload-cell" data-type="vocal">
                                        <div class="upload-icon">üé§</div>
                                        <input type="file" id="vocal-input" class="file-input" accept="audio/*">
                                        <label for="vocal-input" class="file-label">Vocals</label>
                                    </div>
                                    
                                    <!-- LYRICS CELL -->
                                    <div class="upload-cell" data-type="lyrics">
                                        <div class="upload-icon">üìù</div>
                                        <input type="file" id="lyrics-input" class="file-input" accept=".txt,.rtf">
                                        <label for="lyrics-input" class="file-label">Lyrics</label>
                                    </div>
 
                                    <!-- JSON MARKERS CELL -->
                                    <div class="upload-cell" data-type="json">
                                        <div class="upload-icon">üìä</div>
                                        <input type="file" id="json-input" class="file-input" accept=".json">
                                        <label for="json-input" class="file-label">Markers JSON</label>
                                    </div>
 
                                    <!-- ZIP FILE CELL (–Ω–æ–≤—ã–π) -->
                                    <div class="upload-cell" data-type="zip">
                                        <div class="upload-icon">üóúÔ∏è</div>
                                        <p class="drop-text">Drop ZIP file</p>
                                        <input type="file" id="zip-input" class="file-input" accept=".zip">
                                        <label for="zip-input" class="file-label">ZIP Archive</label>
                                    </div>
 
                                    <!-- STEMS CELL (placeholder) -->
                                    <div class="upload-cell disabled" data-type="stems" title="–°–∫–æ—Ä–æ">
                                        <div class="upload-icon">üß¨</div>
                                        <input type="file" id="stems-input" class="file-input" style="display:none">
                                        <label for="stems-input" class="file-label">Stems (N/A)</label>
                                    </div>
                                </div>
                                
                                <div class="upload-controls">
                                    <button id="upload-cancel" class="upload-btn cancel-btn">‚ùå –û—Ç–º–µ–Ω–∞</button>
                                    <button id="upload-save" class="upload-btn save-btn" disabled>üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ç—Ä–µ–∫</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script type="module" src="/src/main.ts"></script>

    <!-- Service Worker Registration –¥–ª—è PWA -->
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/service-worker.js')
                    .then(registration => {
                        console.log('‚úÖ Service Worker –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω —É—Å–ø–µ—à–Ω–æ:', registration);
                    })
                    .catch(error => {
                        console.error('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ Service Worker:', error);
                    });
            });
        }
    </script>

    <!-- AI Chat Window -->
    <div id="ai-chat-window" class="ai-chat-window hidden" role="dialog" aria-modal="true" aria-labelledby="ai-chat-title">
      <div class="ai-chat-header">
        <div class="ai-chat-title">
          <span class="ai-status-indicator"></span>
          <span id="ai-chat-title-text">AI –û–ø–µ—Ä–∞—Ç–æ—Ä</span>
        </div>
        
        <!-- üëá –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è model picker –≤ —Ö–µ–¥–µ—Ä -->
        <div class="ai-header-controls">
          <button class="ai-model-switch-btn" title="–°–º–µ–Ω–∏—Ç—å –º–æ–¥–µ–ª—å">
            <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
              <path d="M8 2a6 6 0 100 12A6 6 0 008 2zm0 1a5 5 0 110 10A5 5 0 018 3z"/>
            </svg>
          </button>
          <button class="ai-close-btn" title="–ó–∞–∫—Ä—ã—Ç—å">
            <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
              <path d="M4 4l8 8M12 4l-8 8" stroke="currentColor" stroke-width="2"/>
            </svg>
          </button>
        </div>
      </div>

      <div class="ai-chat-messages" id="ai-chat-messages" role="log" aria-live="polite"></div>
      
      <div class="ai-chat-input-area">
        <button class="ai-voice-btn" title="–ì–æ–ª–æ—Å–æ–≤–æ–π –≤–≤–æ–¥">
          <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
            <path d="M10 2a3 3 0 00-3 3v5a3 3 0 006 0V5a3 3 0 00-3-3z"/>
            <path d="M5 10a5 5 0 0010 0"/>
          </svg>
        </button>
        
        <div class="ai-input-wrapper">
          <input 
            type="text" 
            class="ai-chat-input" 
            placeholder="–°–ø—Ä–æ—Å–∏ –º–µ–Ω—è —á—Ç–æ-–Ω–∏–±—É–¥—å..."
            autocomplete="off"
            id="ai-input"
          />
        </div>
        
        <button class="ai-send-btn" title="–û—Ç–ø—Ä–∞–≤–∏—Ç—å" id="ai-send-button">
          <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
            <path d="M2 10l16-8-8 16-2-8-6-0z"/>
          </svg>
        </button>
      </div>
    </div>

    <!-- Model Picker (–ø–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä—É–µ—Ç—Å—è —á–µ—Ä–µ–∑ JS –ø—Ä–∏ –∫–ª–∏–∫–µ –Ω–∞ ai-model-switch-btn) -->
    <div id="belive-ai-picker" class="belive-model-picker hidden">
      <div class="model-list"></div>
    </div>
</body>
</html> 
